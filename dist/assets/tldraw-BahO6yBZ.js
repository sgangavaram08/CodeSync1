var Ll=Object.defineProperty;var zl=(t,o,e)=>o in t?Ll(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var h=(t,o,e)=>zl(t,typeof o!="symbol"?o+"":o,e);import{j as r,r as k,R as fe}from"./react-D4eHrszB.js";import{u as A,a as L,V as m,E as Ce,g as ar,D as Ol,t as j,b as Ke,c as ze,d as Fl,e as ve,M as io,f as Rl,h as mo,i as nn,j as Nl,A as It,F as _t,k as ls,l as ne,m as je,S as N,n as Ae,o as ye,p as Oe,q as ro,s as We,r as pi,v as ao,B as Bl,G as Ue,w as Z,x as xo,y as $s,z as Ht,C as lr,H as Ul,I as Be,J as Hl,K as Qe,L as Wl,N as lo,O as tt,P as Ds,Q as cr,R as Lt,T as dr,U as ht,W as ui,X as co,Y as an,Z as hr,_ as ae,$ as Ls,a0 as Xe,a1 as pr,a2 as ur,a3 as Gl,a4 as Kl,a5 as ce,a6 as ee,a7 as de,a8 as be,a9 as zs,aa as Wt,ab as Vl,ac as Yl,ad as pt,ae as ut,af as yn,ag as gr,ah as Os,ai as gt,aj as So,ak as Zl,al as Gt,am as ql,an as Xl,ao as ft,ap as cs,aq as _e,ar as qe,as as Jl,at as Ql,au as ec,av as yo,aw as nt,ax as tc,ay as nc,az as oc,aA as on,aB as sc,aC as ic,aD as rc,aE as ac,aF as zt,aG as ho,aH as lc,aI as cc,aJ as dc,aK as hc,aL as Ao,aM as gn,aN as pc,aO as uc,aP as gc,aQ as fc,aR as mc,aS as xc,aT as fr,aU as Fs,aV as mr,aW as Sc,aX as Rs,aY as yc,aZ as bc,a_ as wc,a$ as vc,b0 as kc,b1 as Pc,b2 as Cc,b3 as Ns,b4 as xr,b5 as jc,b6 as Ic,b7 as Tc,b8 as $o,b9 as Ec,ba as Mc,bb as _c,bc as bo,bd as Sr,be as ot,bf as Ac,bg as $c,bh as Dc,bi as Lc,bj as zc,bk as Oc,bl as Ot,bm as Do,bn as yr,bo as Fc,bp as Rc,bq as Nc,br as Bc,bs as st,bt as br,bu as Uc,bv as wr,bw as Hc,bx as Wc,by as Gc,bz as vr,bA as Kc,bB as ds,bC as hs,bD as ps,bE as us,bF as gs,bG as fs,bH as gi,bI as fi,bJ as Vc,bK as Yc,bL as kr,bM as Pr,bN as ms,bO as Cr,bP as jr,bQ as Zc,bR as qc,bS as Xc,bT as ln,bU as xs,bV as Mn,bW as Ir,bX as At,bY as Jc,bZ as Qc,b_ as ed}from"./@tldraw-Dx2Mye0e.js";import"./lodash.isequal-CWPzDpkQ.js";import{c as H}from"./classnames-C5re8Ct7.js";import"./lodash.throttle-yuuEgjvB.js";import"./idb-Bn1DMRyg.js";import"./lodash.uniq-BHEsPF9E.js";import"./core-js-Dkw2Z0CP.js";import{$ as td,a as nd,b as od,c as sd,d as id,e as rd,f as ad,g as ld,h as mi,i as cd,j as dd,k as hd,l as pd,m as ud,n as gd,o as fd,p as md,q as xd,r as Sd,s as yd,t as wo,u as bd,v as Bs,w as Us,x as Hs,y as wd,z as vd,A as kd,B as Pd,C as Cd,D as jd,E as Id,F as Td,G as Ed,H as Md,I as _d,J as Ad,K as $d,L as Dd,M as Ld,N as zd,O as Od}from"./@radix-ui-DJHLK9JK.js";import{l as Tr}from"./lz-string-CzHELm9r.js";import{c as Lo}from"./canvas-size-BJ7hgjqk.js";import{h as Tt}from"./hotkeys-js-BfWqkGRU.js";async function Fd(t,o){const{url:e,style:n="normal",weight:s="500",display:i,featureSettings:a,stretch:l,unicodeRange:d,variant:c,format:p}=o,g={style:n,weight:s,display:i,featureSettings:a,stretch:l,unicodeRange:d,variant:c},u=new FontFace(t,`url(${e})`,g);return await u.load(),document.fonts.add(u),u.$$_url=e,u.$$_fontface=`
@font-face {
	font-family: ${u.family};
	font-stretch: ${u.stretch};
	font-weight: ${u.weight};
	font-style: ${u.style};
	src: url("${e}") format("${p}")
}`,u}function Rd(t){return t.getSelectedShapeIds().map(n=>t.getShape(n)).filter(n=>!(!n||t.isShapeOfType(n,"arrow")&&n.props.start.type==="binding"||t.isShapeOfType(n,"arrow")&&n.props.end.type==="binding"))}const Er=()=>{const t=A();return L("threeStackableItems",()=>Rd(t).length>2,[t])},Mr=()=>{const t=A();return L("allow group",()=>{const o=t.getSelectedShapes();if(o.length<2)return!1;for(const e of o)if(t.isShapeOfType(e,"arrow")){const{start:n,end:s}=e.props;if(n.type==="binding"&&!o.some(i=>i.id===n.boundShapeId)||s.type==="binding"&&!o.some(i=>i.id===s.boundShapeId))return!1}return!0},[t])},_r=()=>{const t=A();return L("allowUngroup",()=>t.getSelectedShapeIds().some(o=>{var e;return((e=t.getShape(o))==null?void 0:e.type)==="group"}),[t])},Nd=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function Bd(t,o){const e=A();return L("selectedShapes",()=>e.getSelectedShapes().length>=t,[e,t,o])}function me(t,o){const e=A();return L("selectedShapes",()=>{const n=e.getSelectedShapes().filter(s=>!e.isShapeOrAncestorLocked(s)).length;return t===void 0?n:n>=t},[e])}function Ud(){const t=A();return L("showAutoSizeToggle",()=>{const o=t.getSelectedShapes();return o.length===1&&t.isShapeOfType(o[0],"text")&&o[0].props.autoSize===!1},[t])}function Ar(){const t=A();return L("hasLinkShapeSelected",()=>{const o=t.getOnlySelectedShape();return!!(o&&o.type!=="embed"&&"url"in o.props&&!o.isLocked)},[t])}function Hd(){const t=A();return L("onlyFlippableShape",()=>{const o=t.getOnlySelectedShape();return o&&(t.isShapeOfType(o,"group")||t.isShapeOfType(o,"arrow")||t.isShapeOfType(o,"line")||t.isShapeOfType(o,"draw"))},[t])}function $r(){const t=A();return L("useCanRedo",()=>t.getCanRedo(),[t])}function Dr(){const t=A();return L("useCanUndo",()=>t.getCanUndo(),[t])}function Wd({children:t}){const o=A();return L("shouldDisplayHandles",()=>{if(o.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(o.isInAny("select.editing_shape")){const n=o.getOnlySelectedShape();return n&&o.isShapeOfType(n,"note")}return!1},[o])?r.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null}const{PI:Gd}=Math,$t=Gd+1e-4;function Lr(t,o={}){const{size:e=16,smoothing:n=.5}=o;if(t.length===0||e<=0)return{left:[],right:[]};const s=t[0],i=t[t.length-1],a=i.runningLength,l=Math.pow(e*n,2),d=[],c=[];let p=t[0].vector,g=t[0].point,u=g,f=g,x=u,S=!1,v;for(let b=0;b<t.length;b++){v=t[b];const{point:w,vector:E}=t[b],C=v.vector.dpr(p),y=(b<t.length-1?t[b+1]:t[b]).vector,P=b<t.length-1?y.dpr(v.vector):1,T=C<0&&!S,_=P!==null&&P<.2;if(T||_){if(P>-.62&&a-v.runningLength>v.radius){const M=p.clone().mul(v.radius);p.clone().cpr(y)<0?(f=m.Add(w,M),x=m.Sub(w,M)):(f=m.Sub(w,M),x=m.Add(w,M)),d.push(f),c.push(x)}else{const M=p.clone().mul(v.radius).per(),$=m.Sub(v.input,M);for(let z=1/13,O=0;O<1;O+=z)f=m.RotWith($,v.input,$t*O),d.push(f),x=m.RotWith($,v.input,$t+$t*-O),c.push(x)}g=f,u=x,_&&(S=!0);continue}if(S=!1,v===s||v===i){const M=m.Per(E).mul(v.radius);d.push(m.Sub(w,M)),c.push(m.Add(w,M));continue}const D=m.Lrp(y,E,P).per().mul(v.radius);f=m.Sub(w,D),(b<=1||m.Dist2(g,f)>l)&&(d.push(f),g=f),x=m.Add(w,D),(b<=1||m.Dist2(u,x)>l)&&(c.push(x),u=x),p=E}return{left:d,right:c}}function Ws(t,o={}){const{size:e=16,start:n={},end:s={},last:i=!1}=o,{cap:a=!0}=n,{cap:l=!0}=s;if(t.length===0||e<=0)return[];const d=t[0],c=t[t.length-1],p=c.runningLength,g=n.taper===!1?0:n.taper===!0?Math.max(e,p):n.taper,u=s.taper===!1?0:s.taper===!0?Math.max(e,p):s.taper,{left:f,right:x}=Lr(t,o),S=d.point,v=t.length>1?t[t.length-1].point:m.AddXY(d.point,1,1);if(t.length===1&&(!(g||u)||i)){const C=m.Add(S,m.Sub(S,v).uni().per().mul(-d.radius)),y=[];for(let P=1/13,T=P;T<=1;T+=P)y.push(m.RotWith(C,S,$t*2*T));return y}const b=[];if(!(g||u&&t.length===1))if(a)for(let C=1/8,y=C;y<=1;y+=C){const P=m.RotWith(x[0],S,$t*y);b.push(P)}else{const C=m.Sub(f[0],x[0]),y=m.Mul(C,.5),P=m.Mul(C,.51);b.push(m.Sub(S,y),m.Sub(S,P),m.Add(S,P),m.Add(S,y))}const w=[],E=c.vector.clone().per().neg();if(u||g&&t.length===1)w.push(v);else if(l){const C=m.Add(v,m.Mul(E,c.radius));for(let y=1/29,P=y;P<1;P+=y)w.push(m.RotWith(C,v,$t*3*P))}else w.push(m.Add(v,m.Mul(E,c.radius)),m.Add(v,m.Mul(E,c.radius*.99)),m.Sub(v,m.Mul(E,c.radius*.99)),m.Sub(v,m.Mul(E,c.radius)));return f.concat(w,x.reverse(),b)}const Kd=.025,Vd=.01;function Re(t,o={}){var v;const{streamline:e=.5,size:n=16,simulatePressure:s=!1}=o;if(t.length===0)return[];const i=.15+(1-e)*.85;let a=t.map(m.From),l=0;if(!s){let b=a[0];for(;b&&!(b.z>=Kd);)a.shift(),b=a[0]}if(!s){let b=a[a.length-1];for(;b&&!(b.z>=Vd);)a.pop(),b=a[a.length-1]}if(a.length===0)return[{point:m.From(t[0]),input:m.From(t[0]),pressure:s?.5:.15,vector:new m(1,1),distance:0,runningLength:0,radius:1}];let d=a[1];for(;d&&!(m.Dist2(d,a[0])>(n/3)**2);)a[0].z=Math.max(a[0].z,d.z),a.splice(1,1),d=a[1];const c=a.pop();for(d=a[a.length-1];d&&!(m.Dist2(d,c)>(n/3)**2);)a.pop(),d=a[a.length-1],l++;a.push(c);const p=o.last||!o.simulatePressure||a.length>1&&m.Dist2(a[a.length-1],a[a.length-2])<n**2||l>0;if(a.length===2&&o.simulatePressure){const b=a[1];a=a.slice(0,-1);for(let w=1;w<5;w++){const E=m.Lrp(a[0],b,w/4);E.z=(a[0].z+(b.z-a[0].z))*w/4,a.push(E)}}const g=[{point:a[0],input:a[0],pressure:s?.5:a[0].z,vector:new m(1,1),distance:0,runningLength:0,radius:1}];let u=0,f=g[0],x,S;p&&e>0&&a.push(a[a.length-1].clone());for(let b=1,w=a.length;b<w;b++)x=!i||o.last&&b===w-1?a[b].clone():a[b].clone().lrp(f.point,1-i),!f.point.equals(x)&&(S=m.Dist(x,f.point),u+=S,!(b<4&&u<n)&&(f={input:a[b],point:x,pressure:s?.5:a[b].z,vector:m.Sub(f.point,x).uni(),distance:S,runningLength:u,radius:1},g.push(f)));if((v=g[1])!=null&&v.vector&&(g[0].vector=g[1].vector.clone()),u<1){const b=Math.max(.5,...g.map(w=>w.pressure));g.forEach(w=>w.pressure=b)}return g}const{min:Ze}=Math,zo=.275;function vo(t,o){const{size:e=16,thinning:n=.5,simulatePressure:s=!0,easing:i=v=>v,start:a={},end:l={}}=o,{easing:d=Ce.easeOutQuad}=a,{easing:c=Ce.easeOutCubic}=l,p=t[t.length-1].runningLength;let g,u=t[0].pressure,f;if(!s&&p<e){const v=t.reduce((b,w)=>Math.max(b,w.pressure),.5);return t.forEach(b=>{b.pressure=v,b.radius=e*i(.5-n*(.5-b.pressure))}),t}else{let v;for(let b=0,w=t.length;b<w&&(f=t[b],!(f.runningLength>e*5));b++){const E=Ze(1,f.distance/e);if(s){const C=Ze(1,1-E);v=Ze(1,u+(C-u)*(E*zo))}else v=Ze(1,u+(f.pressure-u)*.5);u=u+(v-u)*.5}for(let b=0;b<t.length;b++){if(f=t[b],n){let{pressure:w}=f;const E=Ze(1,f.distance/e);if(s){const C=Ze(1,1-E);w=Ze(1,u+(C-u)*(E*zo))}else w=Ze(1,u+(w-u)*(E*zo));f.radius=e*i(.5-n*(.5-w)),u=w}else f.radius=e/2;g===void 0&&(g=f.radius)}}const x=a.taper===!1?0:a.taper===!0?Math.max(e,p):a.taper,S=l.taper===!1?0:l.taper===!0?Math.max(e,p):l.taper;if(x||S)for(let v=0;v<t.length;v++){f=t[v];const{runningLength:b}=f,w=b<x?d(b/x):1,E=p-b<S?c((p-b)/S):1;f.radius=Math.max(.01,f.radius*Math.min(w,E))}return t}function Yd(t,o={}){return Ws(vo(Re(t,o),o),o)}function xi({scribble:t,zoom:o,color:e,opacity:n,className:s}){if(!t.points.length)return null;const i=Yd(t.points,{size:t.size/o,start:{taper:t.taper,easing:Ce.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let a;if(i.length<4){const l=t.size/o/2,{x:d,y:c}=t.points[t.points.length-1];a=`M ${d-l},${c} a ${l},${l} 0 1,0 ${l*2},0 a ${l},${l} 0 1,0 ${-l*2},0`}else a=ar(i);return r.jsx("svg",{className:s&&H("tl-overlays__item",s),children:r.jsx("path",{className:"tl-scribble",d:a,fill:e??`var(--color-${t.color})`,opacity:n??t.opacity})})}const Zd=({bounds:t,rotation:o})=>{const e=A();return L("should display",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[e])?r.jsx(Ol,{bounds:t,rotation:o}):null};function Ve(){const t=A();return L("isReadonlyMode",()=>t.getInstanceState().isReadonly,[t])}function qd({size:t,width:o,height:e,hideAlternateHandles:n}){const s=j(t/3),i=s/2;return r.jsxs("svg",{className:"tl-overlays__item",children:[r.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${j(0-i)},${j(t)} 
						${j(0-i)},${j(0-i)} 
						${j(t)},${j(0-i)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),r.jsx("line",{className:H("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:j(o/2-t),y1:j(0-i),x2:j(o/2+t),y2:j(0-i),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),r.jsx("polyline",{className:H("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${j(o-t)},${j(0-i)} 
						${j(o+i)},${j(0-i)} 
						${j(o+i)},${j(t)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),r.jsx("line",{className:H("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:j(o+i),y1:j(e/2-t),x2:j(o+i),y2:j(e/2+t),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),r.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${j(o+i)},${j(e-t)} 
						${j(o+i)},${j(e+i)}
						${j(o-t)},${j(e+i)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),r.jsx("line",{className:H("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:j(o/2-t),y1:j(e+i),x2:j(o/2+t),y2:j(e+i),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),r.jsx("polyline",{className:H("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${j(0+t)},${j(e+i)} 
						${j(0-i)},${j(e+i)}
						${j(0-i)},${j(e-t)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),r.jsx("line",{className:H("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:j(0-i),y1:j(e/2-t),x2:j(0-i),y2:j(e/2+t),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Xd=Ke(function({bounds:o,rotation:e}){const n=A(),s=k.useRef(null),i=Ve(),a=ze("top"),l=ze("right"),d=ze("bottom"),c=ze("left"),p=ze("top_left"),g=ze("top_right"),u=ze("bottom_right"),f=ze("bottom_left"),x=!n.getIsMenuOpen()&&n.getInstanceState().cursor.type==="default",S=n.getInstanceState().isCoarsePointer,v=n.getOnlySelectedShape(),b=v&&n.isShapeOrAncestorLocked(v),w=v?n.getShapeUtil(v).expandSelectionOutlinePx(v):0;if(Fl(s,o==null?void 0:o.x,o==null?void 0:o.y,1,n.getSelectionRotation(),{x:-w,y:-w}),!o)return null;o=o.clone().expandBy(w).zeroFix();const E=n.getZoomLevel(),C=n.getInstanceState().isChangingStyle,y=o.width,P=o.height,T=8/E,_=y<T*2,D=P<T*2,M=y<T*4,$=P<T*4,z=y<T*5,O=P<T*5,W=S?1.75:1,R=6/E*W,X=(M?R/2:R)*(W*.75),Q=($?R/2:R)*(W*.75),Se=(v?!n.getShapeUtil(v).hideSelectionBoundsFg(v):!0)&&!C;let we=Se&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||Se&&n.isIn("select.resizing")&&v&&n.isShapeOfType(v,"text");v&&we&&n.environment.isFirefox&&n.isShapeOfType(v,"embed")&&(we=!1);const te=n.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!C&&!i,pe=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!C&&!i,Le=!S&&!(_||D)&&(pe||te)&&(v?!n.getShapeUtil(v).hideRotateHandle(v):!0)&&!b,Kt=S&&(!M||!$)&&(pe||te)&&(v?!n.getShapeUtil(v).hideRotateHandle(v):!0)&&!b,wt=pe&&(v?n.getShapeUtil(v).canResize(v)&&!n.getShapeUtil(v).hideResizeHandles(v):!0)&&!te&&!b,Mo=_||D,ai=_&&D,_o=z||O,mn=wt||te,xn=!Le,Al=!pe||!Kt,li=!pe||!mn,ci=!pe||!mn||Mo,di=!pe||!mn||Mo,hi=!pe||!mn||ai&&!te;let Vt=!0,Sn=!0;if(te)Vt=_o,Sn=_o;else if(wt){Vt=Mo||ai||S;const Dl=S&&v&&v.type==="text";Sn=Vt&&!Dl}const Yt=Math.min(24/E,P-Q*3),$l=pe&&S&&v&&n.isShapeOfType(v,"text")&&Yt*E>=4;return r.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:r.jsxs("g",{ref:s,children:[we&&r.jsx("rect",{className:"tl-selection__fg__outline",width:j(y),height:j(P)}),r.jsx(bn,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:R,corner:"top_left_rotate",cursor:x?ve("nwse-rotate",e):void 0,isHidden:xn}),r.jsx(bn,{"data-testid":"selection.rotate.top-right",cx:y+R*3,cy:0,targetSize:R,corner:"top_right_rotate",cursor:x?ve("nesw-rotate",e):void 0,isHidden:xn}),r.jsx(bn,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:P+R*3,targetSize:R,corner:"bottom_left_rotate",cursor:x?ve("swne-rotate",e):void 0,isHidden:xn}),r.jsx(bn,{"data-testid":"selection.rotate.bottom-right",cx:y+R*3,cy:P+R*3,targetSize:R,corner:"bottom_right_rotate",cursor:x?ve("senw-rotate",e):void 0,isHidden:xn}),r.jsx(Qd,{"data-testid":"selection.rotate.mobile",cx:M?-R*1.5:y/2,cy:M?P/2:-R*1.5,size:T,isHidden:Al}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":Vt}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:j(0-($?Q*2:Q)),width:j(y),height:j(Math.max(1,Q*2)),style:x?{cursor:ve("ns-resize",e)}:void 0,...a}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":Sn}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:j(y-(M?0:X)),y:0,height:j(P),width:j(Math.max(1,X*2)),style:x?{cursor:ve("ew-resize",e)}:void 0,...l}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":Vt}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:j(P-($?0:Q)),width:j(y),height:j(Math.max(1,Q*2)),style:x?{cursor:ve("ns-resize",e)}:void 0,...d}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":Sn}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:j(0-(M?X*2:X)),y:0,height:j(P),width:j(Math.max(1,X*2)),style:x?{cursor:ve("ew-resize",e)}:void 0,...c}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":li}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:j(0-(M?X*2:X*1.5)),y:j(0-($?Q*2:Q*1.5)),width:j(X*3),height:j(Q*3),style:x?{cursor:ve("nwse-resize",e)}:void 0,...p}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":ci}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:j(y-(M?0:X*1.5)),y:j(0-($?Q*2:Q*1.5)),width:j(X*3),height:j(Q*3),style:x?{cursor:ve("nesw-resize",e)}:void 0,...g}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":hi}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:j(y-(M?X:X*1.5)),y:j(P-($?Q:Q*1.5)),width:j(X*3),height:j(Q*3),style:x?{cursor:ve("nwse-resize",e)}:void 0,...u}),r.jsx("rect",{className:H("tl-transparent",{"tl-hidden":di}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:j(0-(M?X*3:X*1.5)),y:j(P-($?0:Q*1.5)),width:j(X*3),height:j(Q*3),style:x?{cursor:ve("nesw-resize",e)}:void 0,...f}),wt&&r.jsxs(r.Fragment,{children:[r.jsx("rect",{"data-testid":"selection.resize.top-left",className:H("tl-corner-handle",{"tl-hidden":li}),"aria-label":"top_left handle",x:j(0-T/2),y:j(0-T/2),width:j(T),height:j(T)}),r.jsx("rect",{"data-testid":"selection.resize.top-right",className:H("tl-corner-handle",{"tl-hidden":ci}),"aria-label":"top_right handle",x:j(y-T/2),y:j(0-T/2),width:j(T),height:j(T)}),r.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:H("tl-corner-handle",{"tl-hidden":hi}),"aria-label":"bottom_right handle",x:j(y-T/2),y:j(P-T/2),width:j(T),height:j(T)}),r.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:H("tl-corner-handle",{"tl-hidden":di}),"aria-label":"bottom_left handle",x:j(0-T/2),y:j(P-T/2),width:j(T),height:j(T)})]}),$l&&r.jsxs(r.Fragment,{children:[r.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:j(0-T/4),y:j(P/2-Yt/2),rx:T/4,width:j(T/2),height:j(Yt)}),r.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:T/4,x:j(y-T/4),y:j(P/2-Yt/2),width:j(T/2),height:j(Yt)})]}),te&&r.jsx(qd,{size:T,width:y,height:P,hideAlternateHandles:_o})]})})}),bn=function({cx:o,cy:e,targetSize:n,corner:s,cursor:i,isHidden:a,"data-testid":l}){const d=ze(s);return r.jsx("rect",{className:H("tl-transparent","tl-rotate-corner",{"tl-hidden":a}),"data-testid":l,"aria-label":`${s} target`,pointerEvents:"all",x:j(o-n*3),y:j(e-n*3),width:j(Math.max(1,n*3)),height:j(Math.max(1,n*3)),cursor:i,...d})},Jd=Math.sqrt(Math.PI),Qd=function({cx:o,cy:e,size:n,isHidden:s,"data-testid":i}){const a=ze("mobile_rotate"),l=A(),d=L("zoom level",()=>l.getZoomLevel(),[l]),c=Math.max(14*(1/d),20/Math.max(1,d));return r.jsxs("g",{children:[r.jsx("circle",{"data-testid":i,pointerEvents:"all",className:H("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:o,cy:e,r:c,...a}),r.jsx("circle",{className:H("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:o,cy:e,r:n/Jd})]})},he={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},le={s:2,m:3.5,l:5,xl:10},Ft={s:18,m:24,l:36,xl:44},He={s:18,m:22,l:26,xl:32},lt={s:18,m:20,l:24,xl:28},Fe={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},eh=20,th=4.25,Me=16;let Oo=null;function nh(){return Oo||(Oo=oh()),Oo}async function oh(){const t=await Lo.maxWidth({usePromise:!0}),o=await Lo.maxHeight({usePromise:!0}),e=await Lo.maxArea({usePromise:!0});return{maxWidth:t.width,maxHeight:o.height,maxArea:e.width*e.height}}const Si=8192,sh=4096*4096;async function zr(t,o){if(t<=Si&&o<=Si&&t*o<=sh)return[t,o];const{maxWidth:e,maxHeight:n,maxArea:s}=await nh(),i=t/o;if(t>e&&(t=e,o=t/i),o>n&&(o=n,t=o*i),t*o>s){const a=Math.sqrt(s/(t*o));t*=a,o*=a}return[t,o]}/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function yi(t,o){let e=0;for(;t[o+e];)e+=t[o+e]+1;return e+1}function ih(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function rh(t){const o=new Uint8Array(t);let e,n,s=0,i=0;if(!ih(t))return!1;for(e=o[10]&128,n=o[10]&7,s+=6,s+=7,s+=e?3*Math.pow(2,n+1):0;i<2&&s<o.length;)switch(o[s]){case 44:i+=1,e=o[s+9]&128,n=o[s+9]&7,s+=10,s+=e?3*Math.pow(2,n+1):0,s+=yi(o,s+1)+1;break;case 33:s+=2,s+=yi(o,s);break;case 59:s=o.length;break;default:s=o.length;break}return i>1}function ah(t,o){const e=t.w/o.w,n=t.h/o.h;return e<=1&&n<=1?t:e>n?{w:t.w/e,h:t.h/e}:{w:t.w/n,h:t.h/n}}async function lh(t,o,e,n={}){const s=await io.usingObjectURL(t,io.loadImage),{type:i=t.type,quality:a=.92}=n,[l,d]=await zr(Math.min(o*2,s.naturalWidth),Math.min(e*2,s.naturalHeight)),c=document.createElement("canvas");c.width=l,c.height=d;const p=Rl(c.getContext("2d",{willReadFrequently:!0}),"Could not get canvas context");return p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.drawImage(s,0,0,l,d),new Promise((g,u)=>{c.toBlob(f=>{f?g(f):u(new Error("Could not resize image"))},i,a)})}async function ch(t){return rh(await t.arrayBuffer())}function dh(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function hh(t){const o=new URL(t).host.replace("www.","");for(const e of mo)if(Or(e.hostnames,o)){const n=e.fromEmbedUrl(t);if(n)return{definition:e,url:n,embedUrl:t}}}const ph=t=>t.split("*").map(o=>dh(o)).join(".+"),Or=(t,o)=>!!t.find(e=>{const n=new RegExp(ph(e));return o.match(n)});function uh(t){const o=new URL(t).host.replace("www.","");for(const e of mo)if(Or(e.hostnames,o)){const n=e.toEmbedUrl(t);if(n)return{definition:e,embedUrl:n,url:t}}}function Fr(t){return uh(t)??hh(t)}function Je(t){try{return Fr(t)}catch(o){console.error(o)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Et="  ",ge=class ge{static insertTextFirefox(o,e){o.setRangeText(e,o.selectionStart||0,o.selectionEnd||0,"end"),o.dispatchEvent(new InputEvent("input",{data:e,inputType:"insertText",isComposing:!1}))}static insert(o,e){const n=o.ownerDocument,s=n.activeElement;s!==o&&o.focus(),n.execCommand("insertText",!1,e)||ge.insertTextFirefox(o,e),s===n.body?o.blur():s instanceof HTMLElement&&s!==o&&s.focus()}static set(o,e){o.select(),ge.insert(o,e)}static getSelection(o){const{selectionStart:e,selectionEnd:n}=o;return o.value.slice(e||void 0,n||void 0)}static wrapSelection(o,e,n){const{selectionStart:s,selectionEnd:i}=o,a=ge.getSelection(o);ge.insert(o,e+a+(n??e)),o.selectionStart=(s||0)+e.length,o.selectionEnd=(i||0)+e.length}static replace(o,e,n){let s=0;o.value.replace(e,(...i)=>{const a=s+i[i.length-2],l=i[0].length;o.selectionStart=a,o.selectionEnd=a+l;const d=typeof n=="string"?n:n(...i);return ge.insert(o,d),o.selectionStart=a,s+=d.length-l,d})}static findLineEnd(o,e){const n=o.lastIndexOf(`
`,e-1)+1;return o.charAt(n)!=="	"?e:n+1}static indent(o){var l;const{selectionStart:e,selectionEnd:n,value:s}=o,i=s.slice(e,n),a=(l=/\n/g.exec(i))==null?void 0:l.length;if(a&&a>0){const d=s.lastIndexOf(`
`,e-1)+1,c=o.value.slice(d,n-1),p=c.replace(/^|\n/g,`$&${Et}`),g=p.length-c.length;o.setSelectionRange(d,n-1),ge.insert(o,p),o.setSelectionRange(e+1,n+g)}else ge.insert(o,Et)}static unindent(o){const{selectionStart:e,selectionEnd:n,value:s}=o,i=s.lastIndexOf(`
`,e-1)+1,a=ge.findLineEnd(s,n),l=o.value.slice(i,a),d=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=l.length-d.length;o.setSelectionRange(i,a),ge.insert(o,d);const p=/\t| {1,2}/.exec(s.slice(i,e)),g=p?p[0].length:0,u=e-g;o.setSelectionRange(e-g,Math.max(u,n-c))}static indentCE(o){var d;const e=window.getSelection(),n=o.innerText,s=wn(o)??0,i=wn(o)??0,a=n.slice(s,i),l=(d=/\n/g.exec(a))==null?void 0:d.length;if(l&&l>0){const c=n.lastIndexOf(`
`,s-1)+1,p=n.slice(c,i-1),u=p.replace(/^|\n/g,`$&${Et}`).length-p.length;e&&e.setBaseAndExtent(o,s+1,o,i+u)}else{const c=window.getSelection();o.innerText=n.slice(0,s)+Et+n.slice(s),c==null||c.setBaseAndExtent(o,s+1,o,s+2)}}static unindentCE(o){const e=window.getSelection(),n=o.innerText,s=wn(o)??0,i=wn(o)??0,a=n.lastIndexOf(`
`,s-1)+1,l=ge.findLineEnd(n,i),d=n.slice(a,l),c=d.replace(/(^|\n)(\t| {1,2})/g,"$1"),p=d.length-c.length;if(e){e.setBaseAndExtent(o,a,o,l);const g=/\t| {1,2}/.exec(n.slice(a,s)),u=g?g[0].length:0,f=s-u;e.setBaseAndExtent(o,s-u,o,Math.max(f,i-p))}}static normalizeText(o){return o.replace(ge.fixNewLines,`
`)}static normalizeTextForDom(o){return o.replace(ge.fixNewLines,`
`).split(`
`).map(e=>e||" ").join(`
`)}};h(ge,"fixNewLines",/\r?\n|\r/g);let Rt=ge;function wn(t){if(typeof window.getSelection>"u")return;const o=window.getSelection();if(!o)return;let e=0;if(o.rangeCount!==0){const n=o.getRangeAt(0),s=n.cloneRange();s.selectNodeContents(t),s.setEnd(n.endContainer,n.endOffset),e=s.toString().length}return e}const gh=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function Rr(t){return gh.test(t)}function fh(t){return t.replace(/\t/g,Et)}function mh(t){const o=t.split(`
`);for(;o[0]&&o[0].trim().length===0;)o.shift();let e=1/0;for(const n of o)if(n.trim().length>0){const s=n.length-n.trimStart().length;e=Math.min(e,s)}return o.map(n=>n.slice(e)).join(`
`)}function xh(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Sh(t){return xh(mh(fh(t)))}const sn=(t,o)=>t.length<=o?t:t.substring(0,o-3)+"...";function yh(t,{maxImageDimension:o,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:s},{toasts:i,msg:a}){t.registerExternalAssetHandler("file",async({file:l})=>{const d=l.name;let c=l;const p=n.includes(c.type),g=s.includes(c.type);nn(p||g,`File type not allowed: ${c.type}`),nn(c.size<=e,`File size too big: ${(c.size/1024).toFixed()}kb > ${(e/1024).toFixed()}kb`),c.type==="video/quicktime"&&(c=new Blob([c],{type:"video/mp4"}));let u=p?await io.getImageSize(c):await io.getVideoSize(c);const f=c.type==="image/gif"?await ch(c):g,x=await Nl(await c.arrayBuffer());if(isFinite(o)){const b=ah(u,{w:o,h:o});u!==b&&(c.type==="image/jpeg"||c.type==="image/png")&&(u=b)}(c.type==="image/jpeg"||c.type==="image/png")&&(c=await lh(c,u.w,u.h,{type:c.type,quality:.92}));const S=It.createId(x);return It.create({id:S,type:p?"image":"video",typeName:"asset",props:{name:d,src:await _t.blobToDataUrl(c),w:u.w,h:u.h,mimeType:c.type,isAnimated:f}})}),t.registerExternalAssetHandler("url",async({url:l})=>{var c,p,g;let d;try{const f=await(await fetch(l,{method:"GET",mode:"no-cors"})).text(),x=new DOMParser().parseFromString(f,"text/html");d={image:((c=x.head.querySelector('meta[property="og:image"]'))==null?void 0:c.getAttribute("content"))??"",title:((p=x.head.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))??sn(l,32),description:((g=x.head.querySelector('meta[property="og:description"]'))==null?void 0:g.getAttribute("content"))??""}}catch(u){console.error(u),i.addToast({title:a("assets.url.failed"),severity:"error"}),d={image:"",title:sn(l,32),description:""}}return{id:It.createId(ls(l)),typeName:"asset",type:"bookmark",props:{src:l,description:d.description,image:d.image,title:d.title},meta:{}}}),t.registerExternalContentHandler("svg-text",async({point:l,text:d})=>{const c=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageCenter()),p=new DOMParser().parseFromString(d,"image/svg+xml").querySelector("svg");if(!p)throw new Error("No <svg/> element present");let g=parseFloat(p.getAttribute("width")||"0"),u=parseFloat(p.getAttribute("height")||"0");if(!(g&&u)){document.body.appendChild(p);const x=p.getBoundingClientRect();document.body.removeChild(p),g=x.width,u=x.height}const f=await t.getAssetForExternalContent({type:"file",file:new File([d],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");bi(t,[f],c)}),t.registerExternalContentHandler("embed",({point:l,url:d,embed:c})=>{const p=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageCenter()),{width:g,height:u}=c,f=ne(),x={id:f,type:"embed",x:p.x-(g||450)/2,y:p.y-(u||450)/2,props:{w:g,h:u,url:d}};t.createShapes([x]).select(f)}),t.registerExternalContentHandler("files",async({point:l,files:d})=>{const c=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageCenter()),p=new m(c.x,c.y),g=[];await Promise.all(d.map(async(u,f)=>{if(u.size>e)return console.warn(`File size too big: ${(u.size/1024).toFixed()}kb > ${(e/1024).toFixed()}kb`),null;if(!u.type)throw new Error("No mime type");if(!n.concat(s).includes(u.type))return console.warn(`${u.name} not loaded - Extension not allowed.`),null;try{const x=await t.getAssetForExternalContent({type:"file",file:u});if(!x)throw Error("Could not create an asset");g[f]=x}catch(x){return i.addToast({title:a("assets.files.upload-failed"),severity:"error"}),console.error(x),null}})),bi(t,je(g),p)}),t.registerExternalContentHandler("text",async({point:l,text:d})=>{const c=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageCenter()),p=t.getShapeUtil("text").getDefaultProps(),g=Sh(d),u=t.getOnlySelectedShape();if(u&&"text"in u.props){t.updateShapes([{id:u.id,type:u.type,props:{text:g}}]);return}let f,x,S,v="middle";const b=g.split(`
`).length>1,w=Rr(g);b&&(v=b?w?"end":"start":"middle");const E=t.textMeasure.measureText(g,{...he,fontFamily:Fe[p.font],fontSize:Ft[p.size],maxWidth:null}),C=Math.min(b?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(E.w>C){const y=t.textMeasure.measureText(g,{...he,fontFamily:Fe[p.font],fontSize:Ft[p.size],maxWidth:C});f=y.w,x=y.h,S=!1,v=w?"end":"start"}else f=E.w,x=E.h,S=!0;c.y-x/2<t.getViewportPageBounds().minY+40&&(c.y=t.getViewportPageBounds().minY+40+x/2),t.createShapes([{id:ne(),type:"text",x:c.x-f/2,y:c.y-x/2,props:{text:g,align:v,autoSize:S,w:f}}])}),t.registerExternalContentHandler("url",async({point:l,url:d})=>{const c=Je(d);if(c)return t.putExternalContent({type:"embed",url:c.url,point:l,embed:c.definition});const p=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageCenter()),g=It.createId(ls(d)),u=bh(t,d,p);let f=t.getAsset(g),x=!1;if(!f){x=!0;try{const S=await t.getAssetForExternalContent({type:"url",url:d});if(!S)throw Error("Could not create an asset");f=S}catch{i.addToast({title:a("assets.url.failed"),severity:"error"});return}}t.batch(()=>{x&&t.createAssets([f]),t.updateShapes([{id:u.id,type:u.type,props:{assetId:f.id}}])})})}async function bi(t,o,e){if(!o.length)return[];const n=m.From(e),s=[];for(const i of o)switch(i.type){case"bookmark":{s.push({id:ne(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:i.id,url:i.props.src}}),n.x+=300;break}case"image":{s.push({id:ne(),type:"image",x:n.x-i.props.w/2,y:n.y-i.props.h/2,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),n.x+=i.props.w;break}case"video":s.push({id:ne(),type:"video",x:n.x-i.props.w/2,y:n.y-i.props.h/2,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),n.x+=i.props.w}return t.batch(()=>{const i=o.filter(a=>!t.getAsset(a.id));i.length&&t.createAssets(i),t.createShapes(s).select(...s.map(a=>a.id)),Nr(t,e)}),s.map(i=>i.id)}function Nr(t,o){const e=t.getViewportPageBounds();let n=t.getSelectionPageBounds();if(n){const s=n.center.sub(o);t.updateShapes(t.getSelectedShapes().map(i=>{const a=t.getShapeParentTransform(i).decompose().rotation,l=m.Rot(s,-a);return{id:i.id,type:i.type,x:i.x-l.x,y:i.y-l.y}}))}n=t.getSelectionPageBounds(),n&&!e.contains(n)&&t.zoomToSelection()}function bh(t,o,e){const n={id:ne(),type:"bookmark",x:e.x-150,y:e.y-160,opacity:1,props:{assetId:null,url:o}};return t.batch(()=>{t.createShapes([n]).select(n.id),Nr(t,e)}),t.getShape(n.id)}var Wo;let wh=(Wo=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")});h(this,"onKeyUp",e=>{var n;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const s=this.editor.getOnlySelectedShape();s&&this.editor.getShapeUtil(s).canEdit(s)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(s.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:s}))}})}},h(Wo,"id","idle"),Wo);var Go;let vh=(Go=class extends N{constructor(){super(...arguments);h(this,"shape");h(this,"markId","");h(this,"onEnter",()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:n=>!n.isLocked&&this.editor.getShapeUtil(n).canBind(n),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()});h(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});h(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>e.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});h(this,"onPointerUp",()=>{this.cancel()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()});h(this,"preciseTimeout",-1);h(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var p,g;const{originPagePoint:e}=this.editor.inputs,n=ne();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"arrow",x:e.x,y:e.y}]);const s=this.editor.getShape(n);if(!s)throw Error("expected shape");const i=this.editor.getShapeHandles(s);if(!i)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),l=this.shape,d=i.find(u=>u.id==="start"),c=(p=a.onHandleDrag)==null?void 0:p.call(a,s,{handle:{...d,x:0,y:0},isPrecise:!0,initial:l});if(c){const u=(g=c.props)==null?void 0:g.start;(u==null?void 0:u.type)==="binding"&&this.editor.setHintingShapes([u.boundShapeId]),this.editor.updateShapes([c],{squashing:!0})}this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){var i,a,l;const e=this.shape;if(!e)throw Error("expected shape");const n=this.editor.getShapeHandles(e);if(!n)throw Error("expected handles for arrow");const s={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{const d=this.editor.getShapeUtil("arrow"),c=this.shape,p=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),g=n.find(f=>f.id==="end"),u=(i=d.onHandleDrag)==null?void 0:i.call(d,s,{handle:{...g,x:p.x,y:p.y},isPrecise:!1,initial:c});if(u){const f=(a=u.props)==null?void 0:a.end;(f==null?void 0:f.type)==="binding"&&this.editor.setHintingShapes([f.boundShapeId]),this.editor.updateShapes([u],{squashing:!0})}}{const d=this.editor.getShapeUtil("arrow"),c=this.shape,p=n.find(u=>u.id==="start"),g=(l=d.onHandleDrag)==null?void 0:l.call(d,s,{handle:{...p,x:0,y:0},isPrecise:this.didTimeout,initial:c});g&&this.editor.updateShapes([g],{squashing:!0})}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},h(Go,"id","pointing"),Go);class _n extends N{constructor(){super(...arguments);h(this,"shapeType","arrow")}}h(_n,"id","arrow"),h(_n,"initial","idle"),h(_n,"children",()=>[wh,vh]);class Gs extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"initialShape");h(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");h(this,"util",this.editor.getShapeUtil(this.shapeType));h(this,"isPen",!1);h(this,"segmentMode","free");h(this,"didJustShiftClickToExtendPreviousShapeLine",!1);h(this,"pagePointWhereCurrentSegmentChanged",{});h(this,"pagePointWhereNextSegmentChanged",null);h(this,"lastRecordedPoint",{});h(this,"mergeNextPoint",!1);h(this,"currentLineLength",0);h(this,"canDraw",!1);h(this,"markId",null);h(this,"onEnter",e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});h(this,"onPointerMove",()=>{const{inputs:e}=this.editor;if(this.isPen!==e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?m.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())});h(this,"onKeyDown",e=>{if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()});h(this,"onKeyUp",e=>{if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()});h(this,"onExit",()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(e,n){if(!this.canClose())return!1;const s=le[n],i=e[0].points[0],a=e[e.length-1],l=a.points[a.points.length-1];return i!==l&&this.currentLineLength>s*4&&m.DistMin(i,l,s*2)}startShape(){const{inputs:{originPagePoint:e,isPen:n}}=this.editor;this.markId="draw start "+Ae(),this.editor.mark(this.markId),this.isPen=n;const s=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const l=ye(a.props.segments);if(!l)throw Error("Expected a previous segment!");const d=ye(l.points);if(!d)throw Error("Expected a previous point!");const{x:c,y:p}=this.editor.getPointInShapeSpace(a,e).toFixed(),g=this.isPen?this.info.point.z*1.25:.5,u={type:this.segmentMode,points:[{x:d.x,y:d.y,z:+g.toFixed(2)},{x:c,y:p,z:+g.toFixed(2)}]},f=Oe.applyToPoint(this.editor.getShapePageTransform(a.id),d);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const x=[...a.props.segments,u];this.currentLineLength<le[a.props.size]*4&&(this.currentLineLength=this.getLineLength(x));const S={id:a.id,type:this.shapeType,props:{segments:x}};this.canClose()&&(S.props.isClosed=this.getIsClosed(x,a.props.size)),this.editor.updateShapes([S]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const i=ne();this.editor.createShapes([{id:i,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){const{initialShape:e}=this,{inputs:n}=this.editor;if(!e)return;const{id:s,props:{size:i}}=e,a=this.editor.getShape(s);if(!a)return;const{segments:l}=a.props,{x:d,y:c,z:p}=this.editor.getPointInShapeSpace(a,n.currentPagePoint).toFixed(),g={x:d,y:c,z:this.isPen?+(p*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:u}=this;if(u===null)throw Error("We should have a point where the segment changed");if(m.Dist2(u,n.currentPagePoint)>pi){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const x=ye(l);if(!x)throw Error("Expected a previous segment!");const S=ye(x.points);if(!S)throw Error("Expected a previous last point!");let v;const b=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(x.type==="straight"){this.currentLineLength+=m.Dist(S,b),v={type:"straight",points:[{...S},b]};const E=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=Oe.applyToPoint(E,S)}else v={type:"straight",points:[b,g]};const w={id:s,type:this.shapeType,props:{segments:[...l,v]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(l,i)),this.editor.updateShapes([w],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:u}=this;if(u===null)throw Error("We should have a point where the segment changed");if(m.Dist2(u,n.currentPagePoint)>pi){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const x=l.slice(),S=x[x.length-1],v=ye(S.points);if(!v)throw Error("No previous point!");const b={type:"free",points:[...m.PointsBetween(v,g,6).map(C=>C.toFixed().toJson())]},w=[...x,b];this.currentLineLength<le[a.props.size]*4&&(this.currentLineLength=this.getLineLength(w));const E={id:s,type:this.shapeType,props:{segments:w}};this.canClose()&&(E.props.isClosed=this.getIsClosed(w,i)),this.editor.updateShapes([E],{squashing:!0})}break}case"straight":{const u=l.slice(),f=u[u.length-1],{pagePointWhereCurrentSegmentChanged:x}=this,{ctrlKey:S,currentPagePoint:v}=this.editor.inputs;if(!x)throw Error("We should have a point where the segment changed");let b,w=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(w=!S,this.didJustShiftClickToExtendPreviousShapeLine=!1):w=!S;let E=this.editor.getPointInShapeSpace(a,v).toFixed().toJson(),C=!1,y;if((this.editor.user.getIsSnapMode()?!S:S)&&u.length>2){let _,D=8/this.editor.getZoomLevel();for(let M=0,$=l.length-2;M<$;M++){const z=l[M];if(!z)break;if(z.type==="free")continue;const O=z.points[0],W=ye(z.points);if(!(O&&W))continue;const R=m.NearestPointOnLineSegment(O,W,E);if(m.DistMin(R,E,D)){_=R.toFixed().toJson(),D=m.Dist(R,E),y=z;break}}_&&(C=!0,E=_)}if(C&&y){const _=this.editor.getShapePageTransform(a),D=y.points[0],M=ye(y.points);if(!M)throw Error("Expected a last point!");const $=Oe.applyToPoint(_,D),z=Oe.applyToPoint(_,M),O=Oe.applyToPoint(_,E);this.editor.snaps.setIndicators([{id:Ae(),type:"points",points:[$,O,z]}])}else{if(this.editor.snaps.clearIndicators(),w){const _=m.Angle(x,v),M=ao(_,24)-_;b=m.RotWith(v,x,M)}else b=v;E=this.editor.getPointInShapeSpace(a,b).toFixed().toJson()}this.currentLineLength+=m.Dist(f.points[0],E),u[u.length-1]={...f,type:"straight",points:[f.points[0],E]};const T={id:s,type:this.shapeType,props:{segments:u}};this.canClose()&&(T.props.isClosed=this.getIsClosed(l,i)),this.editor.updateShapes([T],{squashing:!0});break}case"free":{const u=l.slice(),f=u[u.length-1],x=[...f.points];if(x.length&&this.mergeNextPoint){const{z:v}=x[x.length-1];x[x.length-1]={x:g.x,y:g.y,z:v?Math.max(v,g.z):g.z}}else this.currentLineLength+=m.Dist(x[x.length-1],g),x.push(g);u[u.length-1]={...f,points:x},this.currentLineLength<le[a.props.size]*4&&(this.currentLineLength=this.getLineLength(u));const S={id:s,type:this.shapeType,props:{segments:u}};if(this.canClose()&&(S.props.isClosed=this.getIsClosed(u,i)),this.editor.updateShapes([S],{squashing:!0}),x.length>500){this.editor.updateShapes([{id:s,type:this.shapeType,props:{isComplete:!0}}]);const v=ne();this.editor.createShapes([{id:v,type:this.shapeType,x:ro(n.currentPagePoint.x),y:ro(n.currentPagePoint.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(p*1.25).toFixed():.5}]}]}}]),this.initialShape=We(this.editor.getShape(v)),this.mergeNextPoint=!1,this.lastRecordedPoint=n.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let n=0;for(const s of e)for(let i=0;i<s.points.length-1;i++){const a=s.points[i],l=s.points[i+1];n+=m.Dist2(l,a)}return Math.sqrt(n)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}h(Gs,"id","drawing");var Ko;let Br=(Ko=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("drawing",e)});h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(Ko,"id","idle"),Ko);class An extends N{constructor(){super(...arguments);h(this,"shapeType","draw");h(this,"onExit",()=>{const e=this.children.drawing;e.initialShape=void 0})}}h(An,"id","draw"),h(An,"initial","idle"),h(An,"children",()=>[Br,Gs]);class Ss extends Bl{constructor(){super(...arguments);h(this,"shapeType","frame");h(this,"onCreate",e=>{if(!e)return;const n=this.editor.getShapePageBounds(e),s=[],i=this.editor.getShapeAncestors(e).map(a=>a.id);this.editor.getSortedChildIdsForParent(e.parentId).map(a=>{const l=this.editor.getShape(a);if(!l||l.id===e.id||l.isLocked)return;const d=this.editor.getShapePageBounds(l);d&&n.contains(d)&&kh(l,i,e)&&s.push(l.id)}),this.editor.reparentShapes(s,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}h(Ss,"id","frame"),h(Ss,"initial","idle");function kh(t,o,e){return o.includes(t.id)?!1:t.parentId===e.parentId}var Vo;let Ph=(Vo=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});h(this,"onKeyUp",e=>{var n;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const s=this.editor.getOnlySelectedShape();s&&this.editor.getShapeUtil(s).canEdit(s)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(s.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:s}))}});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(Vo,"id","idle"),Vo);var Yo;let Ch=(Yo=class extends N{constructor(){super(...arguments);h(this,"markId","");h(this,"onPointerUp",()=>{this.complete()});h(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,s=ne();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:"geo",x:n.x,y:n.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Ue)}}]).select(s).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs,n=ne();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Ue),w:1,h:1}}]);const s=this.editor.getShape(n);if(!s)return;const i=s.props.geo==="star"?new Z(0,0,200,190):s.props.geo==="cloud"?new Z(0,0,300,180):new Z(0,0,200,200),a=i.center,l=this.editor.getShapeParentTransform(s);l&&a.rot(-l.rotation()),this.editor.select(n),this.editor.updateShapes([{id:s.id,type:"geo",x:s.x-a.x,y:s.y-a.y,props:{geo:this.editor.getStyleForNextShape(Ue),w:i.width,h:i.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},h(Yo,"id","pointing"),Yo);class $n extends N{constructor(){super(...arguments);h(this,"shapeType","geo")}}h($n,"id","geo"),h($n,"initial","idle"),h($n,"children",()=>[Ph,Ch]);class Dn extends N{constructor(){super(...arguments);h(this,"shapeType","highlight");h(this,"onExit",()=>{const e=this.children.drawing;e.initialShape=void 0})}}h(Dn,"id","highlight"),h(Dn,"initial","idle"),h(Dn,"children",()=>[Br,Gs]);var Zo;let jh=(Zo=class extends N{constructor(){super(...arguments);h(this,"shapeId","");h(this,"onEnter",e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})});h(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(Zo,"id","idle"),Zo);const wi=2;var qo;let Ih=(qo=class extends N{constructor(){super(...arguments);h(this,"shape",{});h(this,"markId");h(this,"onEnter",e=>{const{inputs:n}=this.editor,{currentPagePoint:s}=n;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&n.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const a=this.editor.getShapeHandles(this.shape);if(!a)return;const l=a.filter(f=>f.type==="vertex").sort(xo),d=l[l.length-1],c=l[l.length-2],p=Oe.applyToPoint(this.editor.getShapeParentTransform(this.shape),new m(this.shape.x,this.shape.y)),g=m.Sub(s,p).addXY(.1,.1),u=We(this.shape.props.points);if(m.DistMin(d,c,wi)||m.DistMin(g,d,wi))u[d.id]={id:d.id,index:d.index,x:g.x,y:g.y};else{const f=$s(d.index);u[f]={id:f,index:f,x:g.x,y:g.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:u}}])}else{const a=ne();this.markId=`creating:${a}`,this.editor.mark(this.markId),this.editor.createShapes([{id:a,type:"line",x:s.x,y:s.y}]),this.editor.select(a),this.shape=this.editor.getShape(a)}});h(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const n=ye(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...n,x:n.x-.1,y:n.y-.1},onInteractionEnd:"line"})}});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},h(qo,"id","pointing"),qo);class Ln extends N{constructor(){super(...arguments);h(this,"shapeType","line")}}h(Ln,"id","line"),h(Ln,"initial","idle"),h(Ln,"children",()=>[jh,Ih]);var Xo;let Th=(Xo=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(Xo,"id","idle"),Xo);function J(t,o){var s;const e=new Set;for(const i of o){const a=t.getShape(i);if(!a)continue;t.getShapeUtil(a).onDragShapesOut&&e.add(a);const l=t.getShape(a.parentId);l&&t.getShapeUtil(l).onDragShapesOut&&e.add(l)}const n=new Map;for(const i of e){const a=Ur(t,i);a.length&&n.set(i,a)}for(const[i,a]of n){const l=t.getShapeUtil(i),d=je(a.map(c=>t.getShape(c)));(s=l.onDragShapesOut)==null||s.call(l,i,d)}}function Ur(t,o){const e=t.getSortedChildIdsForParent(o.id);if(e.length===0)return[];const n=t.getShapePageBounds(o);if(!n)return[];let s,i,a;const l=[];for(const d of e){const c=t.getShapePageBounds(d);if(!c)continue;if(!n.includes(c)){l.push(d);continue}s??(s=t.getShapeGeometry(o)),i??(i=t.getShapePageTransform(o)),a??(a=i.applyToPoints(s.vertices));const p=t.getShapePageTransform(d).clone().invert().applyToPoints(a),{vertices:g,isClosed:u}=t.getShapeGeometry(d);if(!g.some(f=>Ht(f,p))){if(u){if(lr(p,g))continue}else if(Ul(p,g))continue;l.push(d)}}return l}function po(t,o,e=!1){t.select(o),t.setEditingShape(o),t.setCurrentTool("select.editing_shape",{target:"shape",shape:o}),e&&t.emit("select-all-text",{shapeId:o.id}),Hr(t)}const Eh=16;function Hr(t){const o=t.getSelectionPageBounds(),e=t.getViewportPageBounds();if(o&&!e.contains(o)){const n=o.clone().expandBy(Eh/t.getZoomLevel()).expand(e),s=e.clone().translate({x:(n.center.x-e.center.x)*2,y:(n.center.y-e.center.y)*2});t.zoomToBounds(s,{duration:Be,inset:0})}}const ct=20,Mh=0,K=200,Ks={x:K/2,y:K/2},Wr=10,_h={a1:new m(K*.5,K*-.5-ct),a2:new m(K*1.5+ct,K*.5),a3:new m(K*.5,K*1.5+ct),a4:new m(K*-.5-ct,K*.5)};function Gr(t,o,e,n){return Object.fromEntries(Object.entries(_h).map(([s,i],a)=>{const l=i.clone();return a===0&&n?l.y-=n:a===2&&e&&(l.y+=e),[s,l.rot(o).add(t)]}))}function Kr(t,o,e){const n=new Set(t.getSelectedShapeIds()),s=(K+ct+e)**2,i=new Map,a=[];for(const c of t.getCurrentPageShapes()){if(!t.isShapeOfType(c,"note")||n.has(c.id))continue;const p=t.getShapePageTransform(c.id);o===p.rotation()&&(i.set(c,t.getShapePageBounds(c).center),a.push(...Object.values(Gr(p.point(),o,c.props.growY,e))))}const l=a.length;let d;for(const[c,p]of i)for(let g=0;g<l;g++)d=a[g],d&&(m.Dist2(p,d)>s||t.isPointInShape(c,d)&&(a[g]=void 0));return je(a)}function Vr(t,o,e,n,s=!1){let i;const a=t.getCurrentPageShapesSorted(),l=K+ct**2;for(let d=a.length-1;d>=0;d--){const c=a[d];if(c.type==="note"&&c.id!==o.id){const p=t.getShapePageBounds(c);if(p&&m.Dist2(p.center,e)<l&&t.isPointInShape(c,e)){i=c;break}}}if(t.complete(),!i||s){t.mark("creating note shape");const d=ne();t.createShape({id:d,type:"note",x:e.x,y:e.y,rotation:n,opacity:o.opacity,props:{...o.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const c=t.getShape(d),p=t.getPointInParentSpace(c,m.Sub(e,m.Rot(Ks,n)));t.updateShape({id:d,type:"note",x:p.x,y:p.y}),i=t.getShape(d)}return Hr(t),i}var Jo;let Ah=(Jo=class extends N{constructor(){super(...arguments);h(this,"dragged",!1);h(this,"info",{});h(this,"wasFocusedOnEnter",!1);h(this,"markId","");h(this,"shape",{});h(this,"onEnter",()=>{const{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){const n=ne();this.markId=`creating:${n}`,e.mark(this.markId);const s=this.editor.inputs.originPagePoint.clone(),i=vi(this.editor,s);i&&s.sub(i),this.shape=ki(this.editor,n,s)}});h(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const n=ne(),s=this.editor.inputs.originPagePoint.clone(),i=vi(this.editor,s);i&&s.sub(i),this.shape=ki(this.editor,n,s)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}});h(this,"onPointerUp",()=>{this.complete()});h(this,"onInterrupt",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},h(Jo,"id","pointing"),Jo);function vi(t,o){let e=Wr/t.getZoomLevel(),n;for(const s of Kr(t,0,0)){const i=m.Sub(o,s),a=i.len();a<e&&(e=a,n=i)}return n}function ki(t,o,e){t.createShape({id:o,type:"note",x:e.x,y:e.y}).select(o);const n=t.getShape(o),s=t.getShapeGeometry(n).bounds;return t.updateShapes([{id:o,type:"note",x:n.x-s.width/2,y:n.y-s.height/2}]),t.getShape(o)}class zn extends N{constructor(){super(...arguments);h(this,"shapeType","note")}}h(zn,"id","note"),h(zn,"initial","idle"),h(zn,"children",()=>[Th,Ah]);function $h(t){const o=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:Qe/t.getZoomLevel(),renderingOnly:!0});if(!o)return t.setHoveredShape(null);let e;const n=t.getOutermostSelectableShape(o);return n===o||n.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(n.id)?e=o:e=n,t.setHoveredShape(e.id)}const Dt=Hl($h,32);var Qo;let Dh=(Qo=class extends N{constructor(){super(...arguments);h(this,"onPointerMove",e=>{switch(e.target){case"shape":case"canvas":Dt(this.editor)}});h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});h(this,"onKeyDown",e=>{var n;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const s=this.editor.getOnlySelectedShape();s&&this.editor.getShapeUtil(s).canEdit(s)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(s.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...e,target:"shape",shape:s}))}});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(Qo,"id","idle"),Qo);var es;let Lh=(es=class extends N{constructor(){super(...arguments);h(this,"shape");h(this,"markId","");h(this,"onExit",()=>{this.editor.setHintingShapes([])});h(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:n}}=this.editor,s=ne();if(this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:"text",x:n.x,y:n.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(s),this.shape=this.editor.getShape(s),!this.shape)return;const{shape:i}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.cancel()});h(this,"onCancel",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const e=ne(),{x:n,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:n,y:s,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}},h(es,"id","pointing"),es);class On extends N{constructor(){super(...arguments);h(this,"shapeType","text")}}h(On,"id","text"),h(On,"initial","idle"),h(On,"children",()=>[Dh,Lh]);const zh=[On,An,$n,zn,Ln,Ss,_n,Dn];function ie(){return tt({isDarkMode:Ds()})}const re=fe.memo(function({theme:o,d:e,color:n,fill:s}){switch(s){case"none":return null;case"solid":return r.jsx("path",{fill:o[n].semi,d:e});case"semi":return r.jsx("path",{fill:o.solid,d:e});case"pattern":return r.jsx(Oh,{theme:o,color:n,fill:s,d:e})}}),Oh=function({d:o,color:e,theme:n}){const s=A(),i=Wl(),a=L("zoomLevel",()=>s.getZoomLevel(),[s]),l=Math.ceil(a),d=s.getZoomLevel()<=.18;return r.jsxs(r.Fragment,{children:[r.jsx("path",{fill:n[e].pattern,d:o}),r.jsx("path",{fill:i?`url(#${lo[`1_${n.id}`]})`:d?n[e].semi:`url(#${lo[`${l}_${n.id}`]})`,d:o})]})};function Fh(t){return t.replace(/\s/g," ")}function ys(t,o,e){const{padding:n=0}=e;if(o.length===0)return null;const s=Z.From(o[0].box);for(const{box:c}of o)s.union(c);const i=n+(e.offsetX??0),a=(e.offsetY??0)+e.fontSize/2+(e.verticalTextAlign==="start"?n:e.verticalTextAlign==="end"?e.height-n-s.height:(Math.ceil(e.height)-s.height)/2);let l=null;const d=[];for(const{text:c,box:p}of o)l!==null&&p.y>l&&d.push(r.jsx("tspan",{alignmentBaseline:"mathematical",x:i,y:p.y+a,children:`
`},d.length)),d.push(r.jsx("tspan",{alignmentBaseline:"mathematical",x:p.x+i,y:p.y+a,children:Fh(c)},d.length)),l=p.y;return r.jsx("text",{fontSize:e.fontSize,fontFamily:e.fontFamily,fontStyle:e.fontFamily,fontWeight:e.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,children:d})}function Rh(t,o,e,n){if((t==="start-legacy"||t==="end-legacy")&&e.length!==0){const s=Z.From(e[0].box);for(const{box:i}of e)s.union(i);if(t==="start-legacy")return(n-2*o-s.width)/2;if(t==="end-legacy")return-(n-2*o-s.width)/2}}function Nh(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function ko({fontSize:t,font:o,align:e,verticalAlign:n,text:s,labelColor:i,bounds:a,padding:l=16,stroke:d=!0}){const c=A(),p=ie(),g={fontSize:t,fontFamily:cr[o],textAlign:e,verticalTextAlign:n,width:Math.ceil(a.width),height:Math.ceil(a.height),padding:l,lineHeight:he.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:i,stroke:void 0,strokeWidth:void 0},u=c.textMeasure.measureTextSpans(s,g),f=Rh(e,l,u,a.width);f&&(g.offsetX=f),g.offsetX+=a.x,g.offsetY+=a.y;const x=ys(c,u,g);let S=null;return d&&(g.fill=p.background,g.stroke=p.background,g.strokeWidth=2,S=ys(c,u,g)),r.jsxs(r.Fragment,{children:[S,x]})}function Nt(t){return{key:`${Lt.id}:${t}`,getElement:async()=>{const o=Bh(t);if(!o)return null;const e=o.$$_url,n=o.$$_fontface;if(!e||!n)return null;const s=await(await fetch(e)).blob(),i=await _t.blobToDataUrl(s),a=n.replace(e,i);return r.jsx("style",{children:a})}}}function Bh(t){const o=cr[t];for(const e of document.fonts)if(o.includes(e.family))return e;return null}function Vs(t){return{key:`${Lt.id}:${t}`,getElement:async()=>t!=="pattern"?null:r.jsx(Uh,{})}}function Uh(){const t=ie(),o=8/12;return r.jsxs(r.Fragment,{children:[r.jsxs("mask",{id:"hash_pattern_mask",children:[r.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),r.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[r.jsx("line",{x1:o*1,y1:o*3,x2:o*3,y2:o*1}),r.jsx("line",{x1:o*5,y1:o*7,x2:o*7,y2:o*5}),r.jsx("line",{x1:o*9,y1:o*11,x2:o*11,y2:o*9})]})]}),r.jsx("pattern",{id:lo[`1_${t.id}`],width:"8",height:"8",patternUnits:"userSpaceOnUse",children:r.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:"url(#hash_pattern_mask)"})})]})}function Ys(){return{key:`${Lt.id}:pattern`,component:Gh}}const Qt=8,Pi=(t,o,e)=>new Promise((n,s)=>{const i=Qt*o*t,a=document.createElement("canvas");a.width=i,a.height=i;const l=a.getContext("2d");if(!l)return;l.fillStyle=e?"#212529":"#f8f9fa",l.fillRect(0,0,i,i),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*o*t;const d=8/12,c=p=>p*o*t;l.beginPath(),l.moveTo(c(d*1),c(d*3)),l.lineTo(c(d*3),c(d*1)),l.moveTo(c(d*5),c(d*7)),l.lineTo(c(d*7),c(d*5)),l.moveTo(c(d*9),c(d*11)),l.lineTo(c(d*11),c(d*9)),l.stroke(),a.toBlob(p=>{!p||ht.throwToBlob.get()?s():n(p)})}),Ci=(t,o)=>{const e=document.createElement("canvas");e.width=t[0],e.height=t[1];const n=e.getContext("2d");return n?(o(n),e.toDataURL()):""},Hh=()=>{const t=[];for(let o=1;o<=Math.ceil(dr);o++){const e=Ci([1,1],s=>{s.fillStyle=ui.lightMode.black.semi,s.fillRect(0,0,1,1)}),n=Ci([1,1],s=>{s.fillStyle=ui.darkMode.black.semi,s.fillRect(0,0,1,1)});t.push({zoom:o,url:e,darkMode:!1}),t.push({zoom:o,url:n,darkMode:!0})}return t};function Wh(){const o=A().getInstanceState().devicePixelRatio,[e,n]=k.useState(!1),s=k.useMemo(()=>Hh(),[]),[i,a]=k.useState(s);return k.useEffect(()=>{const d=[];for(let p=1;p<=Math.ceil(dr);p++)d.push(Pi(o,p,!1).then(g=>({zoom:p,url:URL.createObjectURL(g),darkMode:!1}))),d.push(Pi(o,p,!0).then(g=>({zoom:p,url:URL.createObjectURL(g),darkMode:!0})));let c=!1;return Promise.all(d).then(p=>{c||(a(p),n(!0))}),()=>{c=!0,n(!1)}},[o]),{defs:r.jsx(r.Fragment,{children:i.map(d=>{const c=d.zoom+(d.darkMode?"_dark":"_light");return r.jsx("pattern",{id:lo[c],width:Qt,height:Qt,patternUnits:"userSpaceOnUse",children:r.jsx("image",{href:d.url,width:Qt,height:Qt})},c)})}),isReady:e}}function Gh(){const t=A(),o=k.useRef(null),{defs:e,isReady:n}=Wh();return k.useEffect(()=>{if(n&&t.environment.isSafari){const s=Yr(o.current);s&&requestAnimationFrame(()=>{s.style.display="none",requestAnimationFrame(()=>{s.style.display=""})})}},[t,n]),r.jsx("g",{ref:o,"data-testid":n?"ready-pattern-fill-defs":void 0,children:e})}function Yr(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?Yr(t.parentElement):null}function Ge(t,o,e={}){const{closed:n=!1,snap:s=1,start:i="outset",end:a="outset",lengthRatio:l=2,style:d="dashed"}=e;let c=0,p=0,g=1,u=0,f=0;switch(d){case"dashed":{g=1,c=Math.min(o*l,t/4);break}case"dotted":{g=100,c=o/g;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return n||(i==="outset"?(t+=c/2,f+=c/2):i==="skip"&&(t-=c,f-=c),a==="outset"?t+=c/2:a==="skip"&&(t-=c)),p=Math.floor(t/c/(2*g)),p-=p%s,p<3&&d==="dashed"?t/o<5?(c=t,p=1,u=0):(c=t*.333,u=t*.333):(p=Math.max(p,3),c=t/p/(2*g),n?(f=c/2,u=(t-p*c)/p):u=(t-p*c)/Math.max(1,p-1)),{strokeDasharray:[c,u].join(" "),strokeDashoffset:f.toString()}}const ji=new WeakMap;function Zs(t,o){const e=ji.get(o);if(e)return e;const n=t.getArrowInfo(o);let s=0,i=0;const a=n.isStraight?new pr({start:m.From(n.start.point),end:m.From(n.end.point)}):new ur({center:m.Cast(n.handleArc.center),radius:n.handleArc.radius,start:m.Cast(n.start.point),end:m.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(o.props.text.trim()){const d=a.bounds,{w:c,h:p}=t.textMeasure.measureText(o.props.text,{...he,fontFamily:Fe[o.props.font],fontSize:lt[o.props.size],maxWidth:null});if(s=c,i=p,d.width>d.height){s=Math.max(Math.min(c,64),Math.min(d.width-64,c));const{w:g,h:u}=t.textMeasure.measureText(o.props.text,{...he,fontFamily:Fe[o.props.font],fontSize:lt[o.props.size],maxWidth:s});s=g,i=u}if(s>16*lt[o.props.size]){s=16*lt[o.props.size];const{w:g,h:u}=t.textMeasure.measureText(o.props.text,{...he,fontFamily:Fe[o.props.font],fontSize:lt[o.props.size],maxWidth:s});s=g,i=u}}const l=new m(s,i).addScalar(th*2);return ji.set(o,l),l}function Zr(t,o){const e=le[o.props.size];return eh+(e-le.s)*2+(e===le.xl?20:0)}function Kh(t,o,e){const n=Zs(t,o),s=Zr(t,o),i=m.Nudge(e.start.point,e.end.point,s),a=m.Nudge(e.end.point,e.start.point,s),l=hr(i,a,Z.FromCenter(e.middle,n).corners);if(!l||l.length!==2)return{start:.5,end:.5};let[d,c]=l;m.Dist2(d,i)>m.Dist2(c,i)&&([c,d]=l);const p=i.add(m.Sub(e.middle,d)),g=a.add(m.Sub(e.middle,c)),u=m.Dist(e.start.point,p)/e.length,f=m.Dist(e.start.point,g)/e.length;return{start:u,end:f}}function Vh(t,o,e){const n=Zs(t,o),s=Zr(t,o),i=Math.sign(o.props.bend),a=s/e.handleArc.radius*i,l=m.Angle(e.bodyArc.center,e.start.point)-a,d=m.Angle(e.bodyArc.center,e.end.point)+a,c=an(e.bodyArc.center,e.bodyArc.radius,l),p=an(e.bodyArc.center,e.bodyArc.radius,d),g=[],u=Ii(e.bodyArc.center,e.bodyArc.radius,l,d,i,Z.FromCenter(c,n).corners);g.push(new ae({points:Z.FromCenter(c,n).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=Ii(e.bodyArc.center,e.bodyArc.radius,l,d,i,Z.FromCenter(p,n).corners);g.push(new ae({points:Z.FromCenter(p,n).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const T of[...u??[],...f??[],c,p])g.push(new Ls({x:T.x-3,y:T.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const x=(u&&Ti(e.start.point,u))??e.middle,S=(f&&Ti(e.end.point,f))??e.middle,v=m.Angle(e.bodyArc.center,e.start.point),b=m.Angle(e.bodyArc.center,e.end.point),w=m.Angle(e.bodyArc.center,x),E=m.Angle(e.bodyArc.center,S);if(Xe(v,w,i)>Xe(v,E,i))return{start:.5,end:.5,dbg:g};const C=Xe(v,b,i),y=Xe(v,w,i)/C,P=Xe(v,E,i)/C;return{start:y,end:P,dbg:g}}function Fn(t,o){let e;const n=[],s=t.getArrowInfo(o),i=o.props.start.type==="binding",a=o.props.end.type==="binding",l=s.start.arrowhead!=="none",d=s.end.arrowhead!=="none";if(s.isStraight){const p=Kh(t,o,s);let g=co(o.props.labelPosition,l||i?p.start:0,d||a?p.end:1);g=g>=.48&&g<=.52?.5:g,e=m.Lrp(s.start.point,s.end.point,g)}else{const p=Vh(t,o,s);p.dbg&&n.push(...p.dbg);let g=co(o.props.labelPosition,l||i?p.start:0,d||a?p.end:1);g=g>=.48&&g<=.52?.5:g;const u=Yh(m.Angle(s.bodyArc.center,s.start.point),m.Angle(s.bodyArc.center,s.end.point),Math.sign(o.props.bend),g);e=an(s.bodyArc.center,s.bodyArc.radius,u)}const c=Zs(t,o);return{box:Z.FromCenter(e,c),debugGeom:n}}function Ii(t,o,e,n,s,i){const a=Gl(t,o,i),l=Xe(e,n,s);return a==null?void 0:a.filter(d=>{const c=Xe(e,m.Angle(t,d),s);return c>=0&&c<=l})}function Ti(t,o){let e=null,n=-1/0;for(const s of o){const i=m.Dist2(t,s);i>n&&(e=s,n=i)}return e}function Yh(t,o,e,n){const s=Xe(t,o,e);return t+s*n*e*-1}function Zh(t,o,e){const n=o==="end"?t.end.point:t.start.point,s=o==="end"?t.start.point:t.end.point,i=t.isStraight?m.Dist(s,n):Math.abs(t.bodyArc.length),a=Math.max(Math.min(i/5,e*3),e);let l;if(t.isStraight)l=m.Nudge(n,s,a);else{const d=Kl(n,a,t.handleArc.center,t.handleArc.radius);l=o==="end"?t.handleArc.sweepFlag?d[0]:d[1]:t.handleArc.sweepFlag?d[1]:d[0]}return m.IsNaN(l)&&(l=t.start.point),{point:n,int:l}}function qh({point:t,int:o}){const e=m.RotWith(o,t,ce/6),n=m.RotWith(o,t,-ce/6);return`M ${e.x} ${e.y} L ${t.x} ${t.y} L ${n.x} ${n.y}`}function Xh({point:t,int:o}){const e=m.RotWith(o,t,ce/6),n=m.RotWith(o,t,-ce/6);return`M ${e.x} ${e.y} L ${t.x} ${t.y} L ${n.x} ${n.y} Z`}function Jh({point:t,int:o}){const e=m.Sub(o,t).div(2),n=m.Add(t,m.Rot(e,ee)),s=m.Sub(t,m.Rot(e,ee));return`M ${n.x} ${n.y} L ${o.x} ${o.y} L ${s.x} ${s.y} Z`}function Qh({point:t,int:o}){const e=m.Lrp(t,o,.45),n=m.Dist(e,t);return`M ${e.x-n},${e.y}
  a ${n},${n} 0 1,0 ${n*2},0
  a ${n},${n} 0 1,0 -${n*2},0 `}function ep({point:t,int:o}){const e=m.Lrp(t,o,.75),n=m.RotWith(e,t,ce/4),s=m.RotWith(e,t,-ce/4),i=m.Lrp(n,s,.5);return i.add(m.Sub(i,t)),`M ${i.x} ${i.y} L ${n.x} ${n.y} ${t.x} ${t.y} L ${s.x} ${s.y} Z`}function tp({int:t,point:o}){const e=m.Lrp(o,t,.85),n=m.Sub(e,o).div(2),s=m.Add(o,m.Rot(n,ee)),i=m.Sub(o,m.Rot(n,ee)),a=m.Add(e,m.Rot(n,ee)),l=m.Sub(e,m.Rot(n,ee));return`M ${s.x} ${s.y} L ${a.x} ${a.y} L ${l.x} ${l.y} L ${i.x} ${i.y} Z`}function np({int:t,point:o}){const e=m.Sub(t,o).div(2),n=m.Add(o,m.Rot(e,ee)),s=m.Sub(o,m.Rot(e,ee));return`M ${n.x} ${n.y} L ${s.x} ${s.y}`}function uo(t,o,e){const n=o==="end"?t.end.arrowhead:t.start.arrowhead;if(n==="none")return;const s=Zh(t,o,e);if(s){switch(n){case"bar":return np(s);case"square":return tp(s);case"diamond":return ep(s);case"dot":return Qh(s);case"inverted":return Jh(s);case"arrow":return qh(s);case"triangle":return Xh(s)}return""}}function op(t){const{start:o,end:e,handleArc:{radius:n,largeArcFlag:s,sweepFlag:i}}=t;return`M${o.handle.x},${o.handle.y} A${n} ${n} 0 ${s} ${i} ${e.handle.x},${e.handle.y}`}function qr(t){const{start:o,end:e,bodyArc:{radius:n,largeArcFlag:s,sweepFlag:i}}=t;return`M${o.point.x},${o.point.y} A${n} ${n} 0 ${s} ${i} ${e.point.x},${e.point.y}`}function Xr(t,o){return`M${t.x},${t.y}L${o.x},${o.y}`}function sp(t){return Xr(t.start.handle,t.end.handle)}function Jr(t){return Xr(t.start.point,t.end.point)}const ip=k.forwardRef(function({isEditing:o,text:e,handleFocus:n,handleChange:s,handleKeyDown:i,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:d},c){return r.jsx("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!o,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:e,onFocus:n,onChange:s,onKeyDown:i,onBlur:a,onTouchEnd:be,onContextMenu:o?be:void 0,onPointerDown:l,onDoubleClick:d,onDragStart:de})});function rp(t,o,e){const n=A(),s=k.useRef(null),i=k.useRef(),a=L("isEditing",()=>n.getEditingShapeId()===t,[n]),l=L("isEditingAnything",()=>!!n.getEditingShapeId(),[n]);k.useEffect(()=>{function u({shapeId:f}){requestAnimationFrame(()=>{if(f===t){const x=s.current;x&&(document.activeElement!==x&&x.focus(),x.select())}})}return n.on("select-all-text",u),()=>{n.off("select-all-text",u)}},[n,t]),k.useEffect(()=>{if(!a)return;const u=s.current;if(!u)return;document.activeElement!==u?(u.focus(),n.getInstanceState().isCoarsePointer&&u.select()):n.environment.isSafari&&(u.blur(),u.focus());function f(){var S,v;const x=(S=window.getSelection)==null?void 0:S.call(window);if(x&&x.type!=="None"){const b=[];for(let w=0;w<x.rangeCount;w++)b.push((v=x.getRangeAt)==null?void 0:v.call(x,w));i.current=b}}return document.addEventListener("selectionchange",f),()=>{document.removeEventListener("selectionchange",f)}},[n,a]);const d=k.useCallback(()=>{const u=i.current;requestAnimationFrame(()=>{var S;const f=s.current,x=n.getEditingShapeId();if(x){if(f&&x===t&&(f.focus(),u&&u.length)){const v=window.getSelection();v&&u.forEach(b=>v.addRange(b))}}else(S=window.getSelection())==null||S.removeAllRanges()})},[n,t]),c=k.useCallback(u=>{if(n.getEditingShapeId()===t)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&n.complete();break}}},[n,t]),p=k.useCallback(u=>{if(n.getEditingShapeId()!==t)return;let f=Rt.normalizeText(u.currentTarget.value);const x=f.replace(/\t/g,Et);if(x!==f){const S=u.currentTarget.selectionStart;u.currentTarget.value=x,u.currentTarget.selectionStart=S+(x.length-f.length),u.currentTarget.selectionEnd=S+(x.length-f.length),f=x}n.updateShape({id:t,type:o,props:{text:f}})},[n,t,o]),g=k.useCallback(u=>{n.dispatch({...zs(u),type:"pointer",name:"pointer_down",target:"shape",shape:n.getShape(t)}),be(u)},[n,t]);return{rInput:s,handleFocus:ap,handleBlur:d,handleKeyDown:c,handleChange:p,handleInputPointerDown:g,handleDoubleClick:be,isEmpty:e.trim().length===0,isEditing:a,isEditingAnything:l}}function ap(){}const Po=fe.memo(function({id:o,type:e,text:n,labelColor:s,font:i,fontSize:a,lineHeight:l,align:d,verticalAlign:c,wrap:p,isSelected:g,onKeyDown:u,classNamePrefix:f,style:x,textWidth:S,textHeight:v}){const{rInput:b,isEmpty:w,isEditing:E,isEditingAnything:C,...y}=rp(o,e,n),[P,T]=k.useState(n);k.useEffect(()=>{E||T(n)},[E,n]);const _=Rt.normalizeTextForDom(n),D=_.length>0,M=Nh(d);if(!E&&!D)return null;const $=f||"tl-text";return r.jsx("div",{className:`${$}-label tl-text-wrapper`,"data-font":i,"data-align":d,"data-hastext":!w,"data-isediting":E,"data-iseditinganything":C,"data-textwrap":!!p,"data-isselected":g,style:{justifyContent:d==="middle"||M?"center":d,alignItems:c==="middle"?"center":c,...x},children:r.jsxs("div",{className:`${$}-label__inner tl-text-content__wrapper`,style:{fontSize:a,lineHeight:a*l+"px",minHeight:l+32,minWidth:S||0,color:s,width:S,height:v},children:[r.jsx("div",{className:`${$} tl-text tl-text-content`,dir:"ltr",children:_}),(C||g)&&r.jsx(ip,{ref:b,text:n,isEditing:E,...y,handleKeyDown:u??y.handleKeyDown},P)]})})}),lp=k.memo(function({id:o,text:e,size:n,font:s,position:i,width:a,isSelected:l,labelColor:d}){const c=ie();return r.jsx(Po,{id:o,classNamePrefix:"tl-arrow",type:"arrow",font:s,fontSize:lt[n],lineHeight:he.lineHeight,align:"middle",verticalAlign:"middle",text:e,labelColor:c[d].solid,textWidth:a,isSelected:l,style:{transform:`translate(${i.x}px, ${i.y}px)`}})});let cp=0;class Rn extends Wt{constructor(){super(...arguments);h(this,"canEdit",()=>!0);h(this,"canBind",()=>!1);h(this,"canSnap",()=>!1);h(this,"hideResizeHandles",()=>!0);h(this,"hideRotateHandle",()=>!0);h(this,"hideSelectionBoundsBg",()=>!0);h(this,"hideSelectionBoundsFg",()=>!0);h(this,"onHandleDrag",(e,{handle:n,isPrecise:s})=>{const i=n.id;if(i==="middle"){const{start:v,end:b}=yn(this.editor,e),w=m.Sub(b,v),E=m.Per(w),C=m.Med(b,v),y=m.Sub(C,E),P=m.Add(C,E),T=m.NearestPointOnLineSegment(y,P,n,!1);let _=m.Dist(T,C);return m.Clockwise(T,b,C)&&(_*=-1),{id:e.id,type:e.type,props:{bend:_}}}const a=We(e);if(this.editor.inputs.ctrlKey)return a.props[i]={type:"point",x:n.x,y:n.y},a;const l=this.editor.getShapePageTransform(e.id).applyToPoint(n),d=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:v=>!v.isLocked&&this.editor.getShapeUtil(v).canBind(v)});if(!d)return a.props[i]={type:"point",x:n.x,y:n.y},a;const c=this.editor.getShapeGeometry(d),p=Z.ZeroFix(c.bounds),u=this.editor.getShapePageTransform(a.id).applyToPoint(n),f=this.editor.getPointInShapeSpace(d,u);let x=s;if(!x){const v=a.props[i];(v.type==="point"||v.type==="binding"&&d.id!==v.boundShapeId)&&(x=this.editor.inputs.pointerVelocity.len()<.5)}if(!s){c.isClosed||(x=!0);const v=a.props[i==="start"?"end":"start"];v.type==="binding"&&d.id===v.boundShapeId&&v.isPrecise&&(x=!0)}const S={x:(f.x-p.minX)/p.width,y:(f.y-p.minY)/p.height};return x&&m.Dist(f,p.center)<Math.max(4,Math.min(Math.min(p.width,p.height)*.15,16))/this.editor.getZoomLevel()&&(S.x=.5,S.y=.5),a.props[i]={type:"binding",boundShapeId:d.id,normalizedAnchor:S,isPrecise:x,isExact:this.editor.inputs.altKey},a.props.start.type==="binding"&&a.props.end.type==="binding"&&a.props.start.boundShapeId===a.props.end.boundShapeId&&m.Equals(a.props.start.normalizedAnchor,a.props.end.normalizedAnchor)&&(a.props.end.normalizedAnchor.x+=.05),a});h(this,"onTranslateStart",e=>{const n=e.props.start.type==="binding"?e.props.start.boundShapeId:null,s=e.props.end.type==="binding"?e.props.end.boundShapeId:null,i=yn(this.editor,e),a=this.editor.getShapePageTransform(e.id),l=this.editor.getSelectedShapeIds(),d=new Set;n&&(d.add(n),this.editor.getShapeAncestors(n).forEach(p=>d.add(p.id))),s&&(d.add(s),this.editor.getShapeAncestors(s).forEach(p=>d.add(p.id)));for(const p of l)if(d.has(p))return;let c=e;Mi.set(e,{pagePosition:a.applyToPoint(e),terminalBindings:gr(i,(p,g)=>{const u=e.props[p];return u.type!=="binding"?null:{binding:u,shapePosition:g,pagePosition:a.applyToPoint(g)}})});for(const p of["start","end"]){const g=e.props[p];g.type==="binding"&&(c={...e,props:{...e.props,[p]:{...g,isPrecise:!0}}})}return c});h(this,"onTranslate",(e,n)=>{const s=Mi.get(e);if(!s)return;const i=this.editor.getShapePageTransform(n.id),a=m.Sub(i.applyToPoint(n),s.pagePosition);let l=n;for(const[d,c]of Os(s.terminalBindings)){if(!c)continue;const p=m.Add(c.pagePosition,m.Mul(a,.5)),g=this.editor.getShapeAtPoint(p,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.getShapeUtil(u).canBind(u)});if((g==null?void 0:g.id)===c.binding.boundShapeId){const u=Z.ZeroFix(this.editor.getShapeGeometry(g).bounds),f=this.editor.getPointInShapeSpace(g,p),x={x:(f.x-u.minX)/u.width,y:(f.y-u.minY)/u.height};l={...l,props:{...l.props,[d]:{...c.binding,isPrecise:!0,normalizedAnchor:x}}}}else l={...l,props:{...l.props,[d]:{type:"point",x:c.shapePosition.x,y:c.shapePosition.y}}}}return l});h(this,"onResize",(e,n)=>{const{scaleX:s,scaleY:i}=n,a=yn(this.editor,e),{start:l,end:d}=We(e.props);let{bend:c}=e.props;l.type==="point"&&(l.x=a.start.x*s,l.y=a.start.y*i),d.type==="point"&&(d.x=a.end.x*s,d.y=a.end.y*i);const p=Math.abs(s),g=Math.abs(i);return s<0&&i>=0?(c!==0&&(c*=-1,c*=Math.max(p,g)),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x),d.type==="binding"&&(d.normalizedAnchor.x=1-d.normalizedAnchor.x)):s>=0&&i<0?(c!==0&&(c*=-1,c*=Math.max(p,g)),l.type==="binding"&&(l.normalizedAnchor.y=1-l.normalizedAnchor.y),d.type==="binding"&&(d.normalizedAnchor.y=1-d.normalizedAnchor.y)):s>=0&&i>=0?c!==0&&(c*=Math.max(p,g)):s<0&&i<0&&(c!==0&&(c*=Math.max(p,g)),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x,l.normalizedAnchor.y=1-l.normalizedAnchor.y),d.type==="binding"&&(d.normalizedAnchor.x=1-d.normalizedAnchor.x,d.normalizedAnchor.y=1-d.normalizedAnchor.y)),{props:{start:l,end:d,bend:c}}});h(this,"onDoubleClickHandle",(e,n)=>{switch(n.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}});h(this,"onEditEnd",e=>{const{id:n,type:s,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:s,props:{text:i.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw"}}getGeometry(e){const n=this.editor.getArrowInfo(e),s=[],i=n.isStraight?new pr({start:m.From(n.start.point),end:m.From(n.end.point)}):new ur({center:m.Cast(n.handleArc.center),radius:n.handleArc.radius,start:m.Cast(n.start.point),end:m.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});let a;if(e.props.text.trim()){const l=Fn(this.editor,e);s.push(...l.debugGeom),a=new pt({x:l.box.x,y:l.box.y,width:l.box.w,height:l.box.h,isFilled:!0,isLabel:!0})}return new ut({children:[...a?[i,a]:[i],...s]})}getHandles(e){const n=this.editor.getArrowInfo(e);return[{id:"start",type:"vertex",index:"a0",x:n.start.handle.x,y:n.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:n.middle.x,y:n.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:n.end.handle.x,y:n.end.handle.y,canBind:!0}].filter(Boolean)}component(e){const n=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,i=this.editor.getArrowInfo(e);if(!(i!=null&&i.isValid))return null;const a=Fn(this.editor,e),l=e.id===this.editor.getOnlySelectedShapeId(),c=this.editor.getEditingShapeId()===e.id||e.props.text;return r.jsxs(r.Fragment,{children:[r.jsx(gt,{id:e.id,style:{minWidth:50,minHeight:50},children:r.jsx(Ei,{shape:e,shouldDisplayHandles:s&&n===e})}),c&&r.jsx(lp,{id:e.id,text:e.props.text,font:e.props.font,size:e.props.size,position:a.box.center,width:a.box.w,isSelected:l,labelColor:e.props.labelColor})]})}indicator(e){const{start:n,end:s}=yn(this.editor,e),i=this.editor.getArrowInfo(e),a=this.editor.getShapeGeometry(e),l=a.bounds,d=e.props.text.trim()?a.children[1]:null,c=So(e.id);if(!i||m.Equals(n,s))return null;const p=le[e.props.size],g=i.start.arrowhead&&uo(i,"start",p),u=i.end.arrowhead&&uo(i,"end",p),f=i.isStraight?Jr(i):qr(i),x=g&&i.start.arrowhead!=="arrow"||u&&i.end.arrowhead!=="arrow"||!!d,S=(e.id+"_clip").replace(":","_");return c&&d?r.jsx("rect",{x:j(d.x),y:j(d.y),width:d.w,height:d.h,rx:3.5,ry:3.5}):r.jsxs("g",{children:[x&&r.jsx("defs",{children:r.jsxs("mask",{id:S,children:[r.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.w+200,height:l.h+200,fill:"white"}),d&&r.jsx("rect",{x:j(d.x),y:j(d.y),width:d.w,height:d.h,fill:"black",rx:3.5,ry:3.5}),g&&r.jsx("path",{d:g,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),u&&r.jsx("path",{d:u,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),r.jsxs("g",{...x?{mask:`url(#${S})`}:void 0,children:[x&&r.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),r.jsx("path",{d:f})]}),g&&r.jsx("path",{d:g}),u&&r.jsx("path",{d:u}),d&&r.jsx("rect",{x:j(d.x),y:j(d.y),width:d.w,height:d.h,rx:3.5,ry:3.5})]})}toSvg(e,n){n.addExportDef(Vs(e.props.fill)),e.props.text&&n.addExportDef(Nt(e.props.font));const s=tt(n);return r.jsxs(r.Fragment,{children:[r.jsx(Ei,{shape:e,shouldDisplayHandles:!1}),r.jsx(ko,{fontSize:lt[e.props.size],font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:s[e.props.labelColor].solid,bounds:Fn(this.editor,e).box,padding:4})]})}getCanvasSvgDefs(){return[Ys(),{key:"arrow:dot",component:hp},{key:"arrow:cross",component:pp}]}}h(Rn,"type","arrow"),h(Rn,"props",Vl),h(Rn,"migrations",Yl);function dp(t,o){const e=t.getArrowInfo(o);return e.isStraight?m.Dist(e.start.handle,e.end.handle):Math.abs(e.handleArc.length)}const Ei=Ke(function({shape:o,shouldDisplayHandles:e}){const n=A(),s=ie(),i=n.getArrowInfo(o),a=Z.ZeroFix(n.getShapeGeometry(o).bounds),l=fe.useMemo(()=>n.environment.isSafari?cp+=1:0,[o]);if(!(i!=null&&i.isValid))return null;const d=le[o.props.size],c=i.start.arrowhead&&uo(i,"start",d),p=i.end.arrowhead&&uo(i,"end",d),g=i.isStraight?Jr(i):qr(i);let u=null;if(e){const{strokeDasharray:C,strokeDashoffset:y}=Ge(dp(n,o),2,{end:"skip",start:"skip",lengthRatio:2.5});u=o.props.start.type==="binding"||o.props.end.type==="binding"?r.jsx("path",{className:"tl-arrow-hint",d:i.isStraight?sp(i):op(i),strokeDasharray:C,strokeDashoffset:y,strokeWidth:2,markerStart:o.props.start.type==="binding"?o.props.start.isExact?"":o.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:o.props.end.type==="binding"?o.props.end.isExact?"":o.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:f,strokeDashoffset:x}=Ge(i.isStraight?i.length:Math.abs(i.bodyArc.length),d,{style:o.props.dash}),S=Fn(n,o),v=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),b=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow"),w=(o.id+"_clip_"+l).replace(":","_");return r.jsxs(r.Fragment,{children:[r.jsx("defs",{children:r.jsxs("mask",{id:w,children:[r.jsx("rect",{x:j(-100+a.minX),y:j(-100+a.minY),width:j(a.width+200),height:j(a.height+200),fill:"white"}),o.props.text.trim()&&r.jsx("rect",{x:S.box.x,y:S.box.y,width:S.box.w,height:S.box.h,fill:"black",rx:4,ry:4}),c&&v&&r.jsx("path",{d:c,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),p&&b&&r.jsx("path",{d:p,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),r.jsxs("g",{fill:"none",stroke:s[o.props.color].solid,strokeWidth:d,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[u,r.jsxs("g",{mask:`url(#${w})`,children:[r.jsx("rect",{x:j(a.minX-100),y:j(a.minY-100),width:j(a.width+200),height:j(a.height+200),opacity:0}),r.jsx("path",{d:g,strokeDasharray:f,strokeDashoffset:x})]}),c&&v&&o.props.fill!=="none"&&r.jsx(re,{theme:s,d:c,color:o.props.color,fill:o.props.fill}),p&&b&&o.props.fill!=="none"&&r.jsx(re,{theme:s,d:p,color:o.props.color,fill:o.props.fill}),c&&r.jsx("path",{d:c}),p&&r.jsx("path",{d:p})]})]})}),Mi=new WeakMap;function hp(){return r.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:r.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function pp(){return r.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[r.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),r.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const _i="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Bt({url:t,zoomLevel:o}){return r.jsx("a",{className:H("tl-hyperlink-button",{"tl-hyperlink-button__hidden":o<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:be,onPointerUp:be,title:t,draggable:!1,children:r.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${_i}") center 100% / 100% no-repeat`,WebkitMask:`url("${_i}") center 100% / 100% no-repeat`}})})}const up=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function qs(t){return up.map(e=>{const{offsetX:n,offsetY:s,blur:i,spread:a,color:l}=e,d=new m(n,s),{x:c,y:p}=d.rot(-t);return`${c}px ${p}px ${i}px ${a}px ${l}`}).join(", ")}class Nn extends Gt{constructor(){super(...arguments);h(this,"canResize",()=>!1);h(this,"hideSelectionBoundsFg",()=>!0);h(this,"onBeforeCreate",e=>{Ai(this.editor,e)});h(this,"onBeforeUpdate",(e,n)=>{if(e.props.url!==n.props.url)if(cs.isValid(n.props.url))Ai(this.editor,n);else return{...n,props:{...n.props,url:e.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):null,s=this.editor.getShapePageTransform(e).rotation(),i=gp(e);return r.jsx(ft,{children:r.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:qs(s)},children:[r.jsxs("div",{className:"tl-bookmark__image_container",children:[n!=null&&n.props.image?r.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:n==null?void 0:n.props.image,alt:(n==null?void 0:n.props.title)||""}):r.jsx("div",{className:"tl-bookmark__placeholder"}),r.jsx(Bt,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),r.jsxs("div",{className:"tl-bookmark__copy_container",children:[(n==null?void 0:n.props.title)&&r.jsx("h2",{className:"tl-bookmark__heading",children:sn((n==null?void 0:n.props.title)||"",54)}),(n==null?void 0:n.props.description)&&r.jsx("p",{className:"tl-bookmark__description",children:sn((n==null?void 0:n.props.description)||"",128)}),r.jsx("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:be,onPointerUp:be,onClick:be,children:sn(i,45)})]})]})})}indicator(e){return r.jsx("rect",{width:j(e.props.w),height:j(e.props.h),rx:"6",ry:"6"})}}h(Nn,"type","bookmark"),h(Nn,"props",ql),h(Nn,"migrations",Xl);const gp=t=>{try{const o=new URL(t.props.url),e=o.pathname.replace(/\/*$/,"");return`${o.hostname}${e}`}catch{return t.props.url}};function Ai(t,o){const{url:e}=o.props,n=It.createId(ls(e));t.getAsset(n)?o.props.assetId!==n&&t.updateShapes([{id:o.id,type:o.type,props:{assetId:n}}]):(t.updateShapes([{id:o.id,type:o.type,props:{assetId:null}}]),fp(t,o))}const fp=Zl(async(t,o)=>{const{url:e}=o.props,n=await t.getAssetForExternalContent({type:"url",url:e});n&&t.batch(()=>{t.createAssets([n]),t.updateShapes([{id:o.id,type:o.type,props:{assetId:n.id}}])})},500);function mt(t,o=!1){const e=t.length;if(e<2)return"";let n=t[0].point,s=t[1].point;if(e===2)return`M${_e(n)}L${_e(s)}`;let i="";for(let a=2,l=e-1;a<l;a++)n=t[a].point,s=t[a+1].point,i+=qe(n,s);return o?`M${qe(t[0].point,t[1].point)}Q${_e(t[1].point)}${qe(t[1].point,t[2].point)}T${i}${qe(t[e-1].point,t[0].point)}${qe(t[0].point,t[1].point)}Z`:`M${_e(t[0].point)}Q${_e(t[1].point)}${qe(t[1].point,t[2].point)}${t.length>3?"T":""}${i}L${_e(t[e-1].point)}`}function mp(t,o={}){const{start:e={},end:n={}}=o,{cap:s=!0}=e,{cap:i=!0}=n;nn(!e.taper&&!n.taper,"cap taper not supported here"),nn(!e.easing&&!n.easing,"cap easing not supported here"),nn(s&&i,"cap must be true");const a=Re(t,o);vo(a,o);const l=xp(a);let d="";for(const c of l)d+=yp(c,o);return d}function xp(t){if(t.length<=2)return[t];const o=[];let e=[t[0]],n=m.Sub(t[1].point,t[0].point).uni(),s,i,a,l,d;for(let c=1,p=t.length;c<p-1;c++){if(a=t[c-1],l=t[c],d=t[c+1],s=m.Sub(d.point,l.point).uni(),i=m.Dpr(n,s),n=s,i<-.8){const g={...l,point:l.input};e.push(g),o.push(Fo(e)),e=[g];continue}if(e.push(l),!(i>.7)&&(m.Dist2(a.point,l.point)+m.Dist2(l.point,d.point))/((a.radius+l.radius+d.radius)/3)**2<1.5){e.push(l),o.push(Fo(e)),e=[l];continue}}return e.push(t[t.length-1]),o.push(Fo(e)),o}function Fo(t){const o=t[0];let e;for(;t.length>2&&(e=t[1],m.Dist2(o.point,e.point)<((o.radius+e.radius)/2*.5)**2);)t.splice(1,1);const n=t[t.length-1];let s;for(;t.length>2&&(s=t[t.length-2],m.Dist2(n.point,s.point)<((n.radius+s.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:m.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:m.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function Sp(t,o,e){return"M "+t+" "+o+" m -"+e+", 0 a "+e+","+e+" 0 1,1 "+e*2+",0 a "+e+","+e+" 0 1,1 -"+e*2+",0"}function yp(t,o={}){if(t.length===0)return"";if(t.length===1)return Sp(t[0].point.x,t[0].point.y,t[0].radius);const{left:e,right:n}=Lr(t,o);n.reverse();let s=`M${_e(e[0])}T`;for(let i=1;i<e.length;i++)s+=qe(e[i-1],e[i]);{const i=t[t.length-1],a=i.radius,l=i.vector.clone().per().neg(),d=m.Add(i.point,m.Mul(l,a)),c=m.Add(i.point,m.Mul(l,-a));s+=`${_e(d)}A${j(a)},${j(a)} 0 0 1 ${_e(c)}T`}for(let i=1;i<n.length;i++)s+=qe(n[i-1],n[i]);{const i=t[0],a=i.radius,l=i.vector.clone().per(),d=m.Add(i.point,m.Mul(l,a)),c=m.Add(i.point,m.Mul(l,-a));s+=`${_e(d)}A${j(a)},${j(a)} 0 0 1 ${_e(c)}Z`}return s}function cn(){const t=A();return L("zoom",()=>t.getZoomLevel()<.35,[t])}const bp=t=>t*.65+Jl(t*ce/2)*.35,wp=t=>({size:1+t,thinning:.5,streamline:.62+(1+t)/8*.06,smoothing:.62,easing:Ce.easeOutSine,simulatePressure:!0}),vp=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:bp}),$i=t=>({size:1+t,thinning:0,streamline:.62+(1+t)/8*.06,smoothing:.62,simulatePressure:!1,easing:Ce.linear});function bs({strokeWidth:t,showAsComplete:o}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Ce.easeOutSine,last:o}}function ws(t,o,e,n){return{...n?$i(o):t.dash==="draw"?t.isPen?vp(o):wp(o):$i(o),last:t.isComplete||e}}function dn(t){const o=[];for(const e of t)if(e.type==="free"||e.points.length<2)o.push(...e.points.map(m.Cast));else{const n=Math.max(4,Math.floor(m.Dist(e.points[0],e.points[1])/16));o.push(...m.PointsBetween(e.points[0],e.points[1],n))}return o}function kp(t,o){return{draw:"none",solid:"none",dotted:`0.1 ${o*2}`,dashed:`${o*2} ${o*2}`}[t.props.dash]}class Bn extends Wt{constructor(){super(...arguments);h(this,"hideResizeHandles",e=>Ro(e));h(this,"hideRotateHandle",e=>Ro(e));h(this,"hideSelectionBoundsFg",e=>Ro(e));h(this,"onResize",(e,n)=>{const{scaleX:s,scaleY:i}=n,a=[];for(const l of e.props.segments)a.push({...l,points:l.points.map(({x:d,y:c,z:p})=>({x:ro(s*d),y:ro(i*c),z:p}))});return{props:{segments:a}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(e){const n=dn(e.props.segments),s=le[e.props.size];if(e.props.segments.length===1){const a=Z.FromPoints(n);if(a.width<s*2&&a.height<s*2)return new Ls({x:-s,y:-s,radius:s,isFilled:!0})}const i=Re(n,ws(e.props,s,!0,!0)).map(a=>a.point);return e.props.isClosed?new ae({points:i,isFilled:e.props.fill!=="none"}):new yo({points:i})}component(e){return r.jsx(gt,{id:e.id,children:r.jsx(Di,{shape:e,forceSolid:cn()})})}indicator(e){var g;const n=cn(),s=le[e.props.size],i=dn(e.props.segments);let a=s;!n&&!e.props.isPen&&e.props.dash==="draw"&&i.length===1&&(a+=nt(e.id)()*(s/6));const l=e.props.isComplete||((g=ye(e.props.segments))==null?void 0:g.type)==="straight",d=ws(e.props,a,l,!0),c=Re(i,d),p=c.length>1?mt(c,e.props.isClosed):Qr(i[0],a);return r.jsx("path",{d:p})}toSvg(e,n){return n.addExportDef(Vs(e.props.fill)),r.jsx(Di,{shape:e,forceSolid:!1})}getCanvasSvgDefs(){return[Ys()]}expandSelectionOutlinePx(e){const n=e.props.dash==="draw"?1.6:1;return le[e.props.size]*n/2}}h(Bn,"type","draw"),h(Bn,"props",Ql),h(Bn,"migrations",ec);function Qr(t,o){const e=(o+1)*.5;return`M ${t.x} ${t.y} m -${e}, 0 a ${e},${e} 0 1,0 ${e*2},0 a ${e},${e} 0 1,0 -${e*2},0`}function Ro(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function Di({shape:t,forceSolid:o}){var g;const e=ie(),n=le[t.props.size],s=dn(t.props.segments),i=t.props.isComplete||((g=ye(t.props.segments))==null?void 0:g.type)==="straight";let a=n;!o&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(a+=nt(t.id)()*(n/6));const l=ws(t.props,a,i,o);if(!o&&t.props.dash==="draw")return r.jsxs(r.Fragment,{children:[t.props.isClosed&&t.props.fill&&s.length>1?r.jsx(re,{theme:e,fill:t.props.isClosed?t.props.fill:"none",color:t.props.color,d:mt(Re(s,l),t.props.isClosed)}):null,r.jsx("path",{d:mp(s,l),strokeLinecap:"round",fill:e[t.props.color].solid})]});const d=Re(s,l),c=d.length<2,p=c?Qr(s[0],0):mt(d,t.props.isClosed);return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:e,color:t.props.color,fill:c||t.props.isClosed?t.props.fill:"none",d:p}),r.jsx("path",{d:p,strokeLinecap:"round",fill:c?e[t.props.color].solid:"none",stroke:e[t.props.color].solid,strokeWidth:n,strokeDasharray:c?"none":kp(t,n),strokeDashoffset:"0"})]})}function Pp(t,o,e={}){const{newPoint:n,handle:s,scaleX:i,scaleY:a}=o,{minWidth:l=1,maxWidth:d=1/0,minHeight:c=1,maxHeight:p=1/0}=e;let g=t.props.w*i,u=t.props.h*a;const f=new m(0,0);if(g>0){if(g<l){switch(s){case"top_left":case"left":case"bottom_left":{f.x=g-l;break}case"top":case"bottom":{f.x=(g-l)/2;break}default:f.x=0}g=l}}else if(f.x=g,g=-g,g<l){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-g;break}default:f.x=-l}g=l}if(u>0){if(u<c){switch(s){case"top_left":case"top":case"top_right":{f.y=u-c;break}case"right":case"left":{f.y=(u-c)/2;break}default:f.y=0}u=c}}else if(f.y=u,u=-u,u<c){switch(s){case"top_left":case"top":case"top_right":{f.y=-u;break}default:f.y=-c}u=c}const{x,y:S}=f.rot(t.rotation).add(n);return{x,y:S,props:{w:Math.min(d,g),h:Math.min(p,u)}}}const Cp=t=>Object.entries(t).filter(([o,e])=>e).map(([o])=>o).join(" ");class Un extends Gt{constructor(){super(...arguments);h(this,"hideSelectionBoundsFg",e=>!this.canResize(e));h(this,"canEdit",()=>!0);h(this,"canResize",e=>{var n,s;return!!((s=(n=Je(e.props.url))==null?void 0:n.definition)!=null&&s.doesResize)});h(this,"canEditInReadOnly",()=>!0);h(this,"isAspectRatioLocked",e=>{const n=Je(e.props.url);return(n==null?void 0:n.definition.isAspectRatioLocked)??!1});h(this,"onResize",(e,n)=>{const s=this.isAspectRatioLocked(e),i=Je(e.props.url);let a=(i==null?void 0:i.definition.minWidth)??200,l=(i==null?void 0:i.definition.minHeight)??200;if(s){const d=e.props.w/e.props.h;d>1?a*=d:l/=d}return Pp(e,n,{minWidth:a,minHeight:l})})}getDefaultProps(){return{w:300,h:300,url:""}}component(e){const{w:n,h:s,url:i}=e.props,a=So(e.id),l=k.useMemo(()=>Fr(i),[i]),d=L("is hovering",()=>{const{editingShapeId:u,hoveredShapeId:f}=this.editor.getCurrentPageState();if(u&&f!==u){const x=this.editor.getShape(u);if(x&&this.editor.isShapeOfType(x,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation(),p=a||d;if((l==null?void 0:l.definition.type)==="github_gist"){const u=l.url.split("/").pop();if(!u)throw Error("No gist id!");return r.jsx(ft,{className:"tl-embed-container",id:e.id,children:r.jsx(jp,{id:u,width:j(n),height:j(s),isInteractive:p,pageRotation:c})})}const g=Cp({...oc,...(l==null?void 0:l.definition.overridePermissions)??{}});return r.jsx(ft,{className:"tl-embed-container",id:e.id,children:l!=null&&l.definition?r.jsx("iframe",{className:"tl-embed",sandbox:g,src:l.embedUrl,width:j(n),height:j(s),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:p?"auto":"none",zIndex:p?"":"-1",boxShadow:qs(c),borderRadius:(l==null?void 0:l.definition.overrideOutlineRadius)??8,background:l==null?void 0:l.definition.backgroundColor}}):null})}indicator(e){const n=k.useMemo(()=>Je(e.props.url),[e.props.url]);return r.jsx("rect",{width:j(e.props.w),height:j(e.props.h),rx:(n==null?void 0:n.definition.overrideOutlineRadius)??8,ry:(n==null?void 0:n.definition.overrideOutlineRadius)??8})}}h(Un,"type","embed"),h(Un,"props",tc),h(Un,"migrations",nc);function jp({id:t,file:o,isInteractive:e,width:n,height:s,style:i,pageRotation:a}){return r.jsx("iframe",{className:"tl-embed",draggable:!1,width:j(n),height:j(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:qs(a)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js${o?`?file=${o}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const Ip=k.forwardRef(({id:t,name:o,isEditing:e},n)=>{const s=A(),i=k.useCallback(d=>{d.key==="Enter"&&!d.nativeEvent.isComposing&&(be(d),d.currentTarget.blur(),s.setEditingShape(null))},[s]),a=k.useCallback(d=>{const c=s.getShape(t);if(!c)return;const p=c.props.name,g=d.currentTarget.value.trim();p!==g&&s.updateShapes([{id:t,type:"frame",props:{name:g}}],{squashing:!0})},[t,s]),l=k.useCallback(d=>{const c=s.getShape(t);if(!c)return;const p=c.props.name,g=d.currentTarget.value;p!==g&&s.updateShapes([{id:t,type:"frame",props:{name:g}}],{squashing:!0})},[t,s]);return r.jsxs("div",{className:`tl-frame-label ${e?"tl-frame-label__editing":""}`,children:[r.jsx("input",{className:"tl-frame-name-input",ref:n,style:{display:e?void 0:"none"},value:o,autoFocus:!0,onKeyDown:i,onBlur:a,onChange:l}),ea(o,"Frame")+"​"]})}),Tp=function({id:o,name:e,width:n,height:s}){const i=A(),a=L("shape rotation",()=>on(i.getShapePageTransform(o).rotation()),[i,o]),l=So(o),d=k.useRef(null),c=k.useCallback(x=>{const S=zs(x);i.getEditingShapeId()!==o&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(o),...S}),x.preventDefault())},[i,o]);k.useEffect(()=>{const x=d.current;x&&l&&(x.focus(),x.select(),requestAnimationFrame(()=>{document.activeElement!==x&&(x.focus(),x.select())}))},[d,l]);const g=((a+Math.PI/4)*(2/Math.PI)+4)%4,u=["top","left","bottom","right"][Math.floor(g)];let f;switch(u){case"top":f="";break;case"right":f=`translate(${j(n)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${j(n)}px, ${j(s)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${j(s)}px) rotate(270deg)`;break}return r.jsx("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(u==="top"||u==="bottom"?n:s)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:c,children:r.jsx("div",{className:"tl-frame-heading-hit-area",children:r.jsx(Ip,{ref:d,id:o,name:e,isEditing:l})})})};function ea(t,o){return t.match(/^\s*$/)?o:t}class Hn extends Gt{constructor(){super(...arguments);h(this,"canBind",()=>!0);h(this,"canEdit",()=>!0);h(this,"canReceiveNewChildrenOfType",(e,n)=>!e.isLocked);h(this,"canDropShapes",(e,n)=>!e.isLocked);h(this,"onDragShapesOver",(e,n)=>{n.every(s=>s.parentId===e.id)||this.editor.reparentShapes(n,e.id)});h(this,"onDragShapesOut",(e,n)=>{const s=this.editor.getShape(e.parentId);s&&this.editor.isShapeOfType(s,"group")?this.editor.reparentShapes(n,s.id):this.editor.reparentShapes(n,this.editor.getCurrentPageId())});h(this,"onResize",(e,n)=>rc(e,n))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){return new pt({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){const n=this.editor.getShapeGeometry(e).bounds,s=ie(),i=L("is creating this shape",()=>{const a=this.editor.getStateDescendant("select.resizing");if(!a||!a.getIsActive())return!1;const l=a==null?void 0:a.info;return l?l.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return r.jsxs(r.Fragment,{children:[r.jsx(gt,{children:r.jsx("rect",{className:H("tl-frame__body",{"tl-frame__creating":i}),width:n.width,height:n.height,fill:s.solid,stroke:s.text})}),i?null:r.jsx(Tp,{id:e.id,name:e.props.name,width:n.width,height:n.height})]})}toSvg(e,n){const s=tt({isDarkMode:n.isDarkMode}),l=((on(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,d=Math.floor(l);let c;switch(d){case 0:c="";break;case 3:c=`translate(${j(e.props.w)}, 0) rotate(90)`;break;case 2:c=`translate(${j(e.props.w)}, ${j(e.props.h)}) rotate(180)`;break;case 1:c=`translate(0, ${j(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const p={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},g=this.editor.textMeasure.measureTextSpans(ea(e.props.name,"Frame")+"​",p),u=g[0],f=ye(g),x=f.box.w+f.box.x-u.box.x,S=ys(this.editor,g,{offsetY:-p.height-2,...p});return r.jsxs(r.Fragment,{children:[r.jsx("rect",{width:e.props.w,height:e.props.h,fill:s.solid,stroke:s.black.solid,strokeWidth:1,rx:1,ry:1}),r.jsxs("g",{transform:c,children:[r.jsx("rect",{x:-8,y:-p.height-4,width:x+16,height:p.height,fill:s.background,rx:4,ry:4}),S]})]})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return r.jsx("rect",{width:j(n.width),height:j(n.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}h(Hn,"type","frame"),h(Hn,"props",sc),h(Hn,"migrations",ic);function ue(t){return`${j(t.x)},${j(t.y)} `}function ta(t=""){let o=0,e=0,n=0,s=0;function i(){const a=o^o<<11;return o=e,e=n,n=s,s^=(s>>>19^a^a>>>8)>>>0,s/4294967296*2}for(let a=0;a<t.length+64;a++)o^=t.charCodeAt(a)|0,i();return i}function vs(t){let o="M";const e=t.length;let n,s,i;for(let a=0,l=e;a<l;a+=3)n=t[a],s=t[a+1],i=t[a+2],o+=`${ue(n)}L${ue(s)}Q${ue(i)}`;return o+=`${ue(t[0])}`,o}function ks(t,o,e,n,s){const i=[],a=ta(t);let l=o[0],d;const c=o.length;for(let p=0,g=c*s;p<g;p++){d=m.AddXY(o[(p+1)%c],a()*e,a()*e);const u=m.Sub(d,l),f=m.Len(u),x=m.Div(u,f).mul(Math.min(f/4,n));i.push(m.Add(l,x),m.Add(d,x.neg()),d),l=d}return i}function na(t,o,e){let n=`M ${ue(o[0])}L`,s=`M ${ue(o[0])}L`;const i=e/3,a=e*2,l=ta(t);let d=o[0],c,p=o[0],g;const u=o.length;for(let f=0,x=u-1;f<x;f++){c=o[f+1],g=m.AddXY(o[f+1],l()*i,l()*i);const S=m.Sub(c,d),v=m.Len(S),b=m.Div(S,v).mul(Math.min(v/4,a)),w=m.Add(d,b),E=m.Add(c,b.neg()),C=m.Sub(g,p),y=m.Len(C),P=m.Div(C,y).mul(Math.min(y/4,a)),T=m.Add(p,P),_=m.Add(g,P.neg());f===x-1?(n+=`${ue(w)}L ${ue(c)}`,s+=`${ue(T)}L ${ue(g)}`):(n+=`${ue(w)}L ${ue(E)}Q ${ue(c)}`,s+=`${ue(T)}L ${ue(_)}Q ${ue(g)}`,d=c,p=g)}return[n,n+s]}function Li(t,o){const e=Math.min(t,o)/2,n=Math.max(t,o)-e*2;return Math.PI*(e*2)+2*n}function Ep(t,o,e){const n=Math.min(t,o)/2,s=Math.max(t,o)-n*2,a=(Math.PI*(n*2)+2*s)/e,l=t>o?[{type:"straight",start:new m(n,0),delta:new m(1,0)},{type:"arc",center:new m(t-n,n),startAngle:-ce/2},{type:"straight",start:new m(t-n,o),delta:new m(-1,0)},{type:"arc",center:new m(n,n),startAngle:ce/2}]:[{type:"straight",start:new m(t,n),delta:new m(0,1)},{type:"arc",center:new m(n,o-n),startAngle:0},{type:"straight",start:new m(0,o-n),delta:new m(0,-1)},{type:"arc",center:new m(n,n),startAngle:ce}];let d=0;const c=[];for(let p=0;p<e;p++){const g=l[0];g.type==="straight"?c.push(m.Add(g.start,m.Mul(g.delta,d))):c.push(an(g.center,n,g.startAngle+d/n)),d+=a;let u=g.type==="straight"?s:ce*n;for(;d>u;)d-=u,l.push(l.shift()),u=l[0].type==="straight"?s:ce*n}return c}const Mp=(t,o,e,n,s)=>{switch(t){case"s":return o;case"m":return e;case"l":return n;case"xl":return s}};function Co(t,o,e,n){const s=nt(e),i=Li(t,o),a=Math.max(Math.ceil(i/Mp(n,50,70,100,130)),6,Math.ceil(i/Math.min(t,o))),l=i/a*.2,d=Math.max(t-l*2,1),c=Math.max(o-l*2,1),p=(t-d)/2,g=(o-c)/2,u=Li(d,c)/a,f=Ep(d,c,a).map(w=>w.addXY(p,g)),x=t<20?0:l*.3,S=o<20?0:l*.3,v=f.slice(0);for(let w=0;w<Math.floor(a/2);w++)v[w]=m.AddXY(v[w],s()*x,s()*S),v[a-w-1]=m.AddXY(v[a-w-1],s()*x,s()*S);const b=[];for(let w=0;w<v.length;w++){const E=w===v.length-1?0:w+1,C=v[w],y=v[E],P=f[w],T=f[E],_=m.Average([P,T]),D=m.Angle(P,T)-Math.PI/2,M=m.Dist(P,T),$=u-M,O=m.Dist(C,y)/M,W=(Math.max(p,g)+$)*O,R=m.Add(_,m.FromAngle(D,W));R.x<0?R.x=0:R.x>t&&(R.x=t),R.y<0?R.y=0:R.y>o&&(R.y=o);const X=oa(C,y,R),Q=m.Dist(X||m.Average([C,y]),C);b.push({leftPoint:C,rightPoint:y,arcPoint:R,center:X,radius:Q})}return b}function oa(t,o,e){const n=t.x*(o.y-e.y)-t.y*(o.x-e.x)+o.x*e.y-e.x*o.y,s=(t.x*t.x+t.y*t.y)*(e.y-o.y)+(o.x*o.x+o.y*o.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(o.y-t.y),i=(t.x*t.x+t.y*t.y)*(o.x-e.x)+(o.x*o.x+o.y*o.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-o.x),a=-s/(2*n),l=-i/(2*n);return!Number.isFinite(a)||!Number.isFinite(l)?null:new m(a,l)}function _p(t,o,e,n){const s=[],i=Co(t,o,e,n);for(const{center:a,radius:l,leftPoint:d,rightPoint:c}of i)s.push(...$p(d,c,a,l,10));return s}function Xs(t,o,e,n){const s=Co(t,o,e,n);let i=`M${j(s[0].leftPoint.x)},${j(s[0].leftPoint.y)}`;for(const{leftPoint:a,rightPoint:l,radius:d,center:c}of s){if(c===null){i+=` L${j(l.x)},${j(l.y)}`;continue}const p=sa(a,l,c)?"0":"1";i+=` A${j(d)},${j(d)} 0 ${p},1 ${j(l.x)},${j(l.y)}`}return i+=" Z",i}function Ap(t,o,e,n){const s=nt(e),i=n==="s"?.5:n==="m"?.7:n==="l"?.9:1.6,a=x=>x+s()*i*2,l=Co(t,o,e,n),p=l.reduce((x,S)=>x+m.Dist2(S.leftPoint,S.rightPoint),0)/l.length>(i*15)**2?x=>new m(a(x.x),a(x.y)):x=>x;let g=`M${j(l[0].leftPoint.x)},${j(l[0].leftPoint.y)}`,u=p(l[0].leftPoint),f=`M${j(u.x)},${j(u.y)}`;for(const{leftPoint:x,center:S,rightPoint:v,radius:b,arcPoint:w}of l){if(S===null){g+=` L${j(v.x)},${j(v.y)}`;const _=p(v);f+=` L${j(_.x)},${j(_.y)}`,u=_;continue}const E=sa(x,v,S)?"0":"1";g+=` A${j(b)},${j(b)} 0 ${E},1 ${j(v.x)},${j(v.y)}`;const C=p(v),y=p(w),P=oa(u,C,y);if(!P){f+=` L${j(C.x)},${j(C.y)}`,u=C;continue}const T=Math.abs(m.Dist(P,u));f+=` A${j(T)},${j(T)} 0 ${E},1 ${j(C.x)},${j(C.y)}`,u=C}return g+f+" Z"}function $p(t,o,e,n,s){if(e===null)return[m.From(t),m.From(o)];const i=[],a=m.Angle(e,t),l=m.Angle(e,o),d=ac(a,l);for(let c=0;c<s;c++){const p=c/(s-1),g=a+d*p,u=an(e,n,g);i.push(u)}return i}function sa(t,o,e){return(o.x-t.x)*(e.y-t.y)-(o.y-t.y)*(e.x-t.x)>0}function Dp(t){return{size:1+t,thinning:.25,end:{taper:t},start:{taper:t},streamline:0,smoothing:1,simulatePressure:!1}}function Lp(t,o,e,n){const s=nt(t),i=o/2,a=e/2,l=ho(i,a),d=[],c=zt*s(),p=zt+ee/2+Math.abs(s())*ee,g=Math.max(16,l/10);for(let u=0;u<g;u++){const f=u/(g-1),x=c+f*p,S=Math.cos(x),v=Math.sin(x);d.push(new m(i*S+o*.5+.05*s(),a*v+e/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?Ce.easeInOutSine(f):Ce.easeInExpo(f)))/2)))}return Re(d,Dp(n))}function zp(t,o,e,n){return mt(Lp(t,o,e,n))}function Ps(t,o){switch(t.geo){case"x-box":return Op(t.w,t.h,o,t.dash);case"check-box":return Fp(t.w,t.h);default:return}}function Op(t,o,e,n){const s=n==="draw"?.62:0;if(n==="dashed")return[[new m(0,0),new m(t/2,o/2)],[new m(t,o),new m(t/2,o/2)],[new m(0,o),new m(t/2,o/2)],[new m(t,0),new m(t/2,o/2)]];const i=l=>Math.max(0,Math.min(t,l)),a=l=>Math.max(0,Math.min(o,l));return[[new m(i(e*s),a(e*s)),new m(i(t-e*s),a(o-e*s))],[new m(i(e*s),a(o-e*s)),new m(i(t-e*s),a(e*s))]]}function Fp(t,o){const e=Math.min(t,o)*.82,n=(t-e)/2,s=(o-e)/2,i=l=>Math.max(0,Math.min(t,l)),a=l=>Math.max(0,Math.min(o,l));return[[new m(i(n+e*.25),a(s+e*.52)),new m(i(n+e*.45),a(s+e*.82))],[new m(i(n+e*.45),a(s+e*.82)),new m(i(n+e*.82),a(s+e*.22))]]}const Rp=k.memo(function({dash:o,fill:e,color:n,strokeWidth:s,w:i,h:a,id:l,size:d}){const c=ie(),p=Xs(i,a,l,d),g=Co(i,a,l,d);return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:c,d:p,fill:e,color:n}),r.jsx("g",{strokeWidth:s,stroke:c[n].solid,fill:"none",pointerEvents:"all",children:g.map(({leftPoint:u,rightPoint:f,center:x,radius:S},v)=>{const b=x?S*on(on(m.Angle(x,f))-on(m.Angle(x,u))):m.Dist(u,f),{strokeDasharray:w,strokeDashoffset:E}=Ge(b,s,{style:o,start:"outset",end:"outset"});return r.jsx("path",{d:x?`M${u.x},${u.y}A${S},${S},0,0,1,${f.x},${f.y}`:`M${u.x},${u.y}L${f.x},${f.y}`,strokeDasharray:w,strokeDashoffset:E},v)})})]})}),Np=k.memo(function({w:o,h:e,strokeWidth:n,dash:s,color:i,fill:a}){const l=ie(),d=o/2,c=e/2,p=Math.max(0,d),g=Math.max(0,c),u=ho(p,g),{strokeDasharray:f,strokeDashoffset:x}=Ge(u<64?u*2:u,n,{style:s,snap:4,closed:!0}),S=`M${d-p},${c}a${p},${g},0,1,1,${p*2},0a${p},${g},0,1,1,-${p*2},0`;return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:l,d:S,color:i,fill:a}),r.jsx("path",{d:S,strokeWidth:n,width:j(o),height:j(e),fill:"none",stroke:l[i].solid,strokeDasharray:f,strokeDashoffset:x,pointerEvents:"all"})]})});function Bp(t,o){if(o>t){const n=t/2;return`
    M0,${n}
    a${n},${n},0,1,1,${n*2},0
    L${t},${o-n}
    a${n},${n},0,1,1,-${n*2},0
    Z`}const e=o/2;return`
    M${e},0
    L${t-e},0
    a${e},${e},0,1,1,0,${e*2}
    L${e},${o}
    a${e},${e},0,1,1,0,${-e*2}
    Z`}function Up(t,o){if(t>o){const n=o/2;return ho(n,n)+(t-n*2)*2}const e=t/2;return ho(e,e)+(o-e*2)*2}const Hp=k.memo(function({w:o,h:e,strokeWidth:n,dash:s,color:i,fill:a}){const l=ie(),d=Bp(o,e),c=Up(o,e),{strokeDasharray:p,strokeDashoffset:g}=Ge(c<64?c*2:c,n,{style:s,snap:4,start:"outset",end:"outset",closed:!0});return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:l,d,color:i,fill:a}),r.jsx("path",{d,strokeWidth:n,width:j(o),height:j(e),fill:"none",stroke:l[i].solid,strokeDasharray:p,strokeDashoffset:g,pointerEvents:"all"})]})}),Wp=k.memo(function({dash:o,fill:e,color:n,strokeWidth:s,outline:i,lines:a}){const l=ie(),d="M"+i[0]+"L"+i.slice(1)+"Z";return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:l,d,fill:e,color:n}),r.jsxs("g",{strokeWidth:s,stroke:l[n].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((c,p)=>{const g=i[p],u=i[(p+1)%i.length],f=m.Dist(g,u),{strokeDasharray:x,strokeDashoffset:S}=Ge(f,s,{style:o,start:"outset",end:"outset"});return r.jsx("line",{x1:g.x,y1:g.y,x2:u.x,y2:u.y,strokeDasharray:x,strokeDashoffset:S},p)}),a&&a.map(([c,p],g)=>{const u=m.Dist(c,p),{strokeDasharray:f,strokeDashoffset:x}=Ge(u,s,{style:o,start:"skip",end:"outset",snap:o==="dotted"?4:void 0});return r.jsx("path",{d:`M${c.x},${c.y}L${p.x},${p.y}`,stroke:l[n].solid,strokeWidth:s,fill:"none",strokeDasharray:f,strokeDashoffset:x},`line_fg_${g}`)})]})]})}),Gp=k.memo(function({fill:o,color:e,strokeWidth:n,w:s,h:i,id:a,size:l}){const d=ie(),c=Ap(s,i,a,l);return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:d,d:c,fill:o,color:e}),r.jsx("path",{d:c,stroke:d[e].solid,strokeWidth:n,fill:"none"})]})}),Kp=k.memo(function({id:o,outline:e,lines:n,fill:s,color:i,strokeWidth:a}){const l=ie(),d=ks(o,e,a/3,a*2,2);let c=vs(d);if(n)for(const[u,f]of n)c+=`M${u.x},${u.y}L${f.x},${f.y}`;const p=ks(o,e,0,a*2,1),g=vs(p);return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:g,fill:s,color:i,theme:l}),r.jsx("path",{d:c,stroke:l[i].solid,strokeWidth:a,fill:"none"})]})}),Vp=k.memo(function({fill:o,color:e,strokeWidth:n,w:s,h:i,id:a,size:l}){const d=ie(),c=Xs(s,i,a,l);return r.jsxs(r.Fragment,{children:[r.jsx(re,{theme:d,d:c,fill:o,color:e}),r.jsx("path",{d:c,stroke:d[e].solid,strokeWidth:n,fill:"none"})]})}),zi=k.memo(function({w:o,h:e,strokeWidth:n,fill:s,color:i}){const a=ie(),l=o/2,d=e/2,c=Math.max(0,l),p=Math.max(0,d),g=`M${l-c},${d}a${c},${p},0,1,1,${c*2},0a${c},${p},0,1,1,-${c*2},0`;return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:g,color:i,fill:s,theme:a}),r.jsx("path",{d:g,stroke:a[i].solid,strokeWidth:n,fill:"none"})]})}),Oi=k.memo(function({w:o,h:e,strokeWidth:n,fill:s,color:i}){const a=ie(),l=ia(o,e);return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:l,color:i,fill:s,theme:a}),r.jsx("path",{d:l,stroke:a[i].solid,strokeWidth:n,fill:"none"})]})});function ia(t,o){let e;if(o>t){const n=t/2;e=`
    M0,${n}
    a${n},${n},0,1,1,${n*2},0
    L${t},${o-n}
    a${n},${n},0,1,1,-${n*2},0
    Z`}else{const n=o/2;e=`
    M${n},0
    L${t-n},0
    a${n},${n},0,1,1,0,${n*2}
    L${n},${o}
    a${n},${n},0,1,1,0,${-n*2}
    Z`}return e}const Yp=k.memo(function({outline:o,lines:e,fill:n,color:s,strokeWidth:i}){const a=ie();let l="M"+o[0]+"L"+o.slice(1)+"Z";if(e)for(const[d,c]of e)l+=`M${d.x},${d.y}L${c.x},${c.y}`;return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:l,fill:n,color:s,theme:a}),r.jsx("path",{d:l,stroke:a[s].solid,strokeWidth:i,fill:"none"})]})});function Fi({shape:t}){const o=A(),{id:e,props:n}=t,{w:s,color:i,fill:a,dash:l,growY:d,size:c}=n,p=le[c],g=n.h+d;switch(n.geo){case"cloud":{if(l==="solid")return r.jsx(Vp,{color:i,fill:a,strokeWidth:p,w:s,h:g,id:e,size:c});if(l==="dashed"||l==="dotted")return r.jsx(Rp,{color:i,fill:a,strokeWidth:p,w:s,h:g,id:e,size:c,dash:l});if(l==="draw")return r.jsx(Gp,{color:i,fill:a,strokeWidth:p,w:s,h:g,id:e,size:c});break}case"ellipse":{if(l==="solid")return r.jsx(zi,{strokeWidth:p,w:s,h:g,color:i,fill:a});if(l==="dashed"||l==="dotted")return r.jsx(Np,{id:e,strokeWidth:p,w:s,h:g,dash:l,color:i,fill:a});if(l==="draw")return r.jsx(zi,{strokeWidth:p,w:s,h:g,color:i,fill:a});break}case"oval":{if(l==="solid")return r.jsx(Oi,{strokeWidth:p,w:s,h:g,color:i,fill:a});if(l==="dashed"||l==="dotted")return r.jsx(Hp,{id:e,strokeWidth:p,w:s,h:g,dash:l,color:i,fill:a});if(l==="draw")return r.jsx(Oi,{strokeWidth:p,w:s,h:g,color:i,fill:a});break}default:{const u=o.getShapeGeometry(t),f=u instanceof ut?u.children[0].vertices:u.vertices,x=Ps(t.props,p);if(l==="solid")return r.jsx(Yp,{fill:a,color:i,strokeWidth:p,outline:f,lines:x});if(l==="dashed"||l==="dotted")return r.jsx(Wp,{dash:l,fill:a,color:i,strokeWidth:p,outline:f,lines:x});if(l==="draw")return r.jsx(Kp,{id:e,fill:a,color:i,strokeWidth:p,outline:f,lines:x})}}}const ke=17*3;class Wn extends Gt{constructor(){super(...arguments);h(this,"canEdit",()=>!0);h(this,"onEditEnd",e=>{const{id:n,type:s,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:s,props:{text:i.trimEnd()}}])});h(this,"onResize",(e,{handle:n,newPoint:s,scaleX:i,scaleY:a,initialShape:l})=>{let d=l.props.w*i,c=(l.props.h+l.props.growY)*a,p=0,g=0;if(e.props.text.trim()){let S=Math.max(Math.abs(d),ke),v=Math.max(Math.abs(c),ke);S<ke&&v===ke&&(S=ke),S===ke&&v<ke&&(v=ke);const b=vn(this.editor,{...e,props:{...e.props,w:S,h:v}}),w=Math.max(Math.abs(d),b.w)*Math.sign(d),E=Math.max(Math.abs(c),b.h)*Math.sign(c);p=Math.abs(w)-Math.abs(d),g=Math.abs(E)-Math.abs(c),d=w,c=E}const u=new m(0,0);i<0&&(u.x+=d),(n==="left"||n==="top_left"||n==="bottom_left")&&(u.x+=i<0?p:-p),a<0&&(u.y+=c),(n==="top"||n==="top_left"||n==="top_right")&&(u.y+=a<0?g:-g);const{x:f,y:x}=u.rot(e.rotation).add(s);return{x:f,y:x,props:{w:Math.max(Math.abs(d),1),h:Math.max(Math.abs(c),1),growY:0}}});h(this,"onBeforeCreate",e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const n=e.props.h,s=vn(this.editor,e).h;let i=null;if(s>n?i=s-n:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}});h(this,"onBeforeUpdate",(e,n)=>{const s=e.props.text,i=n.props.text;if(s===i&&e.props.font===n.props.font&&e.props.size===n.props.size)return;if(s&&!i)return{...n,props:{...n.props,growY:0}};const a=e.props.w,l=e.props.h,d=vn(this.editor,n),c=d.w,p=d.h;if(!s&&i&&i.length===1){let u=Math.max(a,c),f=Math.max(l,p);return e.props.w<ke&&e.props.h<ke&&(u=Math.max(u,ke),f=Math.max(f,ke),u=Math.max(u,f),f=Math.max(u,f)),{...n,props:{...n.props,w:u,h:f,growY:0}}}let g=null;if(p>l?g=p-l:e.props.growY&&(g=0),g!==null)return{...n,props:{...n.props,growY:g,w:Math.max(n.props.w,c)}};if(c>e.props.w)return{...n,props:{...n.props,w:c}}});h(this,"onDoubleClick",e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(e){const n=Math.max(1,e.props.w),s=Math.max(1,e.props.h+e.props.growY),i=n/2,a=s/2,l=le[e.props.size],d=e.props.fill!=="none";let c;switch(e.props.geo){case"cloud":{c=new ae({points:_p(n,s,e.id,e.props.size),isFilled:d});break}case"triangle":{c=new ae({points:[new m(i,0),new m(n,s),new m(0,s)],isFilled:d});break}case"diamond":{c=new ae({points:[new m(i,0),new m(n,a),new m(i,s),new m(0,a)],isFilled:d});break}case"pentagon":{c=new ae({points:Ao(n,s,5),isFilled:d});break}case"hexagon":{c=new ae({points:Ao(n,s,6),isFilled:d});break}case"octagon":{c=new ae({points:Ao(n,s,8),isFilled:d});break}case"ellipse":{c=new hc({width:n,height:s,isFilled:d});break}case"oval":{c=new dc({width:n,height:s,isFilled:d});break}case"star":{const w=zt/5/2,E=Math.floor(5/4)*2,C=5*2-E,y=0,P=Math.floor(5/2)*2,T=Math.cos(-ee+E*w)*n/2,_=Math.cos(-ee+C*w)*n/2,D=Math.sin(-ee+y*w)*s/2,M=Math.sin(-ee+P*w)*s/2,$=n-Math.abs(T-_),z=s-Math.abs(M-D),O=n/2+_-(n/2-T),W=s/2+D-(s/2-M),R=1,X=(n-O)/2,Q=(s-W)/2,Se=(n+$)/2,we=(s+z)/2,te=Se*R/2,pe=we*R/2;c=new ae({points:Array.from(Array(5*2)).map((Le,Kt)=>{const wt=-ee+Kt*w;return new m(X+(Kt%2?te:Se)*Math.cos(wt),Q+(Kt%2?pe:we)*Math.sin(wt))}),isFilled:d});break}case"rhombus":{const b=Math.min(n*.38,s*.38);c=new ae({points:[new m(b,0),new m(n,0),new m(n-b,s),new m(0,s)],isFilled:d});break}case"rhombus-2":{const b=Math.min(n*.38,s*.38);c=new ae({points:[new m(0,0),new m(n-b,0),new m(n,s),new m(b,s)],isFilled:d});break}case"trapezoid":{const b=Math.min(n*.38,s*.38);c=new ae({points:[new m(b,0),new m(n-b,0),new m(n,s),new m(0,s)],isFilled:d});break}case"arrow-right":{const b=Math.min(n,s)*.38,w=s*.16;c=new ae({points:[new m(0,w),new m(n-b,w),new m(n-b,0),new m(n,s/2),new m(n-b,s),new m(n-b,s-w),new m(0,s-w)],isFilled:d});break}case"arrow-left":{const b=Math.min(n,s)*.38,w=s*.16;c=new ae({points:[new m(b,0),new m(b,w),new m(n,w),new m(n,s-w),new m(b,s-w),new m(b,s),new m(0,s/2)],isFilled:d});break}case"arrow-up":{const b=n*.16,w=Math.min(n,s)*.38;c=new ae({points:[new m(n/2,0),new m(n,w),new m(n-b,w),new m(n-b,s),new m(b,s),new m(b,w),new m(0,w)],isFilled:d});break}case"arrow-down":{const b=n*.16,w=Math.min(n,s)*.38;c=new ae({points:[new m(b,0),new m(n-b,0),new m(n-b,s-w),new m(n,s-w),new m(n/2,s),new m(0,s-w),new m(b,s-w)],isFilled:d});break}case"check-box":case"x-box":case"rectangle":{c=new pt({width:n,height:s,isFilled:d});break}}const p=vn(this.editor,e),g=Math.min(100,n/2),u=Math.min(n,Math.max(p.w,Math.min(g,Math.max(1,n-8)))),f=Math.min(He[e.props.size]*he.lineHeight+Me*2,s/2),x=Math.min(s,Math.max(p.h,Math.min(f,Math.max(1,n-8)))),S=Ps(e.props,l),v=S?S.map(b=>new yo({points:b})):[];return new ut({children:[c,new pt({x:e.props.align==="start"?0:e.props.align==="end"?n-u:(n-u)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?s-x:(s-x)/2,width:u,height:x,isFilled:!0,isLabel:!0}),...v]})}getHandleSnapGeometry(e){const n=this.getGeometry(e),s=n.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:s,points:[...s.getVertices(),n.bounds.center]};case"cloud":case"ellipse":case"oval":return{outline:s,points:[n.bounds.center]};default:gn(e.props.geo)}}component(e){const{id:n,type:s,props:i}=e,{fill:a,font:l,align:d,verticalAlign:c,size:p,text:g}=i,u=e.id===this.editor.getOnlySelectedShapeId(),f=ie(),S=this.editor.getEditingShapeId()!==null||e.props.text;return r.jsxs(r.Fragment,{children:[r.jsx(gt,{id:n,children:r.jsx(Fi,{shape:e})}),S&&r.jsx(ft,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:r.jsx(Po,{id:n,type:s,font:l,fontSize:He[p],lineHeight:he.lineHeight,fill:a,align:d,verticalAlign:c,text:g,isSelected:u,labelColor:f[i.labelColor].solid,wrap:!0})}),e.props.url&&r.jsx(Bt,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){const{id:n,props:s}=e,{w:i,size:a}=s,l=s.h+s.growY,d=le[a];switch(s.geo){case"ellipse":return s.dash==="draw"?r.jsx("path",{d:zp(n,i,l,d)}):r.jsx("ellipse",{cx:i/2,cy:l/2,rx:i/2,ry:l/2});case"oval":return r.jsx("path",{d:ia(i,l)});case"cloud":return r.jsx("path",{d:Xs(i,l,n,a)});default:{const c=this.editor.getShapeGeometry(e),p=c instanceof ut?c.children[0].vertices:c.vertices;let g;if(s.dash==="draw"){const f=ks(n,p,0,d*2,1);g=vs(f)}else g="M"+p[0]+"L"+p.slice(1)+"Z";const u=Ps(e.props,d);if(u)for(const[f,x]of u)g+=`M${f.x},${f.y}L${x.x},${x.y}`;return r.jsx("path",{d:g})}}}toSvg(e,n){const{props:s}=e;n.addExportDef(Vs(e.props.fill));let i;if(s.text){n.addExportDef(Nt(e.props.font));const a=tt(n),l=this.editor.getShapeGeometry(e).bounds;i=r.jsx(ko,{fontSize:He[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:a[s.labelColor].solid,bounds:l})}return r.jsxs(r.Fragment,{children:[r.jsx(Fi,{shape:e}),i]})}getCanvasSvgDefs(){return[Ys()]}}h(Wn,"type","geo"),h(Wn,"props",lc),h(Wn,"migrations",cc);function vn(t,o){const e=o.props.text;if(!e)return{w:0,h:0};const n=t.textMeasure.measureText("w",{...he,fontFamily:Fe[o.props.font],fontSize:He[o.props.size],maxWidth:100}),s={s:2,m:3.5,l:5,xl:10},i=t.textMeasure.measureText(e,{...he,fontFamily:Fe[o.props.font],fontSize:He[o.props.size],minWidth:n.w,maxWidth:Math.max(0,Math.ceil(n.w+s[o.props.size]),Math.ceil(o.props.w-Me*2))});return{w:i.w+Me*2,h:i.h+Me*2}}function Zp(){const[t,o]=k.useState(!1);return k.useEffect(()=>{const n=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");o(n&&s.matches);const i=()=>o(n&&s.matches);return s.addEventListener("change",i),()=>s.removeEventListener("change",i)},[]),L(ht.forceSrgb)||!t?"srgb":"p3"}const Ri=.35,Ni=.82;class Gn extends Wt{constructor(){super(...arguments);h(this,"hideResizeHandles",e=>Pn(e));h(this,"hideRotateHandle",e=>Pn(e));h(this,"hideSelectionBoundsFg",e=>Pn(e));h(this,"onResize",(e,n)=>{const{scaleX:s,scaleY:i}=n,a=[];for(const l of e.props.segments)a.push({...l,points:l.points.map(({x:d,y:c,z:p})=>({x:s*d,y:i*c,z:p}))});return{props:{segments:a}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(e){const n=vt(e);if(Pn(e))return new Ls({x:-n/2,y:-n/2,radius:n/2,isFilled:!0});const{strokePoints:s,sw:i}=ra(e,n,!0),a=bs({strokeWidth:i,showAsComplete:!0});return vo(s,a),new ae({points:Ws(s,a),isFilled:!0})}component(e){return r.jsx(gt,{id:e.id,style:{opacity:Ri},children:r.jsx(kn,{strokeWidth:vt(e),shape:e})})}backgroundComponent(e){return r.jsx(gt,{id:e.id,style:{opacity:Ni},children:r.jsx(kn,{strokeWidth:vt(e),shape:e})})}indicator(e){var g;const n=cn(),s=vt(e),i=dn(e.props.segments);let a=s;!n&&!e.props.isPen&&i.length===1&&(a+=nt(e.id)()*(s/6));const l=e.props.isComplete||((g=ye(e.props.segments))==null?void 0:g.type)==="straight",d=bs({strokeWidth:s,showAsComplete:l}),c=Re(i,d);let p;return c.length<2?p=Xp(i[0],a):p=mt(c,!1),r.jsx("path",{d:p})}toSvg(e){return r.jsx(kn,{strokeWidth:vt(e),shape:e,opacity:Ri})}toBackgroundSvg(e){return r.jsx(kn,{strokeWidth:vt(e),shape:e,opacity:Ni})}}h(Gn,"type","highlight"),h(Gn,"props",pc),h(Gn,"migrations",uc);function qp(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function Xp(t,o){const e=o/2;return`M ${t.x} ${t.y} m -${e}, 0 a ${e},${e} 0 1,0 ${e*2},0 a ${e},${e} 0 1,0 -${e*2},0`}function ra(t,o,e){var d;const n=dn(t.props.segments),s=t.props.isComplete||((d=ye(t.props.segments))==null?void 0:d.type)==="straight";let i=o;!e&&!t.props.isPen&&n.length===1&&(i+=nt(t.id)()*(o/6));const a=bs({strokeWidth:i,showAsComplete:s});return{strokePoints:Re(n,a),sw:i}}function Jp(t,o,e){const{strokePoints:n,sw:s}=ra(t,o,e);return{solidStrokePath:n.length>1?mt(n,!1):qp(t.props.segments[0].points[0]),sw:s}}function kn({strokeWidth:t,shape:o,opacity:e}){const n=ie(),s=cn(),{solidStrokePath:i,sw:a}=Jp(o,t,s),l=Zp(),d=n[o.props.color].highlight[l];return r.jsx("path",{d:i,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:d,strokeWidth:a,opacity:e})}function vt(t){return Ft[t.props.size]*1.12}function Pn(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function aa(){return r.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),r.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),r.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function la(){const[t,o]=k.useState(!1);return k.useEffect(()=>{const e=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{o(e.matches)};return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),t}async function Qp(t){const e=await(await fetch(t)).blob();return _t.blobToDataUrl(e)}class Kn extends Gt{constructor(){super(...arguments);h(this,"isAspectRatioLocked",()=>!0);h(this,"canCrop",()=>!0);h(this,"onDoubleClick",e=>{const n=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;!n||!(n.props.src&&"mimeType"in n.props&&n.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])});h(this,"onDoubleClickEdge",e=>{const n=e.props;if(!n||this.editor.getCroppingShapeId()!==e.id)return;const s=We(n.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},i=1/(s.bottomRight.x-s.topLeft.x)*e.props.w,a=1/(s.bottomRight.y-s.topLeft.y)*e.props.h,l=new m(s.topLeft.x*i,s.topLeft.y*a).rot(e.rotation),d={id:e.id,type:e.type,x:e.x-l.x,y:e.y-l.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:a}};this.editor.updateShapes([d])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(e){var u,f;const n=this.editor.getCroppingShapeId()===e.id,s=la(),[i,a]=k.useState(""),l=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0,d=e.id===this.editor.getOnlySelectedShapeId();if(k.useEffect(()=>{if(l!=null&&l.props.src&&"mimeType"in l.props&&(l==null?void 0:l.props.mimeType)==="image/gif"){let x=!1;const S=l.props.src;if(!S)return;const v=new Image;return v.onload=()=>{if(x)return;const b=document.createElement("canvas");b.width=v.width,b.height=v.height;const w=b.getContext("2d");w&&(w.drawImage(v,0,0),a(b.toDataURL()))},v.crossOrigin="anonymous",v.src=S,()=>{x=!0}}},[s,l==null?void 0:l.props]),(l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const c=d&&n&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),p=s&&(((u=l==null?void 0:l.props.mimeType)==null?void 0:u.includes("video"))||((f=l==null?void 0:l.props.mimeType)==null?void 0:f.includes("gif"))),g=Bi(e);return l!=null&&l.props.src?r.jsxs(r.Fragment,{children:[c&&r.jsx("div",{style:g,children:r.jsx("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!e.props.playing||p?i:l.props.src})`},draggable:!1})}),r.jsxs(ft,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[r.jsxs("div",{className:"tl-image-container",style:g,children:[r.jsx("div",{className:"tl-image",style:{backgroundImage:`url(${!e.props.playing||p?i:l.props.src})`},draggable:!1}),l.props.isAnimated&&!e.props.playing&&r.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),")",e.props.url&&r.jsx(Bt,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):r.jsxs(ft,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:l?"transparent":"var(--color-low)",border:l?"none":"1px solid var(--color-low-border)"},children:[r.jsx("div",{className:"tl-image-container",style:g,children:l?null:r.jsx(aa,{})}),")","url"in e.props&&e.props.url&&r.jsx(Bt,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:r.jsx("rect",{width:j(e.props.w),height:j(e.props.h)})}async toSvg(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):null;if(!n)return null;let s=(n==null?void 0:n.props.src)||"";(s.startsWith("http")||s.startsWith("/")||s.startsWith("./"))&&(s=await Qp(s)||"");const i=Bi(e),a=e.props.crop;if(i.transform&&a){const{transform:l,width:d,height:c}=i,p=(a.bottomRight.x-a.topLeft.x)*d,g=(a.bottomRight.y-a.topLeft.y)*c,u=[new m(0,0),new m(p,0),new m(p,g),new m(0,g)],f=`cropClipPath_${e.id.replace(":","_")}`;return r.jsxs(r.Fragment,{children:[r.jsx("defs",{children:r.jsx("clipPath",{id:f,children:r.jsx("polygon",{points:u.map(x=>`${x.x},${x.y}`).join(" ")})})}),r.jsx("g",{clipPath:"url(#{cropClipId})",children:r.jsx("image",{href:s,width:d,height:c,style:{transform:l}})})]})}else return r.jsx("image",{href:s,width:e.props.w,height:e.props.h})}}h(Kn,"type","image"),h(Kn,"props",gc),h(Kn,"migrations",fc);function Bi(t){const o=t.props.crop,e=o==null?void 0:o.topLeft;if(!e)return{width:t.props.w,height:t.props.h};const n=1/(o.bottomRight.x-o.topLeft.x)*t.props.w,s=1/(o.bottomRight.y-o.topLeft.y)*t.props.h,i=-e.x*n,a=-e.y*s;return{transform:`translate(${i}px, ${a}px)`,width:n,height:s}}function ca(t,o){const{start:e,end:n}=t;return o?`M${j(e.x)},${j(e.y)} L${j(n.x)},${j(n.y)} `:`${j(n.x)},${j(n.y)} `}function da(t,o){const{a:e,b:n,c:s,d:i}=t;return m.Equals(e,i)?"":`${o?`M${j(e.x)},${j(e.y)}`:""}C${j(n.x)},${j(n.y)} ${j(s.x)},${j(s.y)} ${j(i.x)},${j(i.y)}`}function eu(t,o){let e=t.segments.reduce((n,s,i)=>n+da(s,i===0),"");return o&&(e+="Z"),e}function tu(t,o){let e=t.segments.reduce((n,s,i)=>n+ca(s,i===0),"");return o&&(e+="Z"),e}function ha(t,o=!1){return t instanceof yo?tu(t,o):eu(t,o)}function pa(t){return{size:t,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function ua(t,o,e){const n=o.vertices,s=pa(e);return Re(n,s)}function nu(t,o,e){const n=pa(e);return Ws(vo(ua(t,o,e),n),n)}function ou(t,o,e){const n=nu(t,o,e);return ar(n)}function su(t,o,e){if(t.props.dash==="draw"){const n=ua(t,o,e);return mt(n)}return ha(o)}const iu=new Fs;class Vn extends Wt{constructor(){super(...arguments);h(this,"hideResizeHandles",()=>!0);h(this,"hideRotateHandle",()=>!0);h(this,"hideSelectionBoundsFg",()=>!0);h(this,"hideSelectionBoundsBg",()=>!0);h(this,"onResize",(e,n)=>{const{scaleX:s,scaleY:i}=n;return{props:{points:gr(e.props.points,(a,{id:l,index:d,x:c,y:p})=>({id:l,index:d,x:c*s,y:p*i}))}}});h(this,"onHandleDrag",(e,{handle:n})=>{if(n.type==="vertex")return{...e,props:{...e.props,points:{...e.props.points,[n.id]:{id:n.id,index:n.index,x:n.x,y:n.y}}}}})}getDefaultProps(){const[e,n]=fr(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[n]:{id:n,index:n,x:.1,y:.1}}}}getGeometry(e){return en(e)}getHandles(e){return iu.get(e.props,()=>{const n=en(e),s=Cs(e),i=s.map(a=>({...a,id:a.index,type:"vertex",canSnap:!0}));for(let a=0;a<s.length-1;a++){const l=mr(s[a].index,s[a+1].index),c=n.segments[a].midPoint();i.push({id:l,type:"create",index:l,x:c.x,y:c.y,canSnap:!0})}return i.sort(xo)})}component(e){return r.jsx(gt,{id:e.id,children:r.jsx(Ui,{shape:e})})}indicator(e){const n=le[e.props.size],s=en(e),{dash:i}=e.props;let a;if(e.props.spline==="line"){const l=s.points;if(i==="solid"||i==="dotted"||i==="dashed")a="M"+l[0]+"L"+l.slice(1);else{const[d]=na(e.id,l,n);a=d}}else a=su(e,s,n);return r.jsx("path",{d:a})}toSvg(e){return r.jsx(Ui,{shape:e})}getHandleSnapGeometry(e){const n=Cs(e);return{points:n,getSelfSnapPoints:s=>{const i=this.getHandles(e).filter(a=>a.type==="vertex").findIndex(a=>a.id===s.id);return n.filter((a,l)=>Math.abs(l-i)>1).map(m.From)},getSelfSnapOutline:s=>{const i=this.getHandles(e).filter(l=>l.type==="vertex").findIndex(l=>l.id===s.id),a=en(e).segments.filter((l,d)=>d!==i-1&&d!==i);return a.length?new ut({children:a}):null}}}}h(Vn,"type","line"),h(Vn,"props",mc),h(Vn,"migrations",xc);function Cs(t){return Object.values(t.props.points).sort(xo)}function en(t){const o=Cs(t).map(m.From);switch(t.props.spline){case"cubic":return new Sc({points:o});case"line":return new yo({points:o})}}function Ui({shape:t}){const o=ie(),e=en(t),n=le[t.props.size],{dash:s,color:i}=t.props;if(t.props.spline==="line"){if(s==="solid"){const a=e.points,l="M"+a[0]+"L"+a.slice(1);return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:l,fill:"none",color:i,theme:o}),r.jsx("path",{d:l,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})}if(s==="dashed"||s==="dotted"){const a=e.points,l="M"+a[0]+"L"+a.slice(1);return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:l,fill:"none",color:i,theme:o}),r.jsx("g",{stroke:o[i].solid,strokeWidth:n,children:e.segments.map((d,c)=>{const{strokeDasharray:p,strokeDashoffset:g}=Ge(d.length,n,{style:s,start:c>0?"outset":"none",end:c<e.segments.length-1?"outset":"none"});return r.jsx("path",{strokeDasharray:p,strokeDashoffset:g,d:ca(d,!0),fill:"none"},c)})})]})}if(s==="draw"){const a=e.points,[l,d]=na(t.id,a,n);return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:l,fill:"none",color:i,theme:o}),r.jsx("path",{d,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})}}if(t.props.spline==="cubic"){const a=ha(e);if(s==="solid")return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:a,fill:"none",color:i,theme:o}),r.jsx("path",{strokeWidth:n,stroke:o[i].solid,fill:"none",d:a})]});if(s==="dashed"||s==="dotted")return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:a,fill:"none",color:i,theme:o}),r.jsx("g",{stroke:o[i].solid,strokeWidth:n,children:e.segments.map((l,d)=>{const{strokeDasharray:c,strokeDashoffset:p}=Ge(l.length,n,{style:s,start:d>0?"outset":"none",end:d<e.segments.length-1?"outset":"none"});return r.jsx("path",{strokeDasharray:c,strokeDashoffset:p,d:da(l,!0),fill:"none"},d)})})]});if(s==="draw")return r.jsxs(r.Fragment,{children:[r.jsx(re,{d:a,fill:"none",color:i,theme:o}),r.jsx("path",{d:ou(t,e,n),strokeWidth:1,stroke:o[i].solid,fill:o[i].solid})]})}}const ga=k.createContext(null);function ru({assetUrls:t,children:o}){return k.useEffect(()=>{for(const e of Object.values(t.icons)){const n=new Image;n.src=e,n.decode()}for(const e of Object.values(t.embedIcons)){const n=new Image;n.src=e,n.decode()}},[t]),r.jsx(ga.Provider,{value:t,children:o})}function Js(){const t=k.useContext(ga);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const js={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},au=new Set(["ar","fa","he","ur","ku"]),kt={locale:"en",label:"English",messages:js,dir:"ltr"};async function lu(t,o){if(!(await fetch(o.translations.en)).ok)return console.warn("No main translations found."),kt;if(t==="en")return kt;const n=Rs.find(a=>a.locale===t);if(!n)return console.warn(`No translation found for locale ${t}`),kt;const i=await(await fetch(o.translations[n.locale])).json();if(!i)return console.warn(`No messages found for locale ${t}`),kt;for(const a in kt.messages)i[a];return{locale:t,label:n.label,dir:au.has(n.locale)?"rtl":"ltr",messages:{...kt.messages,...i}}}const fa=k.createContext({}),ma=()=>k.useContext(fa),cu=Ke(function({overrides:o,children:e}){const s=A().user.getLocale(),i=Js(),[a,l]=k.useState(()=>o&&o.en?{locale:"en",label:"English",dir:"ltr",messages:{...js,...o.en}}:{locale:"en",label:"English",dir:"ltr",messages:js});return k.useEffect(()=>{let d=!1;async function c(){const p=await lu(s,i);p&&!d&&(o&&o[s]?l({...p,messages:{...p.messages,...o[s]}}):l(p))}return c(),()=>{d=!0}},[i,s,o]),r.jsx(fa.Provider,{value:a,children:e})});function V(){const t=ma();return k.useCallback(function(e){return t.messages[e]??e},[t])}class Yn extends Wt{constructor(){super(...arguments);h(this,"canEdit",()=>!0);h(this,"hideResizeHandles",()=>!0);h(this,"hideSelectionBoundsFg",()=>!1);h(this,"onBeforeCreate",e=>Hi(this.editor,e));h(this,"onBeforeUpdate",(e,n)=>{if(!(e.props.text===n.props.text&&e.props.font===n.props.font&&e.props.size===n.props.size))return Hi(this.editor,n)});h(this,"onEditEnd",e=>{const{id:n,type:s,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:n,type:s,props:{text:i.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:""}}getGeometry(e){const n=Cn(e),{labelHeight:s,labelWidth:i}=xa(this.editor,e);return new ut({children:[new pt({width:K,height:n,isFilled:!0}),new pt({x:e.props.align==="start"?0:e.props.align==="end"?K-i:(K-i)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?n-s:(n-s)/2,width:i,height:s,isFilled:!0,isLabel:!0})]})}getHandles(e){const n=this.editor.getZoomLevel(),s=Mh/n,i=Cn(e),a=this.editor.getInstanceState().isCoarsePointer;return n<.25||a?[]:n<.5?[{id:"bottom",index:"a3",type:"clone",x:K/2,y:i+s}]:[{id:"top",index:"a1",type:"clone",x:K/2,y:-s},{id:"right",index:"a2",type:"clone",x:K+s,y:i/2},{id:"bottom",index:"a3",type:"clone",x:K/2,y:i+s},{id:"left",index:"a4",type:"clone",x:-s,y:i/2}]}component(e){const{id:n,type:s,props:{color:i,font:a,size:l,align:d,text:c,verticalAlign:p,fontSizeAdjustment:g}}=e,u=pu(n),f=ie(),x=Cn(e),S=L("shape rotation",()=>{var w;return((w=this.editor.getShapePageTransform(n))==null?void 0:w.rotation())??0},[this.editor]),v=cn(),b=e.id===this.editor.getOnlySelectedShapeId();return r.jsxs(r.Fragment,{children:[r.jsx("div",{id:n,className:"tl-note__container",style:{width:K,height:x,backgroundColor:f[i].note.fill,borderBottom:v?"3px solid rgb(15, 23, 31, .2)":"none",boxShadow:v?"none":uu(e.id,S)},children:r.jsx(Po,{id:n,type:s,font:a,fontSize:g||He[l],lineHeight:he.lineHeight,align:d,verticalAlign:p,text:c,isNote:!0,isSelected:b,labelColor:f[i].note.text,wrap:!0,onKeyDown:u})}),"url"in e.props&&e.props.url&&r.jsx(Bt,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return r.jsx("rect",{rx:"1",width:j(K),height:j(Cn(e))})}toSvg(e,n){n.addExportDef(Nt(e.props.font)),e.props.text&&n.addExportDef(Nt(e.props.font));const s=tt({isDarkMode:n.isDarkMode}),i=this.editor.getShapeGeometry(e).bounds;return r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:5,y:5,rx:1,width:K-10,height:i.h,fill:"rgba(0,0,0,.1)"}),r.jsx("rect",{rx:1,width:K,height:i.h,fill:s[e.props.color].note.fill}),r.jsx(ko,{fontSize:e.props.fontSizeAdjustment||He[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:s[e.props.color].note.text,bounds:i,stroke:!1})]})}}h(Yn,"type","note"),h(Yn,"props",yc),h(Yn,"migrations",bc);function Hi(t,o){const{labelHeight:e,fontSizeAdjustment:n}=xa(t,o),s=Math.max(0,e-K);if(s!==o.props.growY||n!==o.props.fontSizeAdjustment)return{...o,props:{...o.props,growY:s,fontSizeAdjustment:n}}}function du(t,o){const e=o.props.text;if(!e)return{labelHeight:He[o.props.size]*he.lineHeight+Me*2,labelWidth:100,fontSizeAdjustment:0};const n=He[o.props.size];let s=0,i=0,a=K,l=K;const d=1;do{s=Math.min(n,n-i);const c=t.textMeasure.measureText(e,{...he,fontFamily:Fe[o.props.font],fontSize:s,maxWidth:K-Me*2-d,disableOverflowWrapBreaking:!0});if(a=c.h+Me*2,l=c.w+Me*2,s<=14){const p=t.textMeasure.measureText(e,{...he,fontFamily:Fe[o.props.font],fontSize:s,maxWidth:K-Me*2-d});a=p.h+Me*2,l=p.w+Me*2;break}if(c.scrollWidth.toFixed(0)===c.w.toFixed(0))break}while(i++<50);return{labelHeight:a,labelWidth:l,fontSizeAdjustment:s}}const hu=new Fs;function xa(t,o){return hu.get(o,()=>du(t,o))}function pu(t){const o=A(),e=ma();return k.useCallback(n=>{const s=o.getShape(t);if(!s)return;const i=n.key==="Tab",a=(n.metaKey||n.ctrlKey)&&n.key==="Enter";if(i||a){n.preventDefault();const l=o.getShapePageTransform(t),d=l.rotation(),c=!!(e.dir==="rtl"||Rr(s.props.text)),p=K+ct+(a&&!n.shiftKey?s.props.growY:0),g=new m(i?n.shiftKey!=c?-1:1:0,a?n.shiftKey?-1:1:0).mul(p).add(Ks).rot(d).add(l.point()),u=Vr(o,s,g,d);u&&(o.mark("editing adjacent shape"),po(o,u,!0))}},[t,o,e.dir])}function Cn(t){return K+t.props.growY}function uu(t,o){const e=nt(t),n=Math.abs(e())+.5,s=Math.cos(o);return`0px ${5-n}px 5px -5px rgba(15, 23, 31, .6),
	0px ${(4+n*7)*Math.max(0,s)}px ${6+n*7}px -${4+n*6}px rgba(15, 23, 31, ${(.3+n*.1).toFixed(2)}), 
	0px 48px 10px -10px inset rgba(15, 23, 44, ${((.022+e()*.005)*((1+s)/2)).toFixed(2)})`}function gu(t,{initialBounds:o,scaleX:e,scaleY:n,newPoint:s}){const i=Math.max(.01,Math.min(Math.abs(e),Math.abs(n))),a=new m(0,0);e<0&&(a.x=-(o.width*i)),n<0&&(a.y=-(o.height*i));const{x:l,y:d}=m.Add(s,a.rot(t.rotation));return{x:l,y:d,props:{scale:i*t.props.scale}}}const fu=new Fs;class Zn extends Wt{constructor(){super(...arguments);h(this,"canEdit",()=>!0);h(this,"isAspectRatioLocked",()=>!0);h(this,"onResize",(e,n)=>{const{initialBounds:s,initialShape:i,scaleX:a,handle:l}=n;if(n.mode==="scale_shape"||l!=="right"&&l!=="left")return{id:e.id,type:e.type,...gu(e,n)};{const d=s.width;let c=d*a;const p=new m(0,0);c=Math.max(1,Math.abs(c)),l==="left"?(p.x=d-c,a<0&&(p.x+=c)):a<0&&(p.x-=c);const{x:g,y:u}=p.rot(e.rotation).add(i);return{id:e.id,type:e.type,x:g,y:u,props:{w:c/i.props.scale,autoSize:!1}}}});h(this,"onBeforeCreate",e=>{if(!e.props.autoSize||e.props.text.trim())return;const n=this.getMinDimensions(e);return{...e,x:e.x-n.width/2,y:e.y-n.height/2}});h(this,"onEditEnd",e=>{const{id:n,type:s,props:{text:i}}=e,a=e.props.text.trimEnd();a.length===0?this.editor.deleteShapes([e.id]):a!==e.props.text&&this.editor.updateShapes([{id:n,type:s,props:{text:i.trimEnd()}}])});h(this,"onBeforeUpdate",(e,n)=>{if(!n.props.autoSize)return;const s=e.props.size!==n.props.size||e.props.align!==n.props.align||e.props.font!==n.props.font||e.props.scale!==1&&n.props.scale===1,i=e.props.text!==n.props.text;if(!s&&!i)return;const a=this.getMinDimensions(e),l=Wi(this.editor,n.props),d=a.width*e.props.scale,c=a.height*e.props.scale,p=l.width*n.props.scale,g=l.height*n.props.scale;let u;switch(n.props.align){case"middle":{u=new m((p-d)/2,i?0:(g-c)/2);break}case"end":{u=new m(p-d,i?0:(g-c)/2);break}default:{if(i)break;u=new m(0,(g-c)/2);break}}if(u){u.rot(n.rotation);const{x:f,y:x}=n;return{...n,x:f-u.x,y:x-u.y,props:{...n.props,w:p}}}else return{...n,props:{...n.props,w:p}}});h(this,"onDoubleClickEdge",e=>{if(!e.props.autoSize)return{id:e.id,type:e.type,props:{autoSize:!0}};if(e.props.scale!==1)return{id:e.id,type:e.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(e){return fu.get(e.props,n=>Wi(this.editor,n))}getGeometry(e){const{scale:n}=e.props,{width:s,height:i}=this.getMinDimensions(e);return new pt({width:s*n,height:i*n,isFilled:!0,isLabel:!0})}component(e){const{id:n,props:{font:s,size:i,text:a,color:l,scale:d,align:c}}=e,{width:p,height:g}=this.getMinDimensions(e),u=e.id===this.editor.getOnlySelectedShapeId(),f=ie(),x=mu(n);return r.jsx(Po,{id:n,classNamePrefix:"tl-text-shape",type:"text",font:s,fontSize:Ft[i],lineHeight:he.lineHeight,align:c,verticalAlign:"middle",text:a,labelColor:f[l].solid,isSelected:u,textWidth:p,textHeight:g,style:{transform:`scale(${d})`,transformOrigin:"top left"},wrap:!0,onKeyDown:x})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds,s=A();return e.props.autoSize&&s.getEditingShapeId()===e.id?null:r.jsx("rect",{width:j(n.width),height:j(n.height)})}toSvg(e,n){n.addExportDef(Nt(e.props.font)),e.props.text&&n.addExportDef(Nt(e.props.font));const s=this.editor.getShapeGeometry(e).bounds,i=s.width/(e.props.scale??1),a=s.height/(e.props.scale??1),l=tt(n);return r.jsx(ko,{fontSize:Ft[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:"middle",text:e.props.text,labelColor:l[e.props.color].solid,bounds:new Z(0,0,i,a),padding:0})}}h(Zn,"type","text"),h(Zn,"props",wc),h(Zn,"migrations",vc);function Wi(t,o){const{font:e,text:n,autoSize:s,size:i,w:a}=o,l=s?16:Math.max(16,a),d=Ft[i],c=s?null:Math.floor(Math.max(l,a)),p=t.textMeasure.measureText(n,{...he,fontFamily:Fe[e],fontSize:d,maxWidth:c});return s&&(p.w+=1),{width:Math.max(l,p.w),height:Math.max(d,p.h)}}function mu(t){const o=A();return k.useCallback(e=>{if(o.getEditingShapeId()===t)switch(e.key){case"Enter":{(e.ctrlKey||e.metaKey)&&o.complete();break}case"Tab":{de(e),e.shiftKey?Rt.unindent(e.currentTarget):Rt.indent(e.currentTarget);break}}},[o,t])}class qn extends Gt{constructor(){super(...arguments);h(this,"canEdit",()=>!0);h(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{editor:n}=this,s=n.getShapeGeometry(e).bounds.w*n.getZoomLevel()>=110,i=e.props.assetId?n.getAsset(e.props.assetId):null,{time:a,playing:l}=e.props,d=So(e.id),c=la(),p=k.useRef(null),g=k.useCallback(b=>{const w=b.currentTarget;w&&n.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:w.currentTime}}])},[e.id,n]),u=k.useCallback(b=>{const w=b.currentTarget;w&&n.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:w.currentTime}}])},[e.id,n]),f=k.useCallback(b=>{const w=b.currentTarget;w&&d&&n.updateShapes([{type:"video",id:e.id,props:{time:w.currentTime}}])},[d,e.id,n]),[x,S]=k.useState(!1),v=k.useCallback(b=>{const w=b.currentTarget;w&&(a!==w.currentTime&&(w.currentTime=a),l||w.pause(),S(!0))},[l,a]);return k.useEffect(()=>{const b=p.current;b&&(x&&!d&&a!==b.currentTime&&(b.currentTime=a),d&&document.activeElement!==b&&b.focus())},[d,x,a]),k.useEffect(()=>{if(c){const b=p.current;if(!b)return;b.pause(),b.currentTime=0}},[p,c]),r.jsxs(r.Fragment,{children:[r.jsx(ft,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:i?"transparent":"var(--color-low)",border:i?"none":"1px solid var(--color-low-border)"},children:r.jsx("div",{className:"tl-counter-scaled",children:r.jsx("div",{className:"tl-video-container",children:i!=null&&i.props.src?r.jsx("video",{ref:p,style:d?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:d&&s,onPlay:g,onPause:u,onTimeUpdate:f,onLoadedData:v,hidden:!x,children:r.jsx("source",{src:i.props.src})}):r.jsx(aa,{})})})}),"url"in e.props&&e.props.url&&r.jsx(Bt,{url:e.props.url,zoomLevel:n.getZoomLevel()})]})}indicator(e){return r.jsx("rect",{width:j(e.props.w),height:j(e.props.h)})}toSvg(e){return r.jsx("image",{href:xu(e.id),width:e.props.w,height:e.props.h})}}h(qn,"type","video"),h(qn,"props",kc),h(qn,"migrations",Pc);function xu(t){const o=t.split(":")[1],e=document.querySelector(`.tl-video-shape-${o}`);if(e){const n=document.createElement("canvas");return n.width=e.videoWidth,n.height=e.videoHeight,n.getContext("2d").drawImage(e,0,0),n.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const Sa=[Zn,Nn,Bn,Wn,Yn,Vn,Hn,Rn,Gn,Un,Kn,qn];function Su(t){return[t.sideEffects.registerAfterChangeHandler("instance",(o,e)=>{o.isFocused!==e.isFocused&&(e.isFocused?t.getContainer().focus():(t.complete(),t.getContainer().blur()))}),t.sideEffects.registerAfterChangeHandler("instance_page_state",(o,e)=>{if(o.croppingShapeId!==e.croppingShapeId){const n=t.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!o.croppingShapeId&&e.croppingShapeId?n||t.setCurrentTool("select.crop.idle"):o.croppingShapeId&&!e.croppingShapeId&&n&&t.setCurrentTool("select.idle")}o.editingShapeId!==e.editingShapeId&&(!o.editingShapeId&&e.editingShapeId?t.isIn("select.editing_shape")||t.setCurrentTool("select.editing_shape"):o.editingShapeId&&!e.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle"))})]}class ya extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"scribbleId","id");h(this,"markId","");h(this,"excludedShapeIds",new Set);h(this,"onEnter",e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;const{originPagePoint:n}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const a=this.editor.getPointInShapeSpace(i,n);return this.editor.getShapeGeometry(i).bounds.containsPoint(a)}return!1}).map(i=>i.id));const s=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=s.id,this.update()});h(this,"pushPointToScribble",()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)});h(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});h(this,"onPointerMove",()=>{this.update()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()})}update(){const{editor:e,excludedShapeIds:n}=this,s=e.getErasingShapeIds(),i=e.getZoomLevel(),a=e.getCurrentPageShapes(),{inputs:{currentPagePoint:l,previousPagePoint:d}}=e;this.pushPointToScribble();const c=new Set(s),p=Qe/i;for(const g of a){if(e.isShapeOfType(g,"group"))continue;const u=e.getShapeMask(g.id);if(u&&!Ht(l,u))continue;const f=e.getShapeGeometry(g),x=e.getShapePageTransform(g);if(!f||!x)continue;const S=x.clone().invert(),v=S.applyToPoint(d),b=S.applyToPoint(l),{bounds:w}=f;w.minX-p>Math.max(v.x,b.x)||w.minY-p>Math.max(v.y,b.y)||w.maxX+p<Math.min(v.x,b.x)||w.maxY+p<Math.min(v.y,b.y)||f.hitTestLineSegment(v,b,p)&&c.add(e.getOutermostSelectableShape(g).id)}this.editor.setErasingShapes([...c].filter(g=>!n.has(g)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}h(ya,"id","erasing");var ts;let yu=(ts=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(ts,"id","idle"),ts);var ns;let bu=(ns=class extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{const e=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:s}}=this.editor,i=new Set,a=i.size;for(let l=n.length,d=l-1;d>=0;d--){const c=n[d];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,s,{hitInside:!1,margin:Qe/e})){const p=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(p,"frame")&&i.size>a)break;i.add(p.id)}}this.editor.setErasingShapes([...i])});h(this,"onLongPress",e=>{this.startErasing(e)});h(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startErasing(e)});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.cancel()})}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},h(ns,"id","pointing"),ns);class Xn extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}h(Xn,"id","eraser"),h(Xn,"initial","idle"),h(Xn,"children",()=>[yu,bu,ya]);class ba extends N{constructor(){super(...arguments);h(this,"initialCamera",new m);h(this,"onEnter",()=>{this.initialCamera=m.From(this.editor.getCamera()),this.update()});h(this,"onPointerMove",()=>{this.update()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.parent.transition("idle")});h(this,"onComplete",()=>{this.complete()})}update(){const{initialCamera:e,editor:n}=this,{currentScreenPoint:s,originScreenPoint:i}=n.inputs,a=m.Sub(s,i).div(n.getZoomLevel());a.len2()!==0&&n.setCamera(e.clone().add(a))}complete(){const{editor:e}=this,{pointerVelocity:n}=e.inputs,s=Math.min(n.len(),2);s>.1&&this.editor.slideCamera({speed:s,direction:n,friction:Cc}),this.parent.transition("idle")}}h(ba,"id","dragging");var os;let wu=(os=class extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});h(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});h(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},h(os,"id","idle"),os);var ss;let vu=(ss=class extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});h(this,"onLongPress",()=>{this.startDragging()});h(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startDragging()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.complete()})}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},h(ss,"id","pointing"),ss);class Jn extends N{constructor(){super(...arguments);h(this,"onDoubleClick",e=>{if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomIn(n,{duration:220,easing:Ce.easeOutQuint})}});h(this,"onTripleClick",e=>{if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomOut(n,{duration:320,easing:Ce.easeOutQuint})}});h(this,"onQuadrupleClick",e=>{if(e.phase==="settle"){const n=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:s}}=this.editor;n===1?this.editor.zoomToFit({duration:400,easing:Ce.easeOutQuint}):this.editor.resetZoom(s,{duration:320,easing:Ce.easeOutQuint})}})}}h(Jn,"id","hand"),h(Jn,"initial","idle"),h(Jn,"children",()=>[wu,vu,ba]);var is;let ku=(is=class extends N{constructor(){super(...arguments);h(this,"onPointerDown",e=>{this.parent.transition("lasering",e)})}},h(is,"id","idle"),is);class wa extends N{constructor(){super(...arguments);h(this,"scribbleId","id");h(this,"onEnter",()=>{const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()});h(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});h(this,"onPointerMove",()=>{this.pushPointToScribble()});h(this,"onPointerUp",()=>{this.complete()});h(this,"pushPointToScribble",()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}h(wa,"id","lasering");class Qn extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}h(Qn,"id","laser"),h(Qn,"initial","idle"),h(Qn,"children",()=>[ku,wa]);class va extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"initialSelectedShapeIds",[]);h(this,"excludedShapeIds",new Set);h(this,"isWrapMode",!1);h(this,"initialStartShape",null);h(this,"onEnter",e=>{const{altKey:n,currentPagePoint:s}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),n){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>this.editor.isShapeOfType(i,"group")||this.editor.isShapeOrAncestorLocked(i)).map(i=>i.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(s)[0],this.hitTestShapes()});h(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});h(this,"onTick",()=>{Ns(this.editor)});h(this,"onPointerMove",()=>{this.hitTestShapes()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)});h(this,"onKeyDown",e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()});h(this,"onKeyUp",()=>{this.hitTestShapes()});h(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:n,isWrapMode:s}=this,{inputs:{originPagePoint:i,currentPagePoint:a,shiftKey:l,ctrlKey:d}}=e,c=new Set(l?this.initialSelectedShapeIds:[]),p=s?!d:d,g=Z.FromPoints([i,a]),{corners:u}=g;let f,x,S,v,b,w;const E=e.getCurrentPageShapes(),C=e.getCurrentPageId();e:for(let T=0,_=E.length;T<_;T++){if(S=E[T],n.has(S.id)||c.has(S.id)||(v=e.getShapePageBounds(S),!v))continue e;if(g.contains(v)){this.handleHit(S,a,C,c,u);continue e}if(p||e.isShapeOfType(S,"frame"))continue e;if(g.collides(v)){if(b=e.getShapePageTransform(S),!b)continue e;w=b.clone().invert().applyToPoints(u);const D=e.getShapeGeometry(S);t:for(let M=0;M<4;M++)if(f=w[M],x=w[(M+1)%4],D.hitTestLineSegment(f,x,0)){this.handleHit(S,a,C,c,u);break t}}}e.getInstanceState().isCoarsePointer;const y=e.getInstanceState().brush;(!y||!g.equals(y))&&e.updateInstanceState({brush:{...g.toJson()}});const P=e.getSelectedShapeIds();(P.length!==c.size||P.some(T=>!c.has(T)))&&e.setSelectedShapes(Array.from(c),{squashing:!0})}handleHit(e,n,s,i,a){if(e.parentId===s){i.add(e.id);return}const l=this.editor.getOutermostSelectableShape(e),d=this.editor.getShapeMask(l.id);d&&!lr(d,a)&&!Ht(n,d)||i.add(l.id)}}h(va,"id","brushing");function Qs(t,o=!1){const e=t.getZoomLevel(),{inputs:{currentPagePoint:n}}=t;return t.getShapeAtPoint(n,{hitInside:!1,hitLabels:o,margin:Qe/e,renderingOnly:!0})??t.getSelectedShapeAtPoint(n)}function ka(t,o,e){if(!o)throw Error("Needs to translate a cropped shape!");const{crop:n}=o.props;if(!n)return;const s=t.inputs.shiftKey?Math.abs(e.x)<Math.abs(e.y)?"x":"y":null;s==="x"?e.x=0:s==="y"&&(e.y=0),e.rot(-o.rotation);const i=1/(n.bottomRight.x-n.topLeft.x)*o.props.w,a=1/(n.bottomRight.y-n.topLeft.y)*o.props.h,l=n.bottomRight.y-n.topLeft.y,d=n.bottomRight.x-n.topLeft.x,c=We(n);return c.topLeft.x=Math.min(1-d,Math.max(0,c.topLeft.x-e.x/i)),c.topLeft.y=Math.min(1-l,Math.max(0,c.topLeft.y-e.y/a)),c.bottomRight.x=c.topLeft.x+d,c.bottomRight.y=c.topLeft.y+l,{id:o.id,type:o.type,props:{crop:c}}}var rs;let Pu=(rs=class extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))});h(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)});h(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});h(this,"onPointerDown",e=>{var n;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const s=Qs(this.editor);if(s&&!this.editor.isShapeOfType(s,"group")){this.onPointerDown({...e,shape:s,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(n=this.editor.getShapeUtil(e.shape))!=null&&n.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});h(this,"onDoubleClick",e=>{var a;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const s=this.editor.getShape(n);if(!s)return;const i=this.editor.getShapeUtil(s);i&&e.target==="selection"&&((a=i.onDoubleClickEdge)==null||a.call(i,s))});h(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});h(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});h(this,"onKeyUp",e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}});h(this,"cleanupCroppingState",()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:n}}}=this,s=n.has("ShiftLeft"),i=new m(0,0);if(n.has("ArrowLeft")&&(i.x+=1),n.has("ArrowRight")&&(i.x-=1),n.has("ArrowUp")&&(i.y+=1),n.has("ArrowDown")&&(i.y-=1),i.equals(new m(0,0)))return;s&&i.mul(10);const a=this.editor.getShape(this.editor.getCroppingShapeId());if(!a)return;const l=ka(this.editor,a,i);l&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([l]))}},h(rs,"id","idle"),rs);class Pa extends N{constructor(){super(...arguments);h(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});h(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)});h(this,"onPointerUp",e=>{this.editor.setCurrentTool("select.crop.idle",e)})}}h(Pa,"id","pointing_crop");class Ca extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"markId","translating crop");h(this,"snapshot",{});h(this,"onEnter",e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});h(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});h(this,"onPointerMove",()=>{this.updateShapes()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onKeyDown",e=>{switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}});h(this,"onKeyUp",e=>{switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:n,currentPagePoint:s}=this.editor.inputs,i=s.clone().sub(n),a=ka(this.editor,e,i);a&&this.editor.updateShapes([a],{squashing:!0})}}h(Ca,"id","translating_crop");class eo extends N{}h(eo,"id","crop"),h(eo,"initial","idle"),h(eo,"children",()=>[Pu,Ca,Pa]);const Pe=8,Ut={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class ja extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e,this.updateCursor()});h(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startResizing()});h(this,"onLongPress",()=>{this.startResizing()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const e=this.editor.getSelectedShapes(),n=Ut[this.info.handle];this.editor.updateInstanceState({cursor:{type:n,rotation:e.length===1?this.editor.getSelectionRotation():0}})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}h(ja,"id","pointing_resize_handle");class Ia extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"markId","");h(this,"snapshot",{});h(this,"onEnter",e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});h(this,"onPointerMove",()=>{this.updateShapes()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const n=Ut[this.info.handle];this.editor.updateInstanceState({cursor:{type:n,rotation:this.editor.getSelectionRotation()}})}updateShapes(){const{shape:e,cursorHandleOffset:n}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;const i=e.props,a=this.editor.inputs.currentPagePoint.clone().sub(n),l=this.editor.inputs.originPagePoint.clone().sub(n),d=a.clone().sub(l).rot(-e.rotation),c=i.crop??this.getDefaultCrop(),p=We(c),g=new m(e.x,e.y),u=new m(0,0),f=1/(c.bottomRight.x-c.topLeft.x)*i.w,x=1/(c.bottomRight.y-c.topLeft.y)*i.h;let S=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(x<Pe)break;S=!0,p.topLeft.y=p.topLeft.y+d.y/x,x*(p.bottomRight.y-p.topLeft.y)<Pe?(p.topLeft.y=p.bottomRight.y-Pe/x,u.y=(p.topLeft.y-c.topLeft.y)*x):p.topLeft.y<=0?(p.topLeft.y=0,u.y=(p.topLeft.y-c.topLeft.y)*x):u.y=d.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(x<Pe)break;S=!0,p.bottomRight.y=Math.min(1,p.bottomRight.y+d.y/x),x*(p.bottomRight.y-p.topLeft.y)<Pe&&(p.bottomRight.y=p.topLeft.y+Pe/x);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<Pe)break;S=!0,p.topLeft.x=p.topLeft.x+d.x/f,f*(p.bottomRight.x-p.topLeft.x)<Pe?(p.topLeft.x=p.bottomRight.x-Pe/f,u.x=(p.topLeft.x-c.topLeft.x)*f):p.topLeft.x<=0?(p.topLeft.x=0,u.x=(p.topLeft.x-c.topLeft.x)*f):u.x=d.x;break}case"right":case"top_right":case"bottom_right":{if(f<Pe)break;S=!0,p.bottomRight.x=Math.min(1,p.bottomRight.x+d.x/f),f*(p.bottomRight.x-p.topLeft.x)<Pe&&(p.bottomRight.x=p.topLeft.x+Pe/f);break}}if(!S)return;g.add(u.rot(e.rotation));const v={id:e.id,type:e.type,x:g.x,y:g.y,props:{crop:p,w:(p.bottomRight.x-p.topLeft.x)*f,h:(p.bottomRight.y-p.topLeft.y)*x}};this.editor.updateShapes([v],{squashing:!0}),this.updateCursor()}complete(){this.updateShapes(),J(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,s=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),a=m.RotWith(i.getHandlePoint(this.info.handle),i.point,e),l=m.Sub(n,a);return{shape:s,cursorHandleOffset:l}}}h(Ia,"id","cropping");class Ta extends N{constructor(){super(...arguments);h(this,"shapeId","");h(this,"initialHandle",{});h(this,"initialAdjacentHandle",null);h(this,"initialPagePoint",{});h(this,"markId","");h(this,"initialPageTransform");h(this,"initialPageRotation");h(this,"info",{});h(this,"isPrecise",!1);h(this,"isPreciseId",null);h(this,"pointingId",null);h(this,"onEnter",e=>{const{shape:n,isCreating:s,handle:i}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=n.id,this.markId=s?`creating:${n.id}`:"dragging handle",s||this.editor.mark(this.markId),this.initialHandle=We(i),this.editor.isShapeOfType(n,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...n,props:{points:{...n.props.points,[i.index]:{id:i.index,index:i.index,x:i.x,y:i.y}}}});const c=this.editor.getShapeHandles(n).find(p=>p.index===i.index);this.initialHandle=We(c)}this.initialPageTransform=this.editor.getShapePageTransform(n),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:s?"cross":"grabbing",rotation:0}},{ephemeral:!0});const a=this.editor.getShapeHandles(n).sort(xo),l=a.findIndex(d=>d.id===e.handle.id);this.initialAdjacentHandle=null;for(let d=l+1;d<a.length;d++){const c=a[d];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==e.handle.id){this.initialAdjacentHandle=c;break}}if(!this.initialAdjacentHandle)for(let d=a.length-1;d>=0;d--){const c=a[d];if(c.type==="vertex"&&c.id!=="middle"&&c.id!==e.handle.id){this.initialAdjacentHandle=c;break}}if(this.editor.isShapeOfType(n,"arrow")){const d=n.props[e.handle.id];this.isPrecise=!1,(d==null?void 0:d.type)==="binding"?(this.editor.setHintingShapes([d.boundShapeId]),this.isPrecise=d.isPrecise,this.isPrecise?this.isPreciseId=d.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)});h(this,"exactTimeout",-1);h(this,"onPointerMove",()=>{this.update()});h(this,"onKeyDown",()=>{this.update()});h(this,"onKeyUp",()=>{this.update()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.update(),this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),J(this.editor,[this.shapeId]);const{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var T;const{editor:e,shapeId:n,initialPagePoint:s}=this,{initialHandle:i,initialPageRotation:a,initialAdjacentHandle:l}=this,d=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:p,inputs:{currentPagePoint:g,shiftKey:u,ctrlKey:f,altKey:x,pointerVelocity:S}}=e,v=this.info.shape,b=e.getShape(n);if(!b)return;const w=e.getShapeUtil(b);let E=g.clone().sub(s).rot(-a).add(i);if(u&&l&&i.id!=="middle"){const _=m.Angle(l,E),M=ao(_,24)-_;E=m.RotWith(E,l,M)}e.snaps.clearIndicators();let C={...i,x:E.x,y:E.y};if(i.canSnap&&(c?!f:f)){if(!e.getShapePageTransform(b.id))throw Error("Expected a page transform");const D=p.handles.snapHandle({currentShapeId:n,handle:C});D&&(D.nudge.rot(-e.getShapeParentTransform(b).rotation()),E.add(D.nudge),C={...i,x:E.x,y:E.y})}const y=(T=w.onHandleDrag)==null?void 0:T.call(w,b,{handle:C,isPrecise:this.isPrecise||x,initial:v}),P={...b,...y};if(i.canBind){const _=P.props[i.id];(_==null?void 0:_.type)==="binding"?d[0]!==_.boundShapeId&&(e.setHintingShapes([_.boundShapeId]),this.pointingId=_.boundShapeId,this.isPrecise=S.len()<.5||x,this.isPreciseId=this.isPrecise?_.boundShapeId:null,this.resetExactTimeout()):d.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}y&&e.updateShapes([P],{squashing:!0})}}h(Ta,"id","dragging_handle");function Ea(t){return t.isLabel?[t]:t instanceof ut?t.children.filter(o=>o.isLabel):[]}class Ma extends N{constructor(){super(...arguments);h(this,"hitShapeForPointerUp",null);h(this,"onEnter",()=>{const e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,Dt(this.editor),this.editor.select(e)});h(this,"onExit",()=>{var i;const{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null);const n=this.editor.getShape(e),s=this.editor.getShapeUtil(n);(i=s.onEditEnd)==null||i.call(s,n)});h(this,"onPointerMove",e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{Dt(this.editor);return}}});h(this,"onPointerDown",e=>{switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{const n=Qs(this.editor,!0);if(n){this.onPointerDown({...e,shape:n,target:"shape"});return}break}case"shape":{const{shape:n}=e,s=this.editor.getEditingShape();if(!s)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(n).getGeometry(n),a=Ea(i),l=a.length===1?a[0]:void 0,d=this.editor.isShapeOfType(s,"text")&&s.props.text.trim()==="";if(l&&!d){const c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint);if(l.bounds.containsPoint(c,0)&&l.hitTestPoint(c)){if(n.id===s.id)return;this.hitShapeForPointerUp=n,this.editor.mark("editing on pointer up"),this.editor.select(n.id);return}}else{if(n.id===s.id)this.editor.isShapeOfType(n,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)});h(this,"onPointerUp",e=>{const n=this.hitShapeForPointerUp;if(!n)return;this.hitShapeForPointerUp=null;const s=this.editor.getShapeUtil(n);if(this.editor.getInstanceState().isReadonly&&!s.canEditInReadOnly(n)){this.parent.transition("pointing_shape",e);return}this.editor.select(n.id),this.editor.setEditingShape(n.id),Dt(this.editor)});h(this,"onComplete",e=>{this.parent.transition("idle",e)});h(this,"onCancel",e=>{this.parent.transition("idle",e)})}}h(Ma,"id","editing_shape");function Gi(t){const o=t.getOnlySelectedShape();return!!(o&&!t.isShapeOrAncestorLocked(o)&&t.getShapeUtil(o).canCrop(o))}function go(t){const o=t.getSelectedShapeIds(),{shiftKey:e,altKey:n,currentPagePoint:s}=t.inputs,i=t.getShapeAtPoint(s,{hitInside:!1,margin:Qe/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:a=>!a.isLocked});if(i){const a=t.getOutermostSelectableShape(i);if(e&&!n)t.cancelDoubleClick(),o.includes(a.id)?(t.mark("deselecting shape"),t.deselect(a)):(t.mark("shift selecting shape"),t.setSelectedShapes([...o,a.id]));else{let l;a===i||a.id===t.getFocusedGroupId()||o.includes(a.id)?l=i:l=a,l&&!o.includes(l.id)&&(t.mark("selecting shape"),t.select(l.id))}}else{if(e)return;{o.length>0&&(t.mark("selecting none"),t.selectNone());const a=t.getFocusedGroupId();if(xr(a)){const l=t.getShape(a);t.isPointInShape(l,s,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const Cu=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var as;let ju=(as=class extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),Dt(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});h(this,"onPointerMove",()=>{Dt(this.editor)});h(this,"onPointerDown",e=>{if(this.editor.getIsMenuOpen())return;const n=e.ctrlKey&&Gi(this.editor);if(e.ctrlKey&&!n){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const s=Qs(this.editor);if(s&&!s.isLocked){this.onPointerDown({...e,shape:s,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),a=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((i.length>1||a&&!this.editor.getShapeUtil(a).hideSelectionBoundsBg(a))&&Ki(this.editor,l)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:s}=e;if(this.isOverArrowLabelTest(s)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(s)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":{n?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{n?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const s=this.editor.getHoveredShape();if(s&&!this.editor.getSelectedShapeIds().includes(s.id)&&!s.isLocked){this.onPointerDown({...e,shape:s,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}});h(this,"onDoubleClick",e=>{var n,s,i,a;if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const l=this.editor.getHoveredShape(),d=l&&!this.editor.isShapeOfType(l,"group")?l:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:Qe/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(d){if(this.editor.isShapeOfType(d,"group")){go(this.editor);return}else{const p=this.editor.getShape(d.parentId);if(p&&this.editor.isShapeOfType(p,"group")&&!(c&&p.id===c)){go(this.editor);return}}this.onDoubleClick({...e,shape:d,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const l=this.editor.getOnlySelectedShape();if(l){const d=this.editor.getShapeUtil(l);if(!this.canInteractWithShapeInReadOnly(l))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(n=d.onDoubleClickEdge)==null?void 0:n.call(d,l);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]),J(this.editor,[l.id]);return}}if(d.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(l)&&this.startEditingShape(l,e,!0)}break}case"shape":{const{shape:l}=e,d=this.editor.getShapeUtil(l);if(l.type!=="video"&&l.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(d.onDoubleClick){const c=(s=d.onDoubleClick)==null?void 0:s.call(d,l);if(c){this.editor.updateShapes([c]);return}else if(d.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.editor.mark("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(l)?this.startEditingShape(l,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:l,handle:d}=e,c=this.editor.getShapeUtil(l),p=(a=c.onDoubleClickHandle)==null?void 0:a.call(c,l,d);p?this.editor.updateShapes([p]):this.shouldStartEditingShape(l)&&this.startEditingShape(l,e,!0)}}});h(this,"onRightClick",e=>{switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),s=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:Qe/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(s){this.onRightClick({...e,shape:s,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),a=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((i.length>1||a&&!this.editor.getShapeUtil(a).hideSelectionBoundsBg(a))&&Ki(this.editor,l)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:n}=this.editor.getCurrentPageState(),{shape:s}=e,i=this.editor.getOutermostSelectableShape(s,a=>!n.includes(a.id));n.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});h(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});h(this,"onKeyDown",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(ht.editOnType.get()&&!Cu.includes(e.key)&&!e.altKey&&!e.ctrlKey){const n=this.editor.getOnlySelectedShape();if(n&&this.editor.isShapeOfType(n,"note")&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}}});h(this,"onKeyRepeat",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});h(this,"onKeyUp",e=>{switch(e.code){case"Enter":{const n=this.editor.getSelectedShapes();if(n.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(n.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const s=this.editor.getOnlySelectedShape();if(s&&this.shouldStartEditingShape(s)){this.startEditingShape(s,{...e,target:"shape",shape:s},!0);return}Gi(this.editor)&&this.parent.transition("crop",e);break}}});h(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,n,s){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),po(this.editor,e,s),this.parent.transition("editing_shape",n))}isOverArrowLabelTest(e){if(!e)return!1;const n=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const s=this.editor.getShapeGeometry(e).children[1];if(s&&Ht(n,s.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const n=ne(),{x:s,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:s,y:i,props:{text:"",autoSize:!0}}]);const a=this.editor.getShape(n);if(!a)return;const l=this.editor.getShapeUtil(a);this.editor.getInstanceState().isReadonly&&!l.canEditInReadOnly(a)||(this.editor.setEditingShape(n),this.editor.select(n),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:n}}}=this,s=n.has("ShiftLeft"),i=new m(0,0);if(n.has("ArrowLeft")&&(i.x-=1),n.has("ArrowRight")&&(i.x+=1),n.has("ArrowUp")&&(i.y-=1),n.has("ArrowDown")&&(i.y+=1),i.equals(new m(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:a}=this.editor.getDocumentSettings(),l=this.editor.getInstanceState().isGridMode?s?a*Eu:a:s?Iu:Tu,d=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(d,i.mul(l)),J(this.editor,d)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},h(as,"id","idle"),as);const Iu=10,Tu=1,Eu=5;function Ki(t,o){const e=t.getSelectionRotatedPageBounds();if(!e)return!1;const n=t.getSelectionRotation();return n?Ht(o,e.corners.map(s=>m.RotWith(s,e.point,n))):e.containsPoint(o)}class _a extends N{constructor(){super(...arguments);h(this,"shapeId","");h(this,"markId","");h(this,"wasAlreadySelected",!1);h(this,"didDrag",!1);h(this,"info",{});h(this,"onEnter",e=>{const{shape:n}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=n.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===n.id,this.updateCursor();const i=this.editor.getShapeGeometry(n).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${n.id}`);const{currentPagePoint:a}=this.editor.inputs,l=this.editor.getPointInShapeSpace(n,a);this._labelDragOffset=m.Sub(i.center,l),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});h(this,"_labelDragOffset",new m(0,0));h(this,"onPointerMove",()=>{const{isDragging:e}=this.editor.inputs;if(!e)return;const n=this.editor.getShape(this.shapeId);if(!n)return;const s=this.editor.getArrowInfo(n),i=this.editor.getShapeGeometry(n),a=i.children[0],l=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),d=a.nearestPoint(m.Add(l,this._labelDragOffset));let c;if(s.isStraight){const p=m.Dist(s.start.point,s.end.point);c=1-m.Dist(s.end.point,d)/p}else{const{_center:p,measure:g,angleEnd:u,angleStart:f}=i.children[0];c=jc(g,f,u,p.angle(d))}isNaN(c)&&(c=.5),this.didDrag=!0,this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:c}},{squashing:!0})});h(this,"onPointerUp",()=>{const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}h(_a,"id","pointing_arrow_label");class Aa extends N{constructor(){super(...arguments);h(this,"onEnter",()=>{const{inputs:e}=this.editor;e.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});h(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)});h(this,"onPointerUp",()=>{go(this.editor),this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}h(Aa,"id","pointing_canvas");class $a extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const n=this.editor.getSelectedShapes()[0];if(!n)return;const s=Ut[this.info.handle];this.editor.updateInstanceState({cursor:{type:s,rotation:this.editor.getSelectionRotation()}}),this.editor.setCroppingShape(n.id)});h(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});h(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startCropping()});h(this,"onLongPress",()=>{this.startCropping()});h(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}h($a,"id","pointing_crop_handle");class Da extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e;const{shape:n}=e;if(this.editor.isShapeOfType(n,"arrow")){const s=n.props[e.handle.id];(s==null?void 0:s.type)==="binding"&&this.editor.setHintingShapes([s.boundShapeId])}this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});h(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});h(this,"onPointerUp",()=>{const{shape:e,handle:n}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:s}=this,i=Vi(s,e,n,!1);if(i){po(s,i,!0);return}}this.parent.transition("idle",this.info)});h(this,"onPointerMove",()=>{const{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()});h(this,"onLongPress",()=>{this.startDraggingHandle()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}startDraggingHandle(){const{editor:e}=this;if(e.getInstanceState().isReadonly)return;const{shape:n,handle:s}=this.info;if(e.isShapeOfType(n,"note")){const i=Vi(e,n,s,!0);if(i){const a=e.getPointInParentSpace(i,e.inputs.originPagePoint).sub(m.Rot(Ks,i.rotation));e.updateShape({...i,x:a.x,y:a.y}),e.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{po(e,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}h(Da,"id","pointing_handle");function Vi(t,o,e,n){const s=t.getShapePageTransform(o.id),i=s.point(),a=s.rotation(),d=Gr(i,a,o.props.growY,0)[e.index];if(d)return Vr(t,o,d,a,n)}class La extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});h(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startRotating()});h(this,"onLongPress",()=>{this.startRotating()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.updateInstanceState({cursor:{type:Ut[this.info.handle],rotation:this.editor.getSelectionRotation()}})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}h(La,"id","pointing_rotate_handle");class za extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e});h(this,"onPointerUp",e=>{go(this.editor),this.parent.transition("idle",e)});h(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startTranslating(e)});h(this,"onLongPress",e=>{this.startTranslating(e)});h(this,"onDoubleClick",e=>{var i,a;const n=this.editor.getHoveredShape(),s=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(s){this.parent.transition("idle"),(a=(i=this.parent).onDoubleClick)==null||a.call(i,{...e,target:"shape",shape:this.editor.getShape(s)});return}});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}cancel(){this.parent.transition("idle")}}h(za,"id","pointing_selection");class Oa extends N{constructor(){super(...arguments);h(this,"hitShape",{});h(this,"hitShapeForPointerUp",{});h(this,"isDoubleClick",!1);h(this,"didSelectOnEnter",!1);h(this,"onEnter",e=>{const n=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:a,shiftKey:l,altKey:d}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;const c=this.editor.getOutermostSelectableShape(e.shape),p=this.editor.findShapeAncestor(c,g=>n.includes(g.id));if(this.editor.getShapeUtil(e.shape).onClick||c.id===i||n.includes(c.id)||p||n.length>1&&(s!=null&&s.containsPoint(a))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,l&&!d?(this.editor.cancelDoubleClick(),n.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...n,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});h(this,"onPointerUp",e=>{var p;const n=this.editor.getSelectedShapeIds(),s=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:a,shiftKey:l}}=this.editor,d=this.editor.getShapeAtPoint(a,{margin:Qe/i,hitInside:!0,renderingOnly:!0})??this.hitShape,c=d?this.editor.getOutermostSelectableShape(d):this.hitShapeForPointerUp;if(c){const g=this.editor.getShapeUtil(c);if(g.onClick){const u=(p=g.onClick)==null?void 0:p.call(g,c);if(u){this.editor.mark("shape on click"),this.editor.updateShapes([u]),this.parent.transition("idle",e);return}}if(c.id===s){n.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const g=this.editor.getOutermostSelectableShape(d,u=>!n.includes(u.id));if(n.includes(g.id))if(l)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(n.includes(c.id)){if(n.length===1){const u=this.editor.getShapeUtil(c).getGeometry(c),f=Ea(u),x=f.length===1?f[0]:void 0;if(x){const S=this.editor.getPointInShapeSpace(c,a);if(x.bounds.containsPoint(S,0)&&x.hitTestPoint(S)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const v=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!v.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:c.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(l){const u=this.editor.getShapeAncestors(g);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!u.find(x=>x.id===f)),g.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([g.id])}this.parent.transition("idle",e)});h(this,"onDoubleClick",()=>{this.isDoubleClick=!0});h(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.startTranslating(e)});h(this,"onLongPress",e=>{this.startTranslating(e)});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.cancel()});h(this,"onInterrupt",()=>{this.cancel()})}startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.getContainer().focus(),this.parent.transition("translating",e))}cancel(){this.parent.transition("idle")}}h(Oa,"id","pointing_shape");class Fa extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"markId","");h(this,"didHoldCommand",!1);h(this,"creationCursorOffset",{x:0,y:0});h(this,"snapshot",{});h(this,"onEnter",e=>{const{isCreating:n=!1,creationCursorOffset:s={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=s,this.snapshot=this._createSnapshot(),n?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});h(this,"onTick",()=>{Ns(this.editor)});h(this,"onPointerMove",()=>{this.updateShapes()});h(this,"onKeyDown",()=>{this.updateShapes()});h(this,"onKeyUp",()=>{this.updateShapes()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clearIndicators()});h(this,"_createSnapshot",()=>{const e=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,i=this.editor.getSelectionRotatedPageBounds(),a=m.RotWith(i.getHandlePoint(this.info.handle),i.point,n),l=m.Sub(s,a),d=new Map,c=[];e.forEach(g=>{const u=this.editor.getShape(g);if(u){if(u.type==="frame"&&c.push({id:g,children:je(this.editor.getSortedChildIdsForParent(u).map(f=>this.editor.getShape(f)))}),d.set(u.id,this._createShapeSnapshot(u)),this.editor.isShapeOfType(u,"frame")&&e.length===1)return;this.editor.visitDescendants(u.id,f=>{const x=this.editor.getShape(f);if(x&&(d.set(x.id,this._createShapeSnapshot(x)),this.editor.isShapeOfType(x,"frame")))return!1})}});const p=![...d.values()].some(g=>!Ic(g.pageRotation,n)||g.isAspectRatioLocked);return{shapeSnapshots:d,selectionBounds:i,cursorHandleOffset:l,selectionRotation:n,selectedShapeIds:e,canShapesDeform:p,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});h(this,"_createShapeSnapshot",e=>{const n=this.editor.getShapePageTransform(e),s=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:n,pageRotation:Oe.Decompose(n).rotation,isAspectRatioLocked:s.isAspectRatioLocked(e)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var e,n;if(J(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(n=(e=this.info).onCreate)==null||n.call(e,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:s})=>{var l;const i=this.editor.getShapeUtil(s),a=(l=i.onResizeStart)==null?void 0:l.call(i,s);a&&n.push(a)}),n.length>0&&this.editor.updateShapes(n)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:s})=>{var d;const i=this.editor.getShape(s.id),a=this.editor.getShapeUtil(s),l=(d=a.onResizeEnd)==null?void 0:d.call(a,s,i);l&&n.push(l)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{altKey:e,shiftKey:n}=this.editor.inputs,{frames:s,shapeSnapshots:i,selectionBounds:a,cursorHandleOffset:l,selectedShapeIds:d,selectionRotation:c,canShapesDeform:p}=this.snapshot,g=n||!p,{ctrlKey:u}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(l).sub(this.creationCursorOffset),x=this.editor.inputs.originPagePoint.clone().sub(l);if(this.editor.getInstanceState().isGridMode&&!u){const{gridSize:_}=this.editor.getDocumentSettings();f.snapToGrid(_)}const S=this.info.handle,v=Yi(S,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!u:u)&&c%ee===0){const{nudge:_}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:m.Sub(f,x),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Yi(S,c),isAspectRatioLocked:g,isResizingFromCenter:e});f.add(_)}const w=m.RotWith(e?a.center:a.getHandlePoint(v),a.point,c),E=m.Sub(f,w).rot(-c),C=m.Sub(x,w).rot(-c),y=m.DivV(E,C);Number.isFinite(y.x)||(y.x=1),Number.isFinite(y.y)||(y.y=1);const P=S==="top"||S==="bottom",T=S==="left"||S==="right";g?T?y.y=Math.abs(y.x):P?y.x=Math.abs(y.y):Math.abs(y.x)>Math.abs(y.y)?y.y=Math.abs(y.x)*(y.y<0?-1:1):y.x=Math.abs(y.y)*(y.x<0?-1:1):(P&&(y.x=1),T&&(y.y=1)),this.info.isCreating||this.updateCursor({dragHandle:S,isFlippedX:y.x<0,isFlippedY:y.y<0,rotation:c});for(const _ of i.keys()){const D=i.get(_);this.editor.resizeShape(_,y,{initialShape:D.shape,initialBounds:D.bounds,initialPageTransform:D.pageTransform,dragHandle:S,mode:d.length===1&&_===d[0]?"resize_bounds":"scale_shape",scaleOrigin:w,scaleAxisRotation:c})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:_,children:D}of s){if(!D.length)continue;const M=i.get(_).shape,$=this.editor.getShape(_);if(!(M&&$))continue;const z=$.x-M.x,O=$.y-M.y,W=new m(z,O).rot(-M.rotation);if(W.x!==0||W.y!==0)for(const R of D)this.editor.updateShape({id:R.id,type:R.type,x:R.x-W.x,y:R.y-W.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:_}of s)if(_.length)for(const D of _)this.editor.updateShape({id:D.id,type:D.type,x:D.x,y:D.y})}}updateCursor({dragHandle:e,isFlippedX:n,isFlippedY:s,rotation:i}){const a={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{a.type="nwse-resize",n!==s&&(a.type="nesw-resize");break}case"top_right":case"bottom_left":{a.type="nesw-resize",n!==s&&(a.type="nwse-resize");break}}a.rotation=i,this.editor.setCursor(a)}}h(Fa,"id","resizing");const No=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Yi(t,o){o=o%zt;const e=Math.round(o/(ce/4)),n=No.indexOf(t);return No[(n+e)%No.length]}const Zi=Math.PI/180;class Ra extends N{constructor(){super(...arguments);h(this,"snapshot",{});h(this,"info",{});h(this,"markId","");h(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const n=Tc({editor:this.editor});if(!n)return this.parent.transition("idle",this.info);this.snapshot=n;const s=this._getRotationFromPointerPosition({snapToNearestDegree:!1});$o({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:Ut[this.info.handle],rotation:s+this.snapshot.initialSelectionRotation}})});h(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});h(this,"onPointerMove",()=>{this.update()});h(this,"onKeyDown",()=>{this.update()});h(this,"onKeyUp",()=>{this.update()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"update",()=>{const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});$o({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:Ut[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})});h(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});h(this,"complete",()=>{$o({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),J(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}_getRotationFromPointerPosition({snapToNearestDegree:e}){const n=this.editor.getSelectionRotation(),s=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:i,currentPagePoint:a}}=this.editor,{initialCursorAngle:l,initialSelectionRotation:d}=this.snapshot;if(!s)return d;const p=s.center.clone().rotWith(s.point,n).angle(a)-l;let g=d+p;if(i)g=ao(g,24);else if(e&&(g=Math.round(g/Zi)*Zi,this.editor.getInstanceState().isCoarsePointer)){const u=ao(g,4),f=Ec(g,u);Math.abs(f)<Mc(5)&&(g=u)}return g-d}}h(Ra,"id","rotating");class Na extends N{constructor(){super(...arguments);h(this,"hits",new Set);h(this,"size",0);h(this,"scribbleId","id");h(this,"initialSelectedShapeIds",new Set);h(this,"newlySelectedShapeIds",new Set);h(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})});h(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});h(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});h(this,"onPointerUp",()=>{this.complete()});h(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});h(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});h(this,"onCancel",()=>{this.cancel()});h(this,"onComplete",()=>{this.complete()});h(this,"pushPointToScribble",()=>{const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)})}updateScribbleSelection(e){const{editor:n}=this,s=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:i,originPagePoint:a,previousPagePoint:l,currentPagePoint:d}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:p}=this;e&&this.pushPointToScribble();const g=s;let u,f,x,S;const v=0;for(let E=0,C=g.length;E<C;E++){if(u=g[E],n.isShapeOfType(u,"group")||c.has(u.id)||n.isShapeOrAncestorLocked(u)||(f=n.getShapeGeometry(u),n.isShapeOfType(u,"frame")&&f.bounds.containsPoint(n.getPointInShapeSpace(u,a))))continue;const y=n.getShapePageTransform(u);if(!f||!y)continue;const P=y.clone().invert();x=P.applyToPoint(l),S=P.applyToPoint(d);const{bounds:T}=f;if(!(T.minX-v>Math.max(x.x,S.x)||T.minY-v>Math.max(x.y,S.y)||T.maxX+v<Math.min(x.x,S.x)||T.maxY+v<Math.min(x.y,S.y))&&f.hitTestLineSegment(x,S,v)){const _=this.editor.getOutermostSelectableShape(u),D=this.editor.getShapeMask(_.id);if(D&&hr(l,d,D)!==null&&!Ht(d,D))continue;c.add(_.id)}}const b=n.getSelectedShapeIds(),w=new Set(i?[...c,...p]:[...c]);(b.length!==w.size||b.some(E=>!w.has(E)))&&this.editor.setSelectedShapes(Array.from(w),{squashing:!0})}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}h(Na,"id","scribble_brushing");const Mu=20,_u=100;class Au{constructor(o){h(this,"prevDroppingShapeId",null);h(this,"droppingNodeTimer",null);h(this,"first",!0);h(this,"dispose",()=>{this.clear()});this.editor=o,o.disposables.add(this.dispose)}updateDroppingNode(o,e){var n;this.first&&(this.editor.setHintingShapes(o.map(s=>this.editor.findShapeAncestor(s,i=>i.type!=="group")).filter(s=>s)),this.prevDroppingShapeId=((n=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,o))==null?void 0:n.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(o,Mu,e):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(o,_u,e))}setDragTimer(o,e,n){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,o,n)}),this.droppingNodeTimer=null},e)}handleDrag(o,e,n){var d,c,p,g,u;e=je(e.map(f=>this.editor.getShape(f.id)));const s=((d=this.editor.getDroppingOverShape(o,e))==null?void 0:d.id)??null;if(s===this.prevDroppingShapeId){this.hintParents(e);return}const{prevDroppingShapeId:i}=this,a=i&&this.editor.getShape(i),l=s&&this.editor.getShape(s);a&&((p=(c=this.editor.getShapeUtil(a)).onDragShapesOut)==null||p.call(c,a,e)),l&&((u=(g=this.editor.getShapeUtil(l)).onDragShapesOver)==null||u.call(g,l,e)),this.hintParents(e),n==null||n(),this.prevDroppingShapeId=s}hintParents(o){const e=new Map;for(const s of o){const i=this.editor.findShapeAncestor(s,a=>a.type!=="group");i&&(e.has(i.id)||e.set(i.id,[]),e.get(i.id).push(s.id))}const n=[];for(const[s,i]of e){const a=this.editor.getShape(s);a&&Ur(this.editor,a).length<i.length&&n.push(a.id)}this.editor.setHintingShapes(n)}dropShapes(o){var n,s;const{prevDroppingShapeId:e}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,o),e){const i=this.editor.getShape(e);if(!i)return;(s=(n=this.editor.getShapeUtil(i)).onDropShapesOver)==null||s.call(n,i,o)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class Ba extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"selectionSnapshot",{});h(this,"snapshot",{});h(this,"markId","");h(this,"isCloning",!1);h(this,"isCreating",!1);h(this,"onCreate",()=>{});h(this,"dragAndDropManager",new Au(this.editor));h(this,"onEnter",e=>{const{isCreating:n=!1,onCreate:s=()=>{}}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.onCreate=s,n?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=qi(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()});h(this,"onTick",()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),Ns(this.editor)});h(this,"onPointerMove",()=>{this.updateShapes()});h(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});h(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onComplete",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()});h(this,"updateParentTransforms",()=>{const{editor:e,snapshot:{shapeSnapshots:n}}=this;n.forEach(s=>{const i=e.getShape(s.shape.id);if(!i)return null;const a=_c(i.parentId)?null:Oe.Inverse(e.getShapePageTransform(i.parentId));s.parentTransform=a})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=qi(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),J(this.editor,this.snapshot.movingShapes.map(n=>n.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(s=>{var l;const i=this.editor.getShapeUtil(s),a=(l=i.onTranslateStart)==null?void 0:l.call(i,s);a&&n.push(a)}),n.length>0&&this.editor.updateShapes(n),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const s=m.Average(e.map(a=>this.editor.getShapePageTransform(a.id).point())),i=m.Sub(s,this.selectionSnapshot.averagePagePoint);m.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(a=>a.id),offset:{x:i.x,y:i.y}}})}const n=[];e.forEach(s=>{var d;const i=this.editor.getShape(s.id),a=this.editor.getShapeUtil(s),l=(d=a.onTranslateEnd)==null?void 0:d.call(a,s,i);l&&n.push(l)}),n.length>0&&this.editor.updateShapes(n)}handleChange(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(s=>{var d;const i=this.editor.getShape(s.id),a=this.editor.getShapeUtil(s),l=(d=a.onTranslate)==null?void 0:d.call(a,s,i);l&&n.push(l)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),$u({editor:this.editor,snapshot:e}),this.handleChange()}}h(Ba,"id","translating");function qi(t){var g;const o=[],e=[],n=t.getSelectedShapeIds(),s=je(n.map(u=>{const f=t.getShape(u);if(!f)return null;o.push(f);const x=t.getShapePageTransform(u),S=x.point(),v=x.rotation();e.push(S);const b=bo.isId(f.parentId)?null:Oe.Inverse(t.getShapePageTransform(f.parentId));return{shape:f,pagePoint:S,pageRotation:v,parentTransform:b}})),i=t.getOnlySelectedShape();let a=[];if(i)a=t.snaps.shapeBounds.getSnapPoints(i.id);else{const u=t.getSelectionPageBounds();u&&(a=u.cornersAndCenter.map((f,x)=>({id:"selection:"+x,x:f.x,y:f.y})))}let l,d;const{originPagePoint:c}=t.inputs,p=s.filter(u=>t.isShapeOfType(u.shape,"note")&&t.isPointInShape(u.shape,c));if(p.length!==0)if(p.length===1)d=p[0];else{const u=t.getCurrentPageShapesSorted();d=(g=p.map(f=>({snapshot:f,index:u.findIndex(x=>x.id===f.shape.id)})).sort((f,x)=>x.index-f.index)[0])==null?void 0:g.snapshot}return d&&(l=Kr(t,d.pageRotation,d.shape.props.growY??0)),{averagePagePoint:m.Average(e),movingShapes:o,shapeSnapshots:s,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:a,noteAdjacentPositions:l,noteSnapshot:d}}function $u({editor:t,snapshot:o}){const{inputs:e}=t,{noteSnapshot:n,noteAdjacentPositions:s,initialPageBounds:i,initialSnapPoints:a,shapeSnapshots:l,averagePagePoint:d}=o,c=t.getInstanceState().isGridMode,p=t.getDocumentSettings().gridSize,g=m.Sub(e.currentPagePoint,e.originPagePoint),u=t.inputs.shiftKey?Math.abs(g.x)<Math.abs(g.y)?"x":"y":null;if(u==="x"?g.x=0:u==="y"&&(g.y=0),t.snaps.clearIndicators(),(t.user.getIsSnapMode()?!e.ctrlKey:e.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:v}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:g,initialSelectionPageBounds:i,lockedAxis:u,initialSelectionSnapPoints:a});g.add(v)}else if(n&&s){let v=Wr/t.getZoomLevel(),b=new m(0,0);const w=m.Add(m.Add(n.pagePoint,g),new m(K/2,K/2).rot(n.pageRotation));for(const E of s){const C=m.Sub(w,E),y=C.len();y<v&&(v=y,b=C)}g.sub(b)}const x=m.Add(d,g);c&&!e.ctrlKey&&x.snapToGrid(p);const S=m.Sub(x,d);t.updateShapes(je(l.map(({shape:v,pagePoint:b,parentTransform:w})=>{const E=m.Add(b,S),C=w?Oe.applyToPoint(w,E):E;return{id:v.id,type:v.type,x:C.x,y:C.y}})),{squashing:!0})}class to extends N{constructor(){super(...arguments);h(this,"reactor");h(this,"cleanUpDuplicateProps",()=>{const e=this.editor.getSelectedShapeIds(),n=this.editor.getInstanceState();if(!n.duplicateProps)return;const s=new Set(n.duplicateProps.shapeIds);e.length===s.size&&e.every(i=>s.has(i))||this.editor.updateInstanceState({duplicateProps:null})});h(this,"onEnter",()=>{this.reactor=Sr("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})});h(this,"onExit",()=>{var e;(e=this.reactor)==null||e.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}h(to,"id","select"),h(to,"initial","idle"),h(to,"children",()=>[eo,Ia,ju,Aa,Oa,Ba,va,Na,$a,za,ja,Ma,Fa,Ra,La,_a,Da,Ta]);class Ua extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e});h(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}h(Ua,"id","idle");class Ha extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e});h(this,"onPointerUp",()=>{this.complete()});h(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});h(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}h(Ha,"id","pointing");class Wa extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"zoomBrush",new Z);h(this,"onEnter",e=>{this.info=e,this.update()});h(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});h(this,"onPointerMove",()=>{this.update()});h(this,"onPointerUp",()=>{this.complete()});h(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:e,currentPagePoint:n}}=this.editor;this.zoomBrush.setTo(Z.FromPoints([e,n])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,n=8/this.editor.getZoomLevel();if(e.width<n&&e.height<n){const s=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(s,{duration:220}):this.editor.zoomIn(s,{duration:220})}else{const s=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:s,duration:220})}this.parent.transition("idle",this.info)}}h(Wa,"id","zoom_brushing");class no extends N{constructor(){super(...arguments);h(this,"info",{});h(this,"onEnter",e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()});h(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});h(this,"onKeyDown",()=>{this.updateCursor()});h(this,"onKeyUp",e=>{this.updateCursor(),e.code==="KeyZ"&&this.complete()});h(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}h(no,"id","zoom"),h(no,"initial","idle"),h(no,"children",()=>[Ua,Wa,Ha]);const Du=[Xn,Jn,Qn,no,to],Ga=()=>{},Ka=k.createContext({});function Lu({onEvent:t,children:o}){return r.jsx(Ka.Provider,{value:t??Ga,children:o})}function Ne(){return k.useContext(Ka)??Ga}const Va=k.createContext({});function zu({children:t}){const o=A(),e=Ne(),[n,s]=k.useState([]),i=k.useCallback(c=>{const p=c.id??Ae();return s(g=>[...g.filter(u=>u.id!==c.id),{...c,id:p}]),e("open-menu",{source:"dialog",id:p}),o.addOpenMenu(p),p},[o,e]),a=k.useCallback((c,p)=>(s(g=>g.map(u=>u.id===c?{...u,...p}:u)),e("open-menu",{source:"dialog",id:c}),o.addOpenMenu(c),c),[o,e]),l=k.useCallback(c=>(s(p=>p.filter(g=>{var u;return g.id===c?((u=g.onClose)==null||u.call(g),!1):!0})),e("close-menu",{source:"dialog",id:c}),o.deleteOpenMenu(c),c),[o,e]),d=k.useCallback(()=>{s(c=>(c.forEach(p=>{var g;(g=p.onClose)==null||g.call(p),e("close-menu",{source:"dialog",id:p.id}),o.deleteOpenMenu(p.id)}),[]))},[o,e]);return r.jsx(Va.Provider,{value:{dialogs:n,addDialog:i,removeDialog:l,clearDialogs:d,updateDialog:a},children:t})}function bt(){const t=k.useContext(Va);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const Ou=({id:t,component:o,onClose:e})=>{const{removeDialog:n}=bt(),s=ot(),i=k.useCallback(a=>{if(!a){if(e)try{e()}catch(l){console.warn(l)}n(t)}},[t,e,n]);return r.jsx(td,{onOpenChange:i,defaultOpen:!0,children:r.jsx(nd,{container:s,children:r.jsx(od,{dir:"ltr",className:"tlui-dialog__overlay",onClick:a=>{a.target===a.currentTarget&&i(!1)},children:r.jsx(sd,{dir:"ltr",className:"tlui-dialog__content",children:r.jsx(o,{onClose:()=>i(!1)})})})})})};function Fu(){const{dialogs:t}=bt();return r.jsx(r.Fragment,{children:t.map(o=>r.jsx(Ou,{...o},o.id))})}const Ru=fe.memo(Fu);function Nu(){const t=A(),o=L("follow",()=>t.getInstanceState().followingUserId,[t]);return o?r.jsx(Bu,{userId:o}):null}function Bu({userId:t}){const o=Ac(t);return o?r.jsx("div",{className:"tlui-following-indicator",style:{borderColor:o.color}}):null}const Ya=k.createContext({});function Uu({children:t}){const[o,e]=k.useState([]),n=k.useCallback(a=>{const l=a.id??Ae();return e(d=>[...d.filter(c=>c.id!==a.id),{...a,id:l}]),l},[]),s=k.useCallback(a=>(e(l=>l.filter(d=>d.id!==a)),a),[]),i=k.useCallback(()=>{e(()=>[])},[]);return r.jsx(Ya.Provider,{value:{toasts:o,addToast:n,removeToast:s,clearToasts:i},children:t})}function De(){const t=k.useContext(Ya);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}const B=k.forwardRef(function({children:o,disabled:e,type:n,...s},i){const a=A(),l=i==null?void 0:i.current;return e&&l===document.activeElement&&a.getContainer().focus(),r.jsx("button",{ref:i,type:"button",draggable:!1,disabled:e,...s,className:H("tlui-button",`tlui-button__${n}`,s.className),children:o})});function se({children:t}){return r.jsx("span",{className:"tlui-button__label",children:t})}const et=k.memo(function({small:o,invertIcon:e,icon:n,color:s,className:i,...a}){const l=Js(),d=l.icons[n]??l.icons["question-mark-circle"],c=k.useRef(null);return k.useLayoutEffect(()=>{d||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),c!=null&&c.current&&(c.current.style.webkitMask=`url(${d}) center 100% / 100% no-repeat`)},[c,d,n]),r.jsx("div",{...a,ref:c,className:H("tlui-icon",{"tlui-icon__small":o},i),style:{color:s,mask:`url(${d}) center 100% / 100% no-repeat`,transform:e?"scale(-1, 1)":void 0}})}),Hu={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function Wu({toast:t}){const{removeToast:o}=De(),e=V(),n=a=>{a||o(t.id)},s=t.actions&&t.actions.length>0,i=t.icon||t.severity&&Hu[t.severity];return r.jsxs(id,{onOpenChange:n,className:"tlui-toast__container",duration:t.keepOpen?1/0:5e3,"data-severity":t.severity,children:[i&&r.jsx("div",{className:"tlui-toast__icon",children:r.jsx(et,{icon:i})}),r.jsxs("div",{className:"tlui-toast__main",children:[r.jsxs("div",{className:"tlui-toast__content",children:[t.title&&r.jsx(rd,{className:"tlui-toast__title",children:t.title}),t.description&&r.jsx(ad,{className:"tlui-toast__description",children:t.description})]}),t.actions&&r.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((a,l)=>r.jsx(ld,{altText:a.label,asChild:!0,onClick:a.onClick,children:r.jsx(B,{type:a.type,children:r.jsx(se,{children:a.label})})},l)),r.jsx(mi,{asChild:!0,children:r.jsx(B,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:r.jsx(se,{children:t.closeLabel??e("toast.close")})})})]})]}),!s&&r.jsx(mi,{asChild:!0,children:r.jsx(B,{type:"normal",className:"tlui-toast__close",children:r.jsx(se,{children:t.closeLabel??e("toast.close")})})})]})}function Gu(){const{toasts:t}=De();return r.jsx(r.Fragment,{children:t.map(o=>r.jsx(Wu,{toast:o},o.id))})}const Ku=k.memo(Gu);function Vu(){const{toasts:t}=De(),[o,e]=k.useState(!1);return k.useEffect(()=>{let n=!1;return t.length?e(!0):setTimeout(()=>{n||e(!1)},1e3),()=>{n=!0}},[t.length,e]),o?r.jsx(cd,{className:"tlui-toast__viewport"}):null}function G({icon:t,small:o,invertIcon:e}){return r.jsx(et,{className:"tlui-button__icon",icon:t,small:o,invertIcon:e})}const Bo=[0,390,428,468,580,640,840,1023];var oe=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(oe||{});const dt="2.1.4";let Is={fonts:{draw:`https://unpkg.com/@tldraw/assets@${dt}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${dt}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${dt}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${dt}/fonts/IBMPlexMono-Medium.woff2`}};function Za(t){return k.useMemo(()=>t?{fonts:{...Is.fonts,...t==null?void 0:t.fonts}}:Is,[t])}const Yu=["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check-circle","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross-circle","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","error","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"];let Zt={...Is,icons:Object.fromEntries(Yu.map(t=>[t,`https://unpkg.com/@tldraw/assets@${dt}/icons/icon/${t}.svg`])),translations:Object.fromEntries(Rs.map(t=>[t.locale,`https://unpkg.com/@tldraw/assets@${dt}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(mo.map(t=>[t.type,`https://unpkg.com/@tldraw/assets@${dt}/embed-icons/${t.type}.png`]))};function Zu(t){return t?{fonts:Object.assign({...Zt.fonts},{...t==null?void 0:t.fonts}),icons:Object.assign({...Zt.icons},{...t==null?void 0:t.icons}),embedIcons:Object.assign({...Zt.embedIcons},{...t==null?void 0:t.embedIcons}),translations:Object.assign({...Zt.translations},{...t==null?void 0:t.translations})}:Zt}function jo({className:t,children:o}){return r.jsx("div",{className:H("tlui-dialog__header",t),children:o})}function Io({className:t,children:o}){return r.jsx(dd,{dir:"ltr",className:H("tlui-dialog__header__title",t),children:o})}function To(){return r.jsx("div",{className:"tlui-dialog__header__close",children:r.jsx(hd,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:r.jsx(B,{type:"icon","aria-label":"Close",onTouchEnd:t=>t.target.click(),children:r.jsx(G,{small:!0,icon:"cross-2"})})})})}function hn({className:t,children:o,style:e}){return r.jsx("div",{className:H("tlui-dialog__body",t),style:e,children:o})}function ei({className:t,children:o}){return r.jsx("div",{className:H("tlui-dialog__footer",t),children:o})}const ti=k.forwardRef(function({className:o,label:e,icon:n,iconLeft:s,autoselect:i=!1,autofocus:a=!1,defaultValue:l,placeholder:d,onComplete:c,onValueChange:p,onCancel:g,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:f=!1,children:x,value:S},v){const b=A(),w=k.useRef(null);k.useImperativeHandle(v,()=>w.current);const E=V(),C=k.useRef(l??""),y=k.useRef(l??""),[P,T]=k.useState(!1),_=k.useCallback(z=>{T(!0);const O=z.currentTarget;y.current=O.value,requestAnimationFrame(()=>{i&&O.select()})},[i]),D=k.useCallback(z=>{const O=z.currentTarget.value;y.current=O,p==null||p(O)},[p]),M=k.useCallback(z=>{switch(z.key){case"Enter":{z.currentTarget.blur(),be(z),c==null||c(z.currentTarget.value);break}case"Escape":{z.currentTarget.value=C.current,z.currentTarget.blur(),be(z),g==null||g(z.currentTarget.value);break}}},[c,g]),$=k.useCallback(z=>{T(!1);const O=z.currentTarget.value;u==null||u(O)},[u]);return k.useEffect(()=>{if(!b.environment.isIos)return;const z=window.visualViewport;if(P&&f&&z){const O=()=>{var W;(W=w.current)==null||W.scrollIntoView({block:"center"})};return z.addEventListener("resize",O),z.addEventListener("scroll",O),requestAnimationFrame(()=>{var W;(W=w.current)==null||W.scrollIntoView({block:"center"})}),()=>{z.removeEventListener("resize",O),z.removeEventListener("scroll",O)}}},[b,P,f]),r.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[x,e&&r.jsx("label",{children:E(e)}),s&&r.jsx(et,{icon:s,className:"tlui-icon-left",small:!0}),r.jsx("input",{ref:w,className:H("tlui-input",o),type:"text",defaultValue:l,onKeyUp:M,onChange:D,onFocus:_,onBlur:$,autoFocus:a,placeholder:d,value:S}),n&&r.jsx(et,{icon:n,small:!!e})]})}),qa=Ke(function({onClose:o}){const e=A(),n=V(),s=Js(),[i,a]=k.useState(null),[l,d]=k.useState(""),[c,p]=k.useState(null),[g,u]=k.useState(!1),f=k.useRef(-1);return r.jsxs(r.Fragment,{children:[r.jsxs(jo,{children:[r.jsx(Io,{children:i?`${n("embed-dialog.title")} — ${i.title}`:n("embed-dialog.title")}),r.jsx(To,{})]}),i?r.jsxs(r.Fragment,{children:[r.jsxs(hn,{className:"tlui-embed-dialog__enter",children:[r.jsx(ti,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:x=>{d(x);const S=Je(x);p(S&&S.definition.type===i.type?S:null),u(!1),clearTimeout(f.current),f.current=setTimeout(()=>u(!S),320)}}),l===""?r.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[r.jsx("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&r.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",r.jsx(et,{icon:"external-link",small:!0})]})]}):r.jsx("div",{className:"tlui-embed-dialog__warning",children:g?n("embed-dialog.invalid-url"):" "})]}),r.jsxs(ei,{className:"tlui-dialog__footer__actions",children:[r.jsx(B,{type:"normal",onClick:()=>{a(null),p(null),d("")},children:r.jsx(se,{children:n("embed-dialog.back")})}),r.jsx("div",{className:"tlui-embed__spacer"}),r.jsx(B,{type:"normal",onClick:o,children:r.jsx(se,{children:n("embed-dialog.cancel")})}),r.jsx(B,{type:"primary",disabled:!c,onClick:()=>{c&&(e.putExternalContent({type:"embed",url:l,point:e.getViewportPageCenter(),embed:c.definition}),o())},children:r.jsx(se,{children:n("embed-dialog.create")})})]})]}):r.jsx(r.Fragment,{children:r.jsx(hn,{className:"tlui-embed-dialog__list",children:mo.map(x=>r.jsxs(B,{type:"menu",onClick:()=>a(x),children:[r.jsx(se,{children:x.title}),r.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${s.embedIcons[x.type]})`}})]},x.type))})})]})});function Xa(){const t=A(),o=k.useRef();return k.useEffect(()=>{const e=window.document.createElement("input");e.type="file",e.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",e.multiple=!0,o.current=e;async function n(s){const i=s.target.files;!i||i.length===0||(await t.putExternalContent({type:"files",files:Array.from(i),point:t.getViewportPageBounds().center,ignoreParent:!1}),e.value="")}return e.addEventListener("change",n),()=>{o.current=void 0,e.removeEventListener("change",n)}},[t]),k.useCallback(()=>{var e;(e=o.current)==null||e.click()},[o])}const Ja=k.createContext({});function qu({overrides:t,children:o}){const e=A(),n=Ne(),{addDialog:s}=bt(),i=Xa(),a=k.useMemo(()=>{const l=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){e.setCurrentTool("select"),n("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){e.setCurrentTool("hand"),n("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(c){e.setCurrentTool("eraser"),n("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(c){e.setCurrentTool("draw"),n("select-tool",{source:c,id:"draw"})}},...[...Ue.values].map(c=>({id:c,label:`tool.${c}`,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(p){e.batch(()=>{e.updateInstanceState({stylesForNextShape:{...e.getInstanceState().stylesForNextShape,[Ue.id]:c}},{ephemeral:!0}),e.setCurrentTool("geo"),n("select-tool",{source:p,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(c){e.setCurrentTool("arrow"),n("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(c){e.setCurrentTool("line"),n("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(c){e.setCurrentTool("frame"),n("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(c){e.setCurrentTool("text"),n("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(c){i(),n("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(c){e.setCurrentTool("note"),n("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){e.setCurrentTool("laser"),n("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"tool-embed",onSelect(c){s({component:qa}),n("select-tool",{source:c,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(c){e.setCurrentTool("highlight"),n("select-tool",{source:c,id:"highlight"})}}];l.push();const d=Object.fromEntries(l.map(c=>[c.id,c]));return t?t(e,d,{insertMedia:i}):d},[t,e,n,i,s]);return r.jsx(Ja.Provider,{value:a,children:o})}function Y(){const t=k.useContext(Ja);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}const Qa=fe.createContext(0);function Xu({forceMobile:t=!1,children:o}){const e=A(),n=L("breakpoint",()=>{const{width:s}=e.getViewportScreenBounds(),i=t?oe.MOBILE_SM:Bo.length-1;for(let a=0;a<i;a++)if(s>Bo[a]&&s<=Bo[a+1])return a;return i},[e]);return r.jsx(Qa.Provider,{value:n,children:o})}function xe(){return k.useContext(Qa)}function Ju(){const{addToast:t,removeToast:o,clearToasts:e}=De(),{addDialog:n,clearDialogs:s,removeDialog:i,updateDialog:a}=bt(),d=xe()<oe.TABLET_SM,c=V();return k.useMemo(()=>({addToast:t,removeToast:o,clearToasts:e,addDialog:n,clearDialogs:s,removeDialog:i,updateDialog:a,msg:c,isMobile:d}),[n,t,s,e,c,i,o,a,d])}function Qu(t,o){const e={};for(const n of t)if(n.translations)for(const[s,i]of Os(n.translations)){let a=e[s];a||(a=e[s]={}),Object.assign(a,i)}return{actions:(n,s)=>{for(const i of t)i.actions&&(s=i.actions(n,s,o));return s},tools:(n,s,i)=>{for(const a of t)a.tools&&(s=a.tools(n,s,{...o,...i}));return s},translations:e}}function el(t){return k.useMemo(()=>t,t)}function eg(t){const o=el(t==null?[]:Array.isArray(t)?t:[t]);return k.useMemo(()=>{const e={};for(const n of o)if(n.translations)for(const[s,i]of Os(n.translations)){let a=e[s];a||(a=e[s]={}),Object.assign(a,i)}return e},[o])}function tg(t){const o=Ju(),e=el(t==null?[]:Array.isArray(t)?t:[t]);return k.useMemo(()=>Qu(e,o),[e,o])}function ng(t,o){const e=je(o.map(s=>t.getShape(s)).filter(s=>s&&t.isShapeOfType(s,"frame")));if(!e.length)return;const n=[];t.batch(()=>{e.map(s=>{const i=t.getSortedChildIdsForParent(s.id);i.length&&(t.reparentShapes(i,s.parentId,s.index),n.push(...i))}),t.setSelectedShapes(n),t.deleteShapes(o)})}const og=50;function sg(t,o,e={}){const n=t.getShape(o);if(!n)return;const s=t.getSortedChildIdsForParent(n.id),i=je(s.map(f=>t.getShape(f)));if(!i.length)return;const a=Z.FromPoints(i.flatMap(f=>{const x=t.getShapeGeometry(f.id);return t.getShapeLocalTransform(f).applyToPoints(x.vertices)})),{padding:l=og}=e,d=a.w+2*l,c=a.h+2*l,p=l-a.minX,g=l-a.minY;if(p===0&&g===0&&n.props.w===d&&n.props.h===c)return;const u=new m(p,g).rot(n.rotation);t.batch(()=>{const f=s.map(x=>{const S=t.getShape(x);return{id:S.id,type:S.type,x:S.x+p,y:S.y+g}});f.push({id:n.id,type:n.type,x:n.x-u.x,y:n.y-u.y,props:{w:d,h:c}}),t.updateShapes(f)})}function Xi(t){return cs.isValid(t)?{isValid:!0,hasProtocol:!0}:cs.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const ig=Ke(function({onClose:o}){const n=A().getOnlySelectedShape();return n&&"url"in n.props&&typeof n.props.url=="string"?r.jsx(rg,{onClose:o,selectedShape:n}):null}),rg=Ke(function({onClose:o,selectedShape:e}){const n=A(),s=V(),i=k.useRef(null);k.useEffect(()=>{requestAnimationFrame(()=>{var x;return(x=i.current)==null?void 0:x.focus()})},[]);const a=k.useRef(e.props.url),[l,d]=k.useState(()=>{const x=Xi(e.props.url),S=x.isValid===!0?x.hasProtocol?e.props.url:"https://"+e.props.url:"https://";return{actual:S,safe:S,valid:!0}}),c=k.useCallback(x=>{const S=x.replace(/https?:\/\/(https?:\/\/)/,(w,E)=>E),v=Xi(S),b=v.isValid===!0?v.hasProtocol?S:"https://"+S:"https://";d({actual:S,safe:b,valid:v.isValid})},[]),p=k.useCallback(()=>{const x=n.getOnlySelectedShape();x&&(n.updateShapes([{id:x.id,type:x.type,props:{url:""}}]),o())},[n,o]),g=k.useCallback(()=>{const x=n.getOnlySelectedShape();x&&(x&&"url"in x.props&&x.props.url!==l.safe&&n.updateShapes([{id:x.id,type:x.type,props:{url:l.safe}}]),o())},[n,o,l]),u=k.useCallback(()=>{o()},[o]);if(!e)return o(),null;const f=a.current&&!l.valid;return r.jsxs(r.Fragment,{children:[r.jsxs(jo,{children:[r.jsx(Io,{children:s("edit-link-dialog.title")}),r.jsx(To,{})]}),r.jsx(hn,{children:r.jsxs("div",{className:"tlui-edit-link-dialog",children:[r.jsx(ti,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:l.actual,onValueChange:c,onComplete:g,onCancel:u}),r.jsx("div",{children:l.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),r.jsxs(ei,{className:"tlui-dialog__footer__actions",children:[r.jsx(B,{type:"normal",onClick:u,onTouchEnd:u,children:r.jsx(se,{children:s("edit-link-dialog.cancel")})}),f?r.jsx(B,{type:"danger",onTouchEnd:p,onClick:p,children:r.jsx(se,{children:s("edit-link-dialog.clear")})}):r.jsx(B,{type:"primary",disabled:!l.valid,onTouchEnd:g,onClick:g,children:r.jsx(se,{children:s("edit-link-dialog.save")})})]})]})});async function ag(t,o,e){var b,w,E;const{elements:n,files:s}=o,i={shapes:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},a=new Map,l=new Map,d=t.getCurrentPageId(),c=new Map,p=[],g=new Set;n.forEach(C=>{if(c.set(C.id,ne()),C.boundElements!==null)for(const y of C.boundElements)y.type==="text"&&g.add(y.id)});let u=$c;for(const C of n){if(g.has(C.id))continue;const y=c.get(C.id),P={id:y,typeName:"shape",parentId:d,index:u,x:C.x,y:C.y,rotation:0,isLocked:C.locked,opacity:lg(C.opacity),meta:{}};switch(C.angle!==0&&l.set(y,C.angle),C.groupIds&&C.groupIds.length>0?a.has(C.groupIds[0])?(b=a.get(C.groupIds[0]))==null||b.push(y):a.set(C.groupIds[0],[y]):p.push(y),C.type){case"rectangle":case"ellipse":case"diamond":{let T="",_="middle";if(C.boundElements!==null){for(const M of C.boundElements)if(M.type==="text"){const $=n.find(z=>z.id===M.id);$&&(T=$.text,_=Ji[$.textAlign])}}const D=C.backgroundColor==="transparent"?C.strokeColor:C.backgroundColor;i.shapes.push({...P,type:"geo",props:{geo:C.type,url:C.link??"",w:C.width,h:C.height,size:jn[C.strokeWidth]??"draw",color:qt[D]??"black",text:T,align:_,dash:In(C),fill:fg(C)}});break}case"freedraw":{i.shapes.push({...P,type:"draw",props:{dash:In(C),size:jn[C.strokeWidth],color:qt[C.strokeColor]??"black",segments:[{type:"free",points:C.points.map(([T,_,D=.5])=>({x:T,y:_,z:D}))}]}});break}case"line":{const T=C.points[0],_=C.points[C.points.length-1],D=fr(C.points.length);i.shapes.push({...P,type:"line",props:{dash:In(C),size:jn[C.strokeWidth],color:qt[C.strokeColor]??"black",spline:C.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:D[0],x:T[0],y:T[1]},end:{id:"end",type:"vertex",index:D[D.length-1],x:_[0],y:_[1]},...Object.fromEntries(C.points.slice(1,-1).map(([M,$],z)=>{const O=Ae();return[O,{id:O,type:"vertex",index:D[z+1],x:M,y:$}]}))}}});break}case"arrow":{let T="";if(C.boundElements!==null){for(const z of C.boundElements)if(z.type==="text"){const O=n.find(W=>W.id===z.id);O&&(T=O.text)}}const _=C.points[0],D=C.points[C.points.length-1],M=c.get((w=C.startBinding)==null?void 0:w.elementId),$=c.get((E=C.endBinding)==null?void 0:E.elementId);i.shapes.push({...P,type:"arrow",props:{text:T,bend:gg(C,_,D),dash:In(C),size:jn[C.strokeWidth]??"m",color:qt[C.strokeColor]??"black",start:M?{type:"binding",boundShapeId:M,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:_[0],y:_[1]},end:$?{type:"binding",boundShapeId:$,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:D[0],y:D[1]},arrowheadEnd:Qi[C.endArrowhead]??"none",arrowheadStart:Qi[C.startArrowhead]??"none"}});break}case"text":{const{size:T,scale:_}=dg(C.fontSize);i.shapes.push({...P,type:"text",props:{size:T,scale:_,font:hg[C.fontFamily]??"draw",color:qt[C.strokeColor]??"black",text:C.text,align:Ji[C.textAlign]}});break}case"image":{const T=s[C.fileId];if(!T)break;const _=It.createId();i.assets.push({id:_,typeName:"asset",type:"image",props:{w:C.width,h:C.height,name:C.id??"Untitled",isAnimated:!1,mimeType:T.mimeType,src:T.dataURL},meta:{}}),i.shapes.push({...P,type:"image",props:{w:C.width,h:C.height,assetId:_}})}}u=$s(u)}const f=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.mark("paste"),t.putContentOntoCurrentPage(i,{point:f,select:!1,preserveIds:!0});for(const C of a.values())if(C.length>1){t.groupShapes(C);const y=t.getShape(C[0]);y!=null&&y.parentId&&xr(y.parentId)&&p.push(y.parentId)}for(const[C,y]of l)t.select(C),t.rotateShapesBy([C],y);const x=je(p.map(C=>t.getShape(C))),S=Z.Common(x.map(C=>t.getShapePageBounds(C))),v=t.getViewportPageBounds().center;t.updateShapes(x.map(C=>{const y={x:(C.x??0)-(S.x+S.w/2),y:(C.y??0)-(S.y+S.h/2)};return{id:C.id,type:C.type,x:v.x+y.x,y:v.y+y.y}})),t.setSelectedShapes(p)}const lg=t=>{const o=t/100;return o<.2?.1:o<.4?.25:o<.6?.5:o<.8?.75:1},jn={1:"s",2:"m",3:"l",4:"xl"},cg={16:"s",20:"m",28:"l",36:"xl"};function dg(t){const o=cg[t];return o?{size:o,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const hg={1:"draw",2:"sans",3:"mono"},qt={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},pg={solid:"draw",dashed:"dashed",dotted:"dotted"},ug={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Ji={left:"start",center:"middle",right:"end"},Qi={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function gg(t,o,e){let n=0;if(t.points.length>2){const s=new m(o[0],o[1]),i=new m(e[0],e[1]),a=new m(t.points[1][0],t.points[1][1]),l=m.Sub(i,s),d=m.Per(l),c=m.Med(i,s),p=m.Sub(c,d),g=m.Add(c,d),u=m.NearestPointOnLineSegment(p,g,a,!1);n=m.Dist(u,c),m.Clockwise(u,i,c)&&(n*=-1)}return n}const In=t=>{let o=pg[t.strokeStyle]??"draw";return o==="draw"&&t.roughness===0&&(o="solid"),o},fg=t=>t.backgroundColor==="transparent"?"none":ug[t.fillStyle]??"solid";async function tl(t,o,e,n){const i=(await Promise.all(o.map(async a=>await(await fetch(a)).blob()))).map(a=>new File([a],"tldrawFile",{type:a.type}));t.mark("paste"),await t.putExternalContent({type:"files",files:i,point:e,ignoreParent:!1,sources:n}),o.forEach(a=>URL.revokeObjectURL(a))}function mg(t,o,e){const n=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0),s=t.getSelectionPageBounds();t.mark("paste"),t.putContentOntoCurrentPage(o,{point:n,select:!0});const i=t.getSelectionPageBounds();s&&i&&(s!=null&&s.collides(i))&&(t.updateInstanceState({isChangingStyle:!0},{ephemeral:!0}),setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},150))}async function Ts(t,o,e,n){var s;try{if(new URL(o).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&(s=(await fetch(o,{method:"HEAD"})).headers.get("content-type"))!=null&&s.match(/^image\//)){t.mark("paste"),tl(t,[o]);return}}catch(i){i.message!=="Failed to fetch"&&console.error(i)}return t.mark("paste"),await t.putExternalContent({type:"url",point:e,url:o,sources:n})}function xg(t){const o=document.implementation.createHTMLDocument("");return o.documentElement.innerHTML=t.trim(),o.body.textContent||o.body.innerText||""}const Sg=t=>{try{const o=new URL(t);return o.protocol==="http:"||o.protocol==="https:"}catch{return!1}},yg=t=>{const o=t.split(/[\n\s]/);for(const e of o)try{const n=new URL(e);if(!(n.protocol==="http:"||n.protocol==="https:"))return}catch{return}return Lc(o)},bg=t=>/^<svg/.test(t),wg=["input","select","textarea"];function oo(t){const{activeElement:o}=document;return t.getIsMenuOpen()||o&&(o.getAttribute("contenteditable")||wg.indexOf(o.tagName.toLowerCase())>-1)}const vg=t=>t.types.find(o=>o.match(/^image\//)),Uo=(t,o,e,n)=>{const s=yg(o);if(s)for(const i of s)Ts(t,i,e);else Sg(o)?Ts(t,o,e):bg(o)?(t.mark("paste"),t.putExternalContent({type:"svg-text",text:o,point:e,sources:n})):(t.mark("paste"),t.putExternalContent({type:"text",text:o,point:e,sources:n}))},kg=async(t,o,e)=>{if(t.getEditingShapeId()!==null)return;if(!o)throw Error("No clipboard data");const n=[];for(const s of Object.values(o.items))switch(s.kind){case"file":{n.push({type:"file",source:new Promise(i=>i(s.getAsFile()))});break}case"string":{s.type==="text/html"?n.push({type:"html",source:new Promise(i=>s.getAsString(i))}):s.type==="text/plain"?n.push({type:"text",source:new Promise(i=>s.getAsString(i))}):n.push({type:s.type,source:new Promise(i=>s.getAsString(i))});break}}ol(t,n,e)},nl=async(t,o,e)=>{const n=[];for(const s of o){if(vg(s))for(const i of s.types)i.match(/^image\//)&&n.push({type:"blob",source:s.getType(i)});s.types.includes("text/html")&&n.push({type:"html",source:(async()=>{const i=await s.getType("text/html");return await _t.blobToText(i)})()}),s.types.includes("text/uri-list")&&n.push({type:"url",source:(async()=>{const i=await s.getType("text/uri-list");return await _t.blobToText(i)})()}),s.types.includes("text/plain")&&n.push({type:"text",source:(async()=>{const i=await s.getType("text/plain");return await _t.blobToText(i)})()})}return await ol(t,n,e)};async function ol(t,o,e){const n=o.filter(i=>(i.type==="file"||i.type==="blob")&&i.source!==null);if(n.length){const a=(await Promise.all(n.map(l=>l.source))).filter(Boolean).map(l=>URL.createObjectURL(l));return await tl(t,a,e)}const s=await Promise.all(o.filter(i=>i.type!=="file").map(i=>new Promise(a=>{const l=i;if(l.type==="file"){a({type:"error",data:null,reason:"unexpected file"});return}l.source.then(d=>{var p;const c=(p=d.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:p[1];if(c)try{const g=Tr.decompressFromBase64(c);if(g===null){a({type:"error",data:g,reason:"found tldraw data comment but could not parse base64"});return}else{const u=JSON.parse(g);if(u.type!=="application/tldraw"&&a({type:"error",data:u,reason:`found tldraw data comment but JSON was of a different type: ${u.type}`}),typeof u.data=="string"){a({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}a({type:"tldraw",data:u.data});return}}catch{a({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(l.type==="html"){a({type:"text",data:d,subtype:"html"});return}if(l.type==="url"){a({type:"text",data:d,subtype:"url"});return}try{const g=JSON.parse(d);if(g.type==="excalidraw/clipboard"){a({type:"excalidraw",data:g});return}else{a({type:"text",data:d,subtype:"json"});return}}catch{a({type:"text",data:d,subtype:"text"});return}}a({type:"error",data:d,reason:"unhandled case"})})})));for(const i of s)if(i.type==="tldraw"){mg(t,i.data,e);return}for(const i of s)if(i.type==="excalidraw"){ag(t,i.data,e);return}for(const i of s)if(i.type==="text"&&i.subtype==="html"){const l=new DOMParser().parseFromString(i.data,"text/html").querySelector("body");if(l&&Array.from(l.children).filter(c=>c.nodeType===1).length===1&&l.firstElementChild&&l.firstElementChild.tagName==="A"&&l.firstElementChild.hasAttribute("href")&&l.firstElementChild.getAttribute("href")!==""){const c=l.firstElementChild.getAttribute("href");Uo(t,c,e,s);return}if(!s.some(c=>c.type==="text"&&c.subtype!=="html")&&i.data.trim()){Uo(t,xg(i.data),e,s);return}}for(const i of s)if(i.type==="text"&&i.subtype==="url"){Ts(t,i.data,e,s);return}for(const i of s)if(i.type==="text"&&i.subtype==="text"&&i.data.trim()){Uo(t,i.data,e,s);return}}const fo=t=>{var n;const o=t.getContentFromCurrentPage(t.getSelectedShapeIds());if(!o){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const e=Tr.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:o}));if(!(typeof navigator>"u")){const s=o.shapes.map(i=>t.isShapeOfType(i,"text")||t.isShapeOfType(i,"geo")||t.isShapeOfType(i,"arrow")?i.props.text:t.isShapeOfType(i,"bookmark")||t.isShapeOfType(i,"embed")?i.props.url:null).filter(Dc);if((n=navigator.clipboard)!=null&&n.write){const i=new Blob([`<tldraw>${e}</tldraw>`],{type:"text/html"});let a=s.join(" ");a===""&&(a=" "),navigator.clipboard.write([new ClipboardItem({"text/html":i,"text/plain":new Blob([a],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${e}</tldraw>`)}};function Pg(){const t=A(),o=Ne(),e=k.useCallback(function(a){t.getSelectedShapeIds().length!==0&&(fo(t),o("copy",{source:a}))},[t,o]),n=k.useCallback(function(a){t.getSelectedShapeIds().length!==0&&(fo(t),t.deleteShapes(t.getSelectedShapeIds()),o("cut",{source:a}))},[t,o]),s=k.useCallback(async function(a,l,d){t.getEditingShapeId()!==null||oo(t)||(Array.isArray(a)&&a[0]instanceof ClipboardItem?(nl(t,a,d),o("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{s(c,l,d)}))},[t,o]);return{copy:e,cut:n,paste:s}}function Cg(){const t=A(),o=Ne(),e=L("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);k.useEffect(()=>{if(!e)return;const n=d=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||oo(t)||(de(d),fo(t),o("copy",{source:"kbd"}))};function s(d){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||oo(t)||(de(d),fo(t),t.deleteShapes(t.getSelectedShapeIds()),o("cut",{source:"kbd"}))}let i=!1;const a=d=>{d.button===1&&(i=!0,requestAnimationFrame(()=>{i=!1}))},l=d=>{if(i){be(d);return}t.getEditingShapeId()!==null||oo(t)||(d.clipboardData&&!t.inputs.shiftKey?kg(t,d.clipboardData):navigator.clipboard.read().then(c=>{Array.isArray(c)&&c[0]instanceof ClipboardItem&&nl(t,c,t.inputs.currentPagePoint)}),de(d),o("paste",{source:"kbd"}))};return document.addEventListener("copy",n),document.addEventListener("cut",s),document.addEventListener("paste",l),document.addEventListener("pointerup",a),()=>{document.removeEventListener("copy",n),document.removeEventListener("cut",s),document.removeEventListener("paste",l),document.removeEventListener("pointerup",a)}},[t,o,e])}async function sl(t,o,e){const{type:n,quality:s,scale:i,width:a,height:l}=e;let[d,c]=await zr(a*i,l*i);d=Math.floor(d),c=Math.floor(c);const p=d/a,g=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),u=await new Promise(x=>{const S=new Image;S.crossOrigin="anonymous",S.onload=async()=>{o&&await new Promise(w=>setTimeout(w,250));const v=document.createElement("canvas"),b=v.getContext("2d");v.width=d,v.height=c,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(S,0,0,d,c),URL.revokeObjectURL(g),x(v)},S.onerror=()=>{x(null)},S.src=g});if(!u)return null;const f=await new Promise(x=>u.toBlob(S=>{(!S||ht.throwToBlob.get())&&x(null),x(S)},"image/"+n,s));if(!f)return null;if(n==="png"){const x=new DataView(await f.arrayBuffer());return zc.setPhysChunk(x,p,{type:"image/"+n})}else return f}async function il(t,o,e){const n=await t.getSvgString(o!=null&&o.length?o:[...t.getCurrentPageShapeIds()],{scale:1,background:t.getInstanceState().exportBackground,...e});if(!n)throw new Error("Could not construct SVG.");return n}async function Es(t,o,e,n={}){var s;switch(e){case"svg":return(s=await il(t,o,n))==null?void 0:s.svg;case"json":{const i=t.getContentFromCurrentPage(o);return JSON.stringify(i)}default:gn(e)}}async function rl({editor:t,ids:o,format:e,opts:n={}}){switch(e){case"svg":return new Blob([await Es(t,o,"svg",n)],{type:"text/plain"});case"json":return new Blob([await Es(t,o,"json",n)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await il(t,o,n);if(!s)throw new Error("Could not construct image.");const i=await sl(s.svg,t.environment.isSafari,{type:e,quality:1,scale:2,width:s.width,height:s.height});if(!i)throw new Error("Could not construct image.");return i}default:gn(e)}}const jg={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Ig(t,o,e,n={}){return{blobPromise:rl({editor:t,ids:o,format:e,opts:n}),mimeType:jg[e]}}function Tg(t,o,e="svg",n={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:s,mimeType:i}=Ig(t,o,e,n);return window.navigator.clipboard.write([new ClipboardItem({[i]:s})]).catch(a=>(console.error(a),s.then(l=>window.navigator.clipboard.write([new ClipboardItem({[i]:l})]))))}switch(e){case"json":case"svg":return Eg(async()=>Es(t,o,e,n));case"jpeg":case"png":throw new Error("Copy not supported");default:gn(e)}}async function Eg(t){var o,e;await((e=(o=navigator.clipboard)==null?void 0:o.writeText)==null?void 0:e.call(o,await t()))}function Mg(){const t=A(),{addToast:o}=De(),e=V();return k.useCallback((n,s="svg")=>{Tg(t,n,s).catch(()=>{o({id:"copy-fail",severity:"warning",title:e("toast.error.copy-fail.title"),description:e("toast.error.copy-fail.desc")})})},[t,o,e])}async function _g(t,o,e="png",n,s={}){if(!n&&(n=`shapes at ${er()}`,o.length===1)){const l=t.getShape(o[0]);t.isShapeOfType(l,"frame")?n=l.props.name??"frame":n=`${l.id.replace(/:/,"_")} at ${er()}`}n+=`.${e}`;const i=await rl({editor:t,ids:o,format:e,opts:s}),a=new File([i],n,{type:i.type});Ag(a)}function er(){const t=new Date,o=String(t.getFullYear()).slice(2),e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${o}-${e}-${n} ${s}.${i}.${a}`}function Ag(t){const o=document.createElement("a"),e=URL.createObjectURL(t);o.href=e,o.download=t.name,o.click(),URL.revokeObjectURL(e)}function $g(){const t=A(),{addToast:o}=De(),e=V();return k.useCallback((n,s="png",i)=>{_g(t,n,s,i,{scale:1,background:t.getInstanceState().exportBackground}).catch(a=>{console.error(a.message),o({id:"export-fail",title:e("toast.error.export-fail.title"),description:e("toast.error.export-fail.desc"),severity:"error"})})},[t,o,e])}function Dg(){const t=A(),o=k.useRef(null),e=k.useRef(null);return k.useCallback(async function(){const s=document.createElement("div"),i=document.createElement("style"),a=(b,w)=>{b&&(b.innerHTML=""),w&&document.head.contains(w)&&document.head.removeChild(w),b&&document.body.contains(b)&&document.body.removeChild(b)};a(o.current,e.current),o.current=s,e.current=i;const l=`tl-print-surface-${Ae()}`;s.className=l,i.innerHTML=`
			.${l} {
				display: none;
			}

			.${l} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${l} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${l}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${l}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${l}__item__header {
					display: none;
				}

				.${l}__item__footer {
					display: none;
					text-align: right;
				}

				.${l}__item__footer__hide {
					display: none;
				}

				
			}

		`;const d=()=>{document.head.appendChild(i),document.body.appendChild(s)},c=()=>{t.once("change-history",()=>{a(s,i)})};window.addEventListener("beforeprint",d),window.addEventListener("afterprint",c);function p(b,w,E){try{s.innerHTML+=`<div class="${l}__item">
        <div class="${l}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${l}__item__main">
          ${E}
        </div>
        <div class="${l}__item__footer ${l}__item__footer__${w?"":"hide"}">
          ${w??""}
        </div>
      </div>`}catch(C){console.error(C)}}function g(){t.environment.isChromeForIos?(d(),window.print()):t.environment.isSafari?(d(),document.execCommand("print",!1)):window.print()}const u=t.getSelectedShapeIds(),f=t.getCurrentPageId(),x=t.getPages(),v={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const b=await t.getSvgString(u,v);if(b){const w=x.find(E=>E.id===f);p(`tldraw — ${w==null?void 0:w.name}`,null,b.svg),g()}}else{const b=t.getCurrentPage(),w=await t.getSvgString(t.getSortedChildIdsForParent(b.id),v);w&&(p(`tldraw — ${b.name}`,null,w.svg),g())}window.removeEventListener("beforeprint",d),window.removeEventListener("afterprint",c)},[t])}const al=k.createContext({});function Lg(t){return Object.fromEntries(t.map(o=>[o.id,o]))}function Pt(t,o){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||o}function zg({overrides:t,children:o}){const e=A(),{addDialog:n,clearDialogs:s}=bt(),{clearToasts:i}=De(),a=V(),l=Xa(),d=Dg(),{cut:c,copy:p,paste:g}=Pg(),u=Mg(),f=$g(),x=a("document.default-name"),S=Ne(),v=k.useMemo(()=>{function b(){return e.isIn("select")||(e.complete(),e.setCurrentTool("select")),!1}function w(){return e.isIn("select")&&e.getSelectedShapeIds().length>0}const C=Lg([{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(y){w()&&(b()||(S("edit-link",{source:y}),e.mark("edit-link"),n({component:ig})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(y){S("insert-embed",{source:y}),n({component:qa})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(y){S("insert-media",{source:y}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(y){S("undo",{source:y}),e.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(y){S("redo",{source:y}),e.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("export-as",{format:"svg",source:y}),f(P,"svg",Pt(e,x)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("export-as",{format:"png",source:y}),f(P,"png",Pt(e,x)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("export-as",{format:"json",source:y}),f(P,"json",Pt(e,x)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("export-all-as",{format:"svg",source:y}),f(Array.from(e.getCurrentPageShapeIds()),"svg",Pt(e,x)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(y){const P=Array.from(e.getCurrentPageShapeIds().values());P.length!==0&&(S("export-all-as",{format:"png",source:y}),f(P,"png",Pt(e,x)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(y){const P=Array.from(e.getCurrentPageShapeIds().values());P.length!==0&&(S("export-all-as",{format:"json",source:y}),f(P,"json",Pt(e,x)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("copy-as",{format:"svg",source:y}),u(P,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("copy-as",{format:"png",source:y}),u(P,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(y){let P=e.getSelectedShapeIds();P.length===0&&(P=Array.from(e.getCurrentPageShapeIds().values())),P.length!==0&&(S("copy-as",{format:"json",source:y}),u(P,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(y){if(!w()||b())return;S("toggle-auto-size",{source:y}),e.mark("toggling auto size");const P=e.getSelectedShapes().filter(T=>e.isShapeOfType(T,"text")&&T.props.autoSize===!1);e.updateShapes(P.map(T=>({id:T.id,type:T.type,props:{...T.props,w:8,autoSize:!0}}))),J(e,P.map(T=>T.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(y){S("open-embed-link",{source:y});const P=e.getSelectedShapeIds(),T="No embed shapes selected";if(P.length!==1){console.error(T);return}const _=e.getShape(P[0]);if(!_||!e.isShapeOfType(_,"embed")){console.error(T);return}Oc(_.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(y){var P,T;if(((P=e.root.getCurrent())==null?void 0:P.id)!=="zoom"&&(S("zoom-tool",{source:y}),!(e.inputs.shiftKey||e.inputs.ctrlKey))){const _=e.root.getCurrent();_&&((T=_.getCurrent())==null?void 0:T.id)==="idle"&&e.setCurrentTool("zoom",{onInteractionEnd:_.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(y){w()&&(b()||e.batch(()=>{S("convert-to-bookmark",{source:y});const P=e.getSelectedShapes(),T=[],_=[];for(const D of P){if(!D||!e.isShapeOfType(D,"embed")||!D.props.url)continue;const M=new m(D.x,D.y);M.rot(-D.rotation),M.add(new m(D.props.w/2-300/2,D.props.h/2-320/2)),M.rot(D.rotation);const $={id:ne(),type:"bookmark",rotation:D.rotation,x:M.x,y:M.y,opacity:1,props:{url:D.props.url}};T.push($),_.push(D.id)}e.mark("convert shapes to bookmark"),e.deleteShapes(_),e.createShapes(T)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(y){w()&&(b()||(S("convert-to-embed",{source:y}),e.batch(()=>{const P=e.getSelectedShapeIds(),T=je(P.map(M=>e.getShape(M))),_=[],D=[];for(const M of T){if(!e.isShapeOfType(M,"bookmark"))continue;const{url:$}=M.props,z=Je(M.props.url);if(!z||!z.definition)continue;const{width:O,height:W}=z.definition,R=new m(M.x,M.y);R.rot(-M.rotation),R.add(new m(M.props.w/2-O/2,M.props.h/2-W/2)),R.rot(M.rotation);const X={id:ne(),type:"embed",x:R.x,y:R.y,rotation:M.rotation,props:{url:$,w:O,h:W}};_.push(X),D.push(M.id)}e.mark("convert shapes to embed"),e.deleteShapes(D),e.createShapes(_)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(y){if(!w()||b())return;S("duplicate-shapes",{source:y});const P=e.getInstanceState();let T,_;if(P.duplicateProps)T=P.duplicateProps.shapeIds,_=P.duplicateProps.offset;else{T=e.getSelectedShapeIds();const D=Z.Common(je(T.map(M=>e.getShapePageBounds(M))));_=P.canMoveCamera?{x:D.width+20,y:0}:{x:20,y:20}}e.mark("duplicate shapes"),e.duplicateShapes(T,_),P.duplicateProps&&e.updateInstanceState({duplicateProps:{...P.duplicateProps,shapeIds:e.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(y){w()&&(b()||(S("ungroup-shapes",{source:y}),e.mark("ungroup"),e.ungroupShapes(e.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(y){if(!w()||b())return;S("group-shapes",{source:y});const P=e.getOnlySelectedShape();P&&e.isShapeOfType(P,"group")?(e.mark("ungroup"),e.ungroupShapes(e.getSelectedShapeIds())):(e.mark("group"),e.groupShapes(e.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(y){if(!w())return;S("remove-frame",{source:y});const P=e.getSelectedShapes();P.length>0&&P.every(T=>e.isShapeOfType(T,"frame"))&&(e.mark("remove-frame"),ng(e,P.map(T=>T.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(y){if(!w())return;S("fit-frame-to-content",{source:y});const P=e.getOnlySelectedShape();P&&e.isShapeOfType(P,"frame")&&(e.mark("fit-frame-to-content"),sg(e,P.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"left",source:y}),e.mark("align left");const P=e.getSelectedShapeIds();e.alignShapes(P,"left"),J(e,P)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"center-horizontal",source:y}),e.mark("align center horizontal");const P=e.getSelectedShapeIds();e.alignShapes(P,"center-horizontal"),J(e,P)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"right",source:y}),e.mark("align right");const P=e.getSelectedShapeIds();e.alignShapes(P,"right"),J(e,P)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"center-vertical",source:y}),e.mark("align center vertical");const P=e.getSelectedShapeIds();e.alignShapes(P,"center-vertical"),J(e,P)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"top",source:y}),e.mark("align top");const P=e.getSelectedShapeIds();e.alignShapes(P,"top"),J(e,P)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(y){if(!w()||b())return;S("align-shapes",{operation:"bottom",source:y}),e.mark("align bottom");const P=e.getSelectedShapeIds();e.alignShapes(P,"bottom"),J(e,P)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(y){if(!w()||b())return;S("distribute-shapes",{operation:"horizontal",source:y}),e.mark("distribute horizontal");const P=e.getSelectedShapeIds();e.distributeShapes(P,"horizontal"),J(e,P)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(y){if(!w()||b())return;S("distribute-shapes",{operation:"vertical",source:y}),e.mark("distribute vertical");const P=e.getSelectedShapeIds();e.distributeShapes(P,"vertical"),J(e,P)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(y){if(!w()||b())return;S("stretch-shapes",{operation:"horizontal",source:y}),e.mark("stretch horizontal");const P=e.getSelectedShapeIds();e.stretchShapes(P,"horizontal"),J(e,P)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(y){if(!w()||b())return;S("stretch-shapes",{operation:"vertical",source:y}),e.mark("stretch vertical");const P=e.getSelectedShapeIds();e.stretchShapes(P,"vertical"),J(e,P)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(y){if(!w()||b())return;S("flip-shapes",{operation:"horizontal",source:y}),e.mark("flip horizontal");const P=e.getSelectedShapeIds();e.flipShapes(P,"horizontal"),J(e,P)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(y){if(!w()||b())return;S("flip-shapes",{operation:"vertical",source:y}),e.mark("flip vertical");const P=e.getSelectedShapeIds();e.flipShapes(P,"vertical"),J(e,P)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(y){if(!w()||b())return;S("pack-shapes",{source:y}),e.mark("pack");const P=e.getSelectedShapeIds();e.packShapes(P,16),J(e,P)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(y){if(!w()||b())return;S("stack-shapes",{operation:"vertical",source:y}),e.mark("stack-vertical");const P=e.getSelectedShapeIds();e.stackShapes(P,"vertical",16),J(e,P)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(y){if(!w()||b())return;S("stack-shapes",{operation:"horizontal",source:y}),e.mark("stack-horizontal");const P=e.getSelectedShapeIds();e.stackShapes(P,"horizontal",16),J(e,P)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(y){w()&&(b()||(S("reorder-shapes",{operation:"toFront",source:y}),e.mark("bring to front"),e.bringToFront(e.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(y){w()&&(b()||(S("reorder-shapes",{operation:"forward",source:y}),e.mark("bring forward"),e.bringForward(e.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(y){w()&&(b()||(S("reorder-shapes",{operation:"backward",source:y}),e.mark("send backward"),e.sendBackward(e.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(y){w()&&(b()||(S("reorder-shapes",{operation:"toBack",source:y}),e.mark("send to back"),e.sendToBack(e.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(y){w()&&(b()||(e.mark("cut"),c(y)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(y){w()&&(b()||p(y))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(y){var P;(P=navigator.clipboard)==null||P.read().then(T=>{g(T,y,y==="context-menu"?e.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(y){e.batch(()=>{b()||(S("select-all-shapes",{source:y}),e.mark("select all kbd"),e.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(y){w()&&(b()||(S("select-none-shapes",{source:y}),e.mark("select none"),e.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(y){w()&&(b()||(S("delete-shapes",{source:y}),e.mark("delete"),e.deleteShapes(e.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(y){if(!w()||b())return;S("rotate-cw",{source:y}),e.mark("rotate-cw");const P=e.getSelectionRotation()%(ee/2),T=Do(P,0)||Do(P,ee/2),_=e.getSelectedShapeIds();e.rotateShapesBy(_,ee/2-(T?0:P)),J(e,_)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(y){if(!w()||b())return;S("rotate-ccw",{source:y}),e.mark("rotate-ccw");const P=e.getSelectionRotation()%(ee/2),T=Do(P,0),_=e.getSelectedShapeIds();e.rotateShapesBy(_,T?-(ee/2):-P),J(e,_)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(y){S("zoom-in",{source:y}),e.zoomIn(e.getViewportScreenCenter(),{duration:Be})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(y){S("zoom-out",{source:y}),e.zoomOut(e.getViewportScreenCenter(),{duration:Be})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(y){S("reset-zoom",{source:y}),e.resetZoom(e.getViewportScreenCenter(),{duration:Be})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(y){S("zoom-to-fit",{source:y}),e.zoomToFit({duration:Be})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(y){w()&&(b()||(S("zoom-to-selection",{source:y}),e.zoomToSelection({duration:Be})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(y){S("toggle-snap-mode",{source:y}),e.user.updateUserPreferences({isSnapMode:!e.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(y){S("toggle-dark-mode",{source:y}),e.user.updateUserPreferences({isDarkMode:!e.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(y){S("toggle-wrap-mode",{source:y}),e.user.updateUserPreferences({isWrapMode:!e.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(y){S("toggle-reduce-motion",{source:y}),e.user.updateUserPreferences({animationSpeed:e.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(y){S("toggle-edge-scrolling",{source:y}),e.user.updateUserPreferences({edgeScrollSpeed:e.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(y){S("toggle-transparent",{source:y}),e.updateInstanceState({exportBackground:!e.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(y){S("toggle-tool-lock",{source:y}),e.updateInstanceState({isToolLocked:!e.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(y){S("unlock-all",{source:y});const P=[];for(const T of e.getCurrentPageShapes())T.isLocked&&P.push({id:T.id,type:T.type,isLocked:!1});P.length>0&&e.updateShapes(P)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(y){requestAnimationFrame(()=>{e.batch(()=>{S("toggle-focus-mode",{source:y}),s(),i(),e.updateInstanceState({isFocusMode:!e.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(y){S("toggle-grid-mode",{source:y}),e.updateInstanceState({isGridMode:!e.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(y){S("toggle-debug-mode",{source:y}),e.updateInstanceState({isDebugMode:!e.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(y){S("print",{source:y}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(y){S("exit-pen-mode",{source:y}),e.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(y){S("stop-following",{source:y}),e.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(y){S("zoom-to-content",{source:y}),e.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(y){e.mark("locking"),S("toggle-lock",{source:y}),e.toggleLock(e.getSelectedShapeIds())}},{id:"new-page",label:"context.pages.new-page",onSelect(y){const P=bo.createId(),T=e.getSelectedShapeIds();e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:a("page-menu.new-page-initial-name"),id:P}),e.moveShapesToPage(T,P)}),S("new-page",{source:y})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(y){const P=Ot;e.batch(()=>{e.mark("change-color"),e.isIn("select")&&e.setStyleForSelectedShapes(P,"white",{squashing:!1}),e.setStyleForNextShapes(P,"white",{squashing:!1}),e.updateInstanceState({isChangingStyle:!0},{ephemeral:!0})}),S("set-style",{source:y,id:P.id,value:"white"})}}]);return t?t(e,C,void 0):C},[e,S,t,n,l,f,u,c,p,g,s,i,d,a,x]);return r.jsx(al.Provider,{value:v,children:o})}function F(){const t=k.useContext(al);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function pn(t,o){return t?typeof t=="string"?t:o?t[o]??t.default:void 0:void 0}function it(t,o){const e=A(),n=k.useRef(!1),s=Ne(),i=k.useCallback(l=>{n.current=l,e.batch(()=>{l?(e.complete(),e.addOpenMenu(t)):e.updateInstanceState({openMenus:e.getOpenMenus().filter(d=>!d.startsWith(t))}),o==null||o(l)})},[e,t,o]),a=L("is menu open",()=>e.getOpenMenus().includes(t),[e,t]);return k.useEffect(()=>(n.current&&(s("open-menu",{source:"unknown",id:t}),e.addOpenMenu(t)),()=>{n.current&&(e.deleteOpenMenu(t),e.getOpenMenus().forEach(l=>{l.startsWith(t)&&(s("close-menu",{source:"unknown",id:t}),e.deleteOpenMenu(l))}),n.current=!1)}),[e,t,s]),[a,i]}function ni({id:t,children:o,onOpenChange:e,open:n}){const[s,i]=it(t,e);return r.jsx(pd,{onOpenChange:i,open:n||s,children:r.jsx("div",{className:"tlui-popover",children:o})})}function oi({children:t}){return r.jsx(ud,{asChild:!0,dir:"ltr",children:t})}function si({side:t,children:o,align:e="center",sideOffset:n=8,alignOffset:s=0}){const i=ot();return r.jsx(gd,{container:i,children:r.jsx(fd,{className:"tlui-popover__content",side:t,sideOffset:n,align:e,alignOffset:s,dir:"ltr",children:o})})}const ll=k.createContext({type:"menu",sourceId:"main-menu"});function Eo(){return k.useContext(ll)}function Ie({type:t,sourceId:o,children:e}){return r.jsx(ll.Provider,{value:{type:t,sourceId:o},children:e})}const cl=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,Og=cl?"⌘":"Ctrl",Fg=cl?"⌥":"Alt";function dl(t){return t.split(",")[0].split("").map(o=>{const e=o.replace(/\$/g,Og).replace(/\?/g,Fg).replace(/!/g,"⇧");return e[0].toUpperCase()+e.slice(1)})}function Ms(t){return"— "+dl(t).join(" ")}function Rg(t){return r.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...t,children:r.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[r.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),r.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:r.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function xt({id:t,children:o,modal:e=!1,debugOpen:n=!1}){const[s,i]=it(t);return r.jsx(Bs,{open:n||s,dir:"ltr",modal:e,onOpenChange:i,children:o})}function St({children:t,...o}){return r.jsx(Us,{dir:"ltr",asChild:!0,onTouchEnd:e=>de(e),...o,children:t})}function yt({side:t="bottom",align:o="start",sideOffset:e=8,alignOffset:n=8,children:s}){const i=ot();return r.jsx(wo,{container:i,children:r.jsx(Hs,{className:"tlui-menu",side:t,sideOffset:e,align:o,alignOffset:n,collisionPadding:4,children:s})})}function Ng({id:t,children:o}){const[e,n]=it(t);return r.jsx(Sd,{open:e,onOpenChange:n,children:o})}function Bg({id:t,label:o,title:e,disabled:n}){return r.jsx(yd,{dir:"ltr",asChild:!0,disabled:n,children:r.jsxs(B,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:n,title:e,children:[r.jsx(se,{children:o}),r.jsx(G,{icon:"chevron-right",small:!0})]})})}function Ug({id:t,alignOffset:o=-1,sideOffset:e=-4,size:n="small",children:s}){const i=ot();return r.jsx(wo,{container:i,children:r.jsx(bd,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:o,sideOffset:e,collisionPadding:4,"data-size":n,children:s})})}function Hg({children:t}){return r.jsx(xd,{dir:"ltr",className:"tlui-menu__group",children:t})}function un({noClose:t,children:o}){return r.jsx(md,{dir:"ltr",asChild:!0,onClick:t?de:void 0,children:o})}function rn({children:t,visibleOnMobileLayout:o=!1}){const e=xe();return!o&&e<oe.MOBILE?null:r.jsx("kbd",{className:"tlui-kbd",children:dl(t).map((n,s)=>r.jsx("span",{children:n},s))})}function I({disabled:t=!1,spinner:o=!1,readonlyOk:e=!1,id:n,kbd:s,label:i,icon:a,onSelect:l,noClose:d,isSelected:c}){const{type:p,sourceId:g}=Eo(),u=V(),[f,x]=k.useState(!1);if(Ve()&&!e)return null;const v=pn(i,p),b=s?Ms(s):void 0,w=v?u(v):void 0,E=w&&b?`${w} ${b}`:w;switch(p){case"menu":return r.jsx(un,{children:r.jsxs(B,{type:"menu","data-testid":`${g}.${n}`,disabled:t,title:E,onClick:C=>{d&&de(C),f?x(!1):l(g)},children:[r.jsx(se,{children:w}),s&&r.jsx(rn,{children:s})]})});case"context-menu":return t?null:r.jsxs(wd,{dir:"ltr",title:E,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${g}.${n}`,onSelect:C=>{d&&de(C),f?x(!1):l(g)},children:[r.jsx("span",{className:"tlui-button__label",draggable:!1,children:w}),s&&r.jsx(rn,{children:s}),o&&r.jsx(Rg,{})]});case"panel":return r.jsxs(B,{"data-testid":`${g}.${n}`,type:"menu",title:E,disabled:t,onClick:()=>l(g),children:[r.jsx(se,{children:w}),a&&r.jsx(G,{icon:a})]});case"small-icons":case"icons":return r.jsx(B,{"data-testid":`${g}.${n}`,type:"icon",title:E,disabled:t,onClick:()=>l(g),children:r.jsx(G,{icon:a,small:p==="small-icons"})});case"keyboard-shortcuts":return s?r.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${g}.${n}`,children:[r.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:w}),r.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:r.jsx(rn,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${i}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return r.jsxs(B,{type:"low",onClick:()=>l(g),children:[r.jsx(G,{icon:a}),r.jsx(se,{children:w})]});case"toolbar":return r.jsx(B,{type:"tool","data-testid":`tools.${n}`,"aria-label":v,"data-value":n,onClick:()=>l("toolbar"),title:E,onTouchStart:C=>{de(C),l("toolbar")},role:"radio","aria-checked":c?"true":"false",children:r.jsx(G,{icon:a})});case"toolbar-overflow":return r.jsx(un,{"aria-label":i,children:r.jsx(B,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{l("toolbar")},"data-testid":`tools.more.${n}`,title:E,role:"radio","aria-checked":c?"true":"false","data-value":n,children:r.jsx(G,{icon:a})})});default:throw gn(p)}}function Wg(){return r.jsxs(r.Fragment,{children:[r.jsx(Gg,{}),r.jsx(Kg,{}),r.jsx(Vg,{}),r.jsx(Yg,{}),r.jsx(Zg,{}),r.jsx(Jg,{}),r.jsx(Qg,{}),r.jsx(ef,{})]})}function Gg(){const t=F(),o=me(2);return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t["align-left"],disabled:!o}),r.jsx(I,{...t["align-center-horizontal"],disabled:!o}),r.jsx(I,{...t["align-right"],disabled:!o}),r.jsx(I,{...t["stretch-horizontal"],disabled:!o}),r.jsx(I,{...t["align-top"],disabled:!o}),r.jsx(I,{...t["align-center-vertical"],disabled:!o}),r.jsx(I,{...t["align-bottom"],disabled:!o}),r.jsx(I,{...t["stretch-vertical"],disabled:!o})]})}function Kg(){const t=F(),o=me(3);return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t["distribute-horizontal"],disabled:!o}),r.jsx(I,{...t["distribute-vertical"],disabled:!o})]})}function Vg(){const t=F(),o=Er();return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t["stack-horizontal"],disabled:!o}),r.jsx(I,{...t["stack-vertical"],disabled:!o})]})}function Yg(){const t=F(),o=me(1);return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t["send-to-back"],disabled:!o}),r.jsx(I,{...t["send-backward"],disabled:!o}),r.jsx(I,{...t["bring-forward"],disabled:!o}),r.jsx(I,{...t["bring-to-front"],disabled:!o})]})}function Zg(){return xe()<oe.TABLET_SM?r.jsx(qg,{}):r.jsx(Xg,{})}function qg(){const t=F(),o=A(),e=L("zoom is 1",()=>o.getZoomLevel()===1,[o]);return r.jsx(I,{...t["zoom-to-100"],disabled:e})}function Xg(){const t=F(),o=me(1);return r.jsx(I,{...t["rotate-ccw"],disabled:!o})}function Jg(){const t=F(),o=me(1);return r.jsx(I,{...t["rotate-cw"],disabled:!o})}function Qg(){const t=F(),o=Ar();return r.jsx(I,{...t["edit-link"],disabled:!o})}function ef(){const t=Mr(),o=_r();return t?r.jsx(tr,{}):o?r.jsx(tf,{}):r.jsx(tr,{})}function tr(){const t=F(),o=me(2);return r.jsx(I,{...t.group,disabled:!o})}function tf(){const t=F();return r.jsx(I,{...t.ungroup})}const nf=k.memo(function({children:o}){const e=V(),n=xe(),s=Ve(),i=A(),a=L("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),l=o??r.jsx(Wg,{});if(!(s&&!a))return r.jsxs(ni,{id:"actions-menu",children:[r.jsx(oi,{children:r.jsx(B,{type:"icon","data-testid":"actions-menu.button",title:e("actions-menu.title"),children:r.jsx(G,{icon:"dots-vertical",small:!0})})}),r.jsx(si,{side:n>=oe.TABLET?"bottom":"top",sideOffset:6,children:r.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:r.jsx(Ie,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function Te({id:t,kbd:o,label:e,readonlyOk:n,onSelect:s,disabled:i=!1,checked:a=!1}){const{type:l,sourceId:d}=Eo(),c=Ve(),p=V();if(c&&!n)return null;const g=pn(e,l),u=g?p(g):void 0;switch(l){case"menu":return r.jsxs(kd,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:u,onSelect:f=>{s==null||s(d),de(f)},disabled:i,checked:a,children:[r.jsx(et,{small:!0,icon:a?"check":"checkbox-empty"}),u&&r.jsx("span",{className:"tlui-button__label",draggable:!1,children:u}),o&&r.jsx(rn,{children:o})]});case"context-menu":return r.jsxs(vd,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:u,onSelect:f=>{s(d),de(f)},disabled:i,checked:a,children:[r.jsx(et,{small:!0,icon:a?"check":"checkbox-empty"}),u&&r.jsx("span",{className:"tlui-button__label",draggable:!1,children:u}),o&&r.jsx(rn,{children:o})]},t);default:return null}}function U({id:t,label:o,children:e}){const{type:n,sourceId:s}=Eo(),i=V(),a=pn(o,n),l=a?i(a):void 0;switch(n){case"panel":return r.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${t}`,children:e});case"menu":return r.jsx(Hg,{"data-testid":`${s}-group.${t}`,children:e});case"context-menu":return r.jsx(Pd,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${t}`,children:e});case"keyboard-shortcuts":return r.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${t}`,children:[r.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),r.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:e})]});default:return e}}function Ee({id:t,disabled:o=!1,label:e,size:n="small",children:s}){const{type:i,sourceId:a}=Eo(),l=ot(),d=V(),c=e?typeof e=="string"?e:e[i]??e.default:void 0,p=c?d(c):void 0;switch(i){case"menu":return r.jsxs(Ng,{id:`${a}-sub.${t}`,children:[r.jsx(Bg,{id:`${a}-sub.${p?p.toLowerCase()+"-button":""}`,disabled:o,label:p,title:p}),r.jsx(Ug,{id:`${a}-sub.${p?p.toLowerCase()+"-content":""}`,size:n,children:s})]});case"context-menu":return o?null:r.jsxs(of,{id:`${a}-sub.${t}`,children:[r.jsx(Cd,{dir:"ltr",disabled:o,asChild:!0,children:r.jsxs(B,{"data-testid":`${a}-sub-trigger.${t}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[r.jsx(se,{children:p}),r.jsx(G,{icon:"chevron-right",small:!0})]})}),r.jsx(jd,{container:l,children:r.jsx(Id,{"data-testid":`${a}-sub-content.${t}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":n,children:s})})]});default:return s}}function of({id:t,children:o}){const[e,n]=it(t);return r.jsx(Td,{open:e,onOpenChange:n,children:o})}function hl(){const t=F();return Ud()?r.jsx(I,{...t["toggle-auto-size"]}):null}function pl(){const t=F();return Ar()?r.jsx(I,{...t["edit-link"]}):null}function sf(){const t=F();return me(1)?r.jsx(I,{...t.duplicate}):null}function ul(){const t=F();return Mr()?r.jsx(I,{...t.group}):null}function gl(){const t=F();return _r()?r.jsx(I,{...t.ungroup}):null}function fl(){const t=A(),o=F();return L("allow unframe",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.every(s=>t.isShapeOfType(s,"frame"))},[t])?r.jsx(I,{...o["remove-frame"]}):null}function ml(){const t=A(),o=F();return L("allow fit frame to content",()=>{const n=t.getOnlySelectedShape();return n?t.isShapeOfType(n,"frame")&&t.getSortedChildIdsForParent(n).length>0:!1},[t])?r.jsx(I,{...o["fit-frame-to-content"]}):null}function xl(){const t=A(),o=F();return L("selected shapes",()=>t.getSelectedShapes().length>0,[t])?r.jsx(I,{...o["toggle-lock"]}):null}function ii(){const t=F(),o=A(),e=L("isTransparentBg",()=>!o.getInstanceState().exportBackground,[o]);return r.jsx(Te,{...t["toggle-transparent"],checked:e})}function rf(){const t=A(),o=F(),e=L("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return r.jsx(I,{...o["unlock-all"],disabled:!e})}function Sl(){const t=A(),o=L("zoomed to 100",()=>t.getZoomLevel()===1,[t]),e=F();return r.jsx(I,{...e["zoom-to-100"],noClose:!0,disabled:o})}function yl(){const t=A(),o=L("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]),e=F();return r.jsx(I,{...e["zoom-to-fit"],disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function bl(){const t=A(),o=L("has shapes",()=>t.getSelectedShapeIds().length>0,[t]),e=F();return r.jsx(I,{...e["zoom-to-selection"],disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function wl(){return r.jsxs(U,{id:"clipboard",children:[r.jsx(lf,{}),r.jsx(cf,{}),r.jsx(df,{}),r.jsx(sf,{}),r.jsx(hf,{})]})}function af(){var n;const t=A(),o=F(),e=L("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return r.jsxs(Ee,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[r.jsxs(U,{id:"copy-as-group",children:[r.jsx(I,{...o["copy-as-svg"]}),!!((n=window.navigator.clipboard)!=null&&n.write)&&r.jsx(I,{...o["copy-as-png"]}),r.jsx(I,{...o["copy-as-json"]})]}),r.jsx(U,{id:"copy-as-bg",children:r.jsx(ii,{})})]})}function lf(){const t=F(),o=me(1);return r.jsx(I,{...t.cut,disabled:!o})}function cf(){const t=F(),o=Bd(1);return r.jsx(I,{...t.copy,disabled:!o})}function df(){const t=F(),o=Nd;return r.jsx(I,{...t.paste,disabled:!o})}function vl(){const t=A(),o=F();return L("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?r.jsxs(U,{id:"conversions",children:[r.jsx(af,{}),r.jsxs(Ee,{id:"export-as",label:"context-menu.export-as",size:"small",children:[r.jsxs(U,{id:"export-as-group",children:[r.jsx(I,{...o["export-as-svg"]}),r.jsx(I,{...o["export-as-png"]}),r.jsx(I,{...o["export-as-json"]})]}),r.jsx(U,{id:"export-as-bg",children:r.jsx(ii,{})})]})]}):null}function kl(){const t=F(),o=A(),e=L("atLeastOneShapeOnPage",()=>o.getCurrentPageShapeIds().size>0,[o]);return r.jsx(I,{...t["select-all"],disabled:!e})}function hf(){const t=F(),o=me(1);return r.jsx(I,{...t.delete,disabled:!o})}function pf(){const t=me(2),o=Hd(),e=F();return t||o?r.jsxs(Ee,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&r.jsxs(U,{id:"align",children:[r.jsx(I,{...e["align-left"]}),r.jsx(I,{...e["align-center-horizontal"]}),r.jsx(I,{...e["align-right"]}),r.jsx(I,{...e["align-top"]}),r.jsx(I,{...e["align-center-vertical"]}),r.jsx(I,{...e["align-bottom"]})]}),r.jsx(uf,{}),t&&r.jsxs(U,{id:"stretch",children:[r.jsx(I,{...e["stretch-horizontal"]}),r.jsx(I,{...e["stretch-vertical"]})]}),(t||o)&&r.jsxs(U,{id:"flip",children:[r.jsx(I,{...e["flip-horizontal"]}),r.jsx(I,{...e["flip-vertical"]})]}),r.jsx(gf,{})]}):null}function uf(){const t=F();return me(3)?r.jsxs(U,{id:"distribute",children:[r.jsx(I,{...t["distribute-horizontal"]}),r.jsx(I,{...t["distribute-vertical"]})]}):null}function gf(){const t=F(),o=me(2),e=Er();return o?r.jsxs(U,{id:"order",children:[r.jsx(I,{...t.pack}),e&&r.jsx(I,{...t["stack-horizontal"]}),e&&r.jsx(I,{...t["stack-vertical"]})]}):null}function ff(){const t=F();return me(1)?r.jsx(Ee,{id:"reorder",label:"context-menu.reorder",size:"small",children:r.jsxs(U,{id:"reorder",children:[r.jsx(I,{...t["bring-to-front"]}),r.jsx(I,{...t["bring-forward"]}),r.jsx(I,{...t["send-backward"]}),r.jsx(I,{...t["send-to-back"]})]})}):null}function mf(){const t=A(),o=L("pages",()=>t.getPages(),[t]),e=L("current page id",()=>t.getCurrentPageId(),[t]),{addToast:n}=De(),s=F(),i=Ne();return me(1)?r.jsxs(Ee,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[r.jsx(U,{id:"pages",children:o.map(l=>r.jsx(I,{id:l.id,disabled:e===l.id,label:l.name,onSelect:()=>{t.mark("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),l.id);const d=t.getPage(l.id);d&&n({title:"Changed Page",description:`Moved to ${d.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.mark("change-page"),t.setCurrentPage(e)}}]}),i("move-to-page",{source:"context-menu"})}},l.id))}),r.jsx(U,{id:"new-page",children:r.jsx(I,{...s["new-page"]})})]}):null}function Pl(){const t=A(),o=F();return L("oneEmbedSelected",()=>{const n=t.getOnlySelectedShape();return n?!!(t.isShapeOfType(n,"embed")&&n.props.url&&!t.isShapeOrAncestorLocked(n)):!1},[t])?r.jsx(I,{...o["convert-to-bookmark"]}):null}function Cl(){const t=A(),o=F();return L("oneEmbeddableBookmarkSelected",()=>{const n=t.getOnlySelectedShape();return n?!!(t.isShapeOfType(n,"bookmark")&&n.props.url&&Je(n.props.url)&&!t.isShapeOrAncestorLocked(n)):!1},[t])?r.jsx(I,{...o["convert-to-embed"]}):null}function xf(){const t=F(),o=A(),e=L("isSnapMode",()=>o.user.getIsSnapMode(),[o]);return r.jsx(Te,{...t["toggle-snap-mode"],checked:e})}function Sf(){const t=F(),o=A(),e=L("isToolLock",()=>o.getInstanceState().isToolLocked,[o]);return r.jsx(Te,{...t["toggle-tool-lock"],checked:e})}function yf(){const t=F(),o=A(),e=L("isGridMode",()=>o.getInstanceState().isGridMode,[o]);return r.jsx(Te,{...t["toggle-grid"],checked:e})}function bf(){const t=F(),o=A(),e=L("isWrapMode",()=>o.user.getIsWrapMode(),[o]);return r.jsx(Te,{...t["toggle-wrap-mode"],checked:e})}function wf(){const t=F(),o=A(),e=L("isDarkMode",()=>o.user.getIsDarkMode(),[o]);return r.jsx(Te,{...t["toggle-dark-mode"],checked:e})}function vf(){const t=F(),o=A(),e=L("isFocusMode",()=>o.getInstanceState().isFocusMode,[o]);return r.jsx(Te,{...t["toggle-focus-mode"],checked:e})}function kf(){const t=F(),o=A(),e=L("edgeScrollSpeed",()=>o.user.getEdgeScrollSpeed(),[o]);return r.jsx(Te,{...t["toggle-edge-scrolling"],checked:e===1})}function Pf(){const t=F(),o=A(),e=L("animationSpeed",()=>o.user.getAnimationSpeed(),[o]);return r.jsx(Te,{...t["toggle-reduce-motion"],checked:e===0})}function Cf(){const t=F(),o=A(),e=L("isDebugMode",()=>o.getInstanceState().isDebugMode,[o]);return r.jsx(Te,{...t["toggle-debug-mode"],checked:e})}function jf(){const t=A();return L("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t])?r.jsxs(r.Fragment,{children:[r.jsxs(U,{id:"misc",children:[r.jsx(ul,{}),r.jsx(gl,{}),r.jsx(pl,{}),r.jsx(hl,{}),r.jsx(fl,{}),r.jsx(ml,{}),r.jsx(Cl,{}),r.jsx(Pl,{}),r.jsx(xl,{})]}),r.jsxs(U,{id:"modify",children:[r.jsx(pf,{}),r.jsx(ff,{}),r.jsx(mf,{})]}),r.jsx(wl,{}),r.jsx(vl,{}),r.jsx(U,{id:"select-all",children:r.jsx(kl,{})})]}):null}const If=k.memo(function({children:o}){const e=A(),{Canvas:n}=yr(),s=k.useCallback(c=>{if(c){if(e.getInstanceState().isCoarsePointer){const p=e.getSelectedShapes(),{inputs:{currentPagePoint:g}}=e,u=e.getShapesAtPoint(g);if(!e.getSelectedShapes().length||!u.some(f=>p.includes(f))){const f=u.filter(x=>e.isShapeOrAncestorLocked(x));f.length&&e.select(...f.map(x=>x.id))}}}else{const p=e.getOnlySelectedShape();p&&e.isShapeOrAncestorLocked(p)&&e.setSelectedShapes([])}},[e]),i=ot(),[a,l]=it("context menu",s),d=o??r.jsx(jf,{});return r.jsxs(Ed,{dir:"ltr",onOpenChange:l,modal:!1,children:[r.jsx(Md,{onContextMenu:void 0,dir:"ltr",children:n?r.jsx(n,{}):null}),a&&r.jsx(_d,{container:i,children:r.jsx(Ad,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:de,children:r.jsx(Ie,{type:"context-menu",sourceId:"context-menu",children:d})})})]})});function _s({checked:t}){return r.jsx(et,{icon:t?"check":"checkbox-empty",className:"tlui-button__icon",small:!0})}function Tf(){const t=A(),{addToast:o}=De(),{addDialog:e}=bt(),[n,s]=fe.useState(!1);return r.jsxs(r.Fragment,{children:[r.jsxs(U,{id:"items",children:[r.jsx(I,{id:"add-toast",onSelect:()=>{o({id:Ae(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),o({id:Ae(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),o({id:Ae(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),o({id:Ae(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),r.jsx(I,{id:"show-dialog",label:"Show dialog",onSelect:()=>{e({component:({onClose:i})=>r.jsx(_f,{displayDontShowAgain:!0,onCancel:()=>i(),onContinue:()=>i()}),onClose:()=>{}})}}),r.jsx(I,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Af(t,100)}),r.jsx(I,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var l;const i=t.getSelectedShapes(),a=i.length===0?t.getRenderingShapes():i;window.alert(`Shapes ${a.length}, DOM nodes:${(l=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:l.length}`)}}),(()=>{if(n)throw Error("oh no!");return null})(),r.jsx(I,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),r.jsx(I,{id:"hard-reset",onSelect:Fc,label:"Hard reset"})]}),r.jsxs(U,{id:"flags",children:[r.jsx(Ef,{}),r.jsx(Mf,{})]})]})}function Ef(){const t=Object.values(ht);return t.length?r.jsx(Ee,{id:"debug flags",label:"Debug Flags",children:r.jsx(U,{id:"debug flags",children:t.map(o=>r.jsx(jl,{flag:o},o.name))})}):null}function Mf(){const t=Object.values(Rc);return t.length?r.jsx(Ee,{id:"feature flags",label:"Feature Flags",children:r.jsx(U,{id:"feature flags",children:t.map(o=>r.jsx(jl,{flag:o},o.name))})}):null}function _f({title:t="title",body:o="hello hello hello",cancel:e="Cancel",confirm:n="Continue",displayDontShowAgain:s=!1,onCancel:i,onContinue:a}){const[l,d]=fe.useState(!1);return r.jsxs(r.Fragment,{children:[r.jsxs(jo,{children:[r.jsx(Io,{children:t}),r.jsx(To,{})]}),r.jsx(hn,{style:{maxWidth:350},children:o}),r.jsxs(ei,{className:"tlui-dialog__footer__actions",children:[s&&r.jsxs(B,{type:"normal",onClick:()=>d(!l),style:{marginRight:"auto"},children:[r.jsx(_s,{checked:l}),r.jsx(se,{children:"Don't show again"})]}),r.jsx(B,{type:"normal",onClick:i,children:r.jsx(se,{children:e})}),r.jsx(B,{type:"primary",onClick:async()=>a(),children:r.jsx(se,{children:n})})]})]})}const jl=Ke(function({flag:o,onChange:e}){const n=o.get();return r.jsx(Te,{id:o.name,title:o.name,label:o.name.replace(/([a-z0-9])([A-Z])/g,s=>`${s[0]} ${s[1].toLowerCase()}`).replace(/^[a-z]/,s=>s.toUpperCase()),checked:n,onSelect:()=>{o.set(!n),e==null||e(!n)}})});let nr=0;function Af(t,o){const e=Array(o),n=Math.floor(Math.sqrt(o));for(let s=0;s<o;s++)nr++,e[s]={id:ne("box"+nr),type:"geo",x:s%n*132,y:Math.floor(s/n)*132};t.batch(()=>{t.createShapes(e).setSelectedShapes(e.map(s=>s.id))})}function $f({children:t}){const o=t??r.jsx(Tf,{});return r.jsxs(xt,{id:"debug",children:[r.jsx(St,{children:r.jsx(B,{type:"icon",title:"Debug menu",children:r.jsx(G,{icon:"dots-horizontal"})})}),r.jsx(yt,{side:"top",align:"end",alignOffset:0,children:r.jsx(Ie,{type:"menu",sourceId:"debug-panel",children:o})})]})}const Df=k.memo(function(){const{DebugMenu:o}=at();return r.jsxs("div",{className:"tlui-debug-panel",children:[r.jsx(zf,{}),r.jsx(Of,{}),o&&r.jsx(o,{})]})});function Lf(t=!0){const[o,e]=k.useState(0),n=A();k.useEffect(()=>{if(!t)return;const s=()=>e(i=>i+1);return n.on("tick",s),()=>{n.off("tick",s)}},[n,t])}const zf=Ke(function(){Lf();const o=A(),e=o.getPath(),n=o.getHoveredShape(),s=o.getOnlySelectedShape(),i=e==="select.idle"||!e.includes("select.")?n:s,a=i&&e.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${m.ToFixed(o.getPointInShapeSpace(i,o.inputs.currentPagePoint),0)}]`:"",l=e.startsWith("select.")&&!e.includes(".idle")?` / [${m.ToFixed(o.inputs.originPagePoint,0)}] → [${m.ToFixed(o.inputs.currentPagePoint,0)}] = ${m.Dist(o.inputs.originPagePoint,o.inputs.currentPagePoint).toFixed(0)}`:"";return r.jsx("div",{className:"tlui-debug-panel__current-state",children:`${e}${a}${l}`})});function Of(){const t=L("show_fps",()=>ht.showFps.get(),[ht]),o=k.useRef(null);return k.useEffect(()=>{if(!t)return;const e=250;let n=0,s=!1,i=performance.now(),a=0,l=0,d=!1;function c(){if(!s){if(l++,a=performance.now()-i,a>e){const p=Math.round(l*(e/a)*(1e3/e));p>n&&(n=p);const g=n*.75;(p<g&&!d||p>=g&&d)&&(d=!d),o.current.innerHTML=`FPS ${p.toString()}`,o.current.className="tlui-debug-panel__fps"+(d?" tlui-debug-panel__fps__slow":""),a-=e,l=0,i=performance.now()}requestAnimationFrame(c)}}return c(),()=>{s=!0}},[t]),t?r.jsx("div",{ref:o}):null}function Il(){const t=A(),o=Ne(),e=L("locale",()=>t.user.getLocale(),[t]);return r.jsx(Ee,{id:"help menu language",label:"menu.language",children:r.jsx(U,{id:"languages",children:Rs.map(({locale:n,label:s})=>r.jsx(Te,{id:`language-${n}`,title:n,label:s,checked:n===e,onSelect:()=>{t.user.updateUserPreferences({locale:n}),o("change-language",{source:"menu",locale:n})}},n))})})}function Ff(){return r.jsxs(r.Fragment,{children:[r.jsx(Il,{}),r.jsx(Rf,{})]})}function Rf(){const{KeyboardShortcutsDialog:t}=at(),{addDialog:o}=bt();return t?r.jsx(I,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{o({component:t})}}):null}const Nf=k.memo(function({children:o}){const e=V(),n=xe(),s=o??r.jsx(Ff,{});return n<oe.MOBILE?null:r.jsx("div",{className:"tlui-help-menu",children:r.jsxs(xt,{id:"help menu",children:[r.jsx(St,{children:r.jsx(B,{type:"help",title:e("help-menu.title"),"data-testid":"help-menu.button",children:r.jsx(G,{icon:"question-mark",small:!0})})}),r.jsx(yt,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:r.jsx(Ie,{type:"menu",sourceId:"help-menu",children:s})})]})})});function Bf(){const t=A(),o=F(),[e,n]=k.useState(!1),s=k.useRef(!1);return Nc("toggle showback to content",()=>{const i=s.current,a=t.getCurrentPageShapeIds();let l=!1;a.size&&(l=a.size===t.getCulledShapes().size),i!==l&&(n(l),s.current=l)},[t]),e?r.jsx(I,{...o["back-to-content"],onSelect:()=>{o["back-to-content"].onSelect("helper-buttons"),n(!1)}}):null}function Uf(){const t=A(),o=F();return L("is pen mode",()=>t.getInstanceState().isPenMode,[t])?r.jsx(I,{...o["exit-pen-mode"]}):null}function Hf(){const t=A(),o=F();return L("is following user",()=>!!t.getInstanceState().followingUserId,[t])?r.jsx(I,{...o["stop-following"]}):null}function Wf(){return r.jsxs(r.Fragment,{children:[r.jsx(Uf,{}),r.jsx(Bf,{}),r.jsx(Hf,{})]})}function Gf({children:t}){const o=t??r.jsx(Wf,{});return r.jsx("div",{className:"tlui-helper-buttons",children:r.jsx(Ie,{type:"helper-buttons",sourceId:"helper-buttons",children:o})})}function Kf(){const t=F(),o=Y();return r.jsxs(r.Fragment,{children:[r.jsxs(U,{label:"shortcuts-dialog.tools",id:"tools",children:[r.jsx(I,{...t["toggle-tool-lock"]}),r.jsx(I,{...t["insert-media"]}),r.jsx(I,{...o.select}),r.jsx(I,{...o.draw}),r.jsx(I,{...o.eraser}),r.jsx(I,{...o.hand}),r.jsx(I,{...o.rectangle}),r.jsx(I,{...o.ellipse}),r.jsx(I,{...o.arrow}),r.jsx(I,{...o.line}),r.jsx(I,{...o.text}),r.jsx(I,{...o.frame}),r.jsx(I,{...o.note}),r.jsx(I,{...o.laser})]}),r.jsxs(U,{label:"shortcuts-dialog.preferences",id:"preferences",children:[r.jsx(I,{...t["toggle-dark-mode"]}),r.jsx(I,{...t["toggle-focus-mode"]}),r.jsx(I,{...t["toggle-grid"]})]}),r.jsxs(U,{label:"shortcuts-dialog.edit",id:"edit",children:[r.jsx(I,{...t.undo}),r.jsx(I,{...t.redo}),r.jsx(I,{...t.cut}),r.jsx(I,{...t.copy}),r.jsx(I,{...t.paste}),r.jsx(I,{...t["select-all"]}),r.jsx(I,{...t.delete}),r.jsx(I,{...t.duplicate})]}),r.jsxs(U,{label:"shortcuts-dialog.view",id:"view",children:[r.jsx(I,{...t["zoom-in"]}),r.jsx(I,{...t["zoom-out"]}),r.jsx(I,{...t["zoom-to-100"]}),r.jsx(I,{...t["zoom-to-fit"]}),r.jsx(I,{...t["zoom-to-selection"]})]}),r.jsxs(U,{label:"shortcuts-dialog.transform",id:"transform",children:[r.jsx(I,{...t["bring-to-front"]}),r.jsx(I,{...t["bring-forward"]}),r.jsx(I,{...t["send-backward"]}),r.jsx(I,{...t["send-to-back"]}),r.jsx(I,{...t.group}),r.jsx(I,{...t.ungroup}),r.jsx(I,{...t["flip-horizontal"]}),r.jsx(I,{...t["flip-vertical"]}),r.jsx(I,{...t["align-top"]}),r.jsx(I,{...t["align-center-vertical"]}),r.jsx(I,{...t["align-bottom"]}),r.jsx(I,{...t["align-left"]}),r.jsx(I,{...t["align-center-horizontal"]}),r.jsx(I,{...t["align-right"]})]})]})}const Vf=k.memo(function({children:o}){const e=V(),n=xe(),s=o??r.jsx(Kf,{});return r.jsxs(r.Fragment,{children:[r.jsxs(jo,{className:"tlui-shortcuts-dialog__header",children:[r.jsx(Io,{children:e("shortcuts-dialog.title")}),r.jsx(To,{})]}),r.jsx(hn,{className:H("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=oe.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=oe.TABLET}),children:r.jsx(Ie,{type:"keyboard-shortcuts",sourceId:"kbd",children:s})}),r.jsx("div",{className:"tlui-dialog__scrim"})]})});function Yf(){return r.jsxs(r.Fragment,{children:[r.jsx(qf,{}),r.jsx(em,{}),r.jsx(Zf,{}),r.jsx(tm,{}),r.jsx(nm,{})]})}function Zf(){const t=F();return r.jsxs(Ee,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[r.jsxs(U,{id:"export-all-as-group",children:[r.jsx(I,{...t["export-all-as-svg"]}),r.jsx(I,{...t["export-all-as-png"]}),r.jsx(I,{...t["export-all-as-json"]})]}),r.jsx(U,{id:"export-all-as-bg",children:r.jsx(ii,{})})]})}function qf(){const t=A(),o=L("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]);return r.jsxs(Ee,{id:"edit",label:"menu.edit",disabled:!o,children:[r.jsx(Qf,{}),r.jsx(wl,{}),r.jsx(vl,{}),r.jsx(Xf,{}),r.jsx(Jf,{}),r.jsx(U,{id:"select-all",children:r.jsx(kl,{})})]})}function Xf(){return r.jsxs(U,{id:"misc",children:[r.jsx(ul,{}),r.jsx(gl,{}),r.jsx(pl,{}),r.jsx(hl,{}),r.jsx(fl,{}),r.jsx(ml,{}),r.jsx(Cl,{}),r.jsx(Pl,{})]})}function Jf(){return r.jsxs(U,{id:"lock",children:[r.jsx(xl,{}),r.jsx(rf,{})]})}function Qf(){const t=F(),o=Dr(),e=$r();return r.jsxs(U,{id:"undo-redo",children:[r.jsx(I,{...t.undo,disabled:!o}),r.jsx(I,{...t.redo,disabled:!e})]})}function em(){const t=F();return r.jsx(Ee,{id:"view",label:"menu.view",children:r.jsxs(U,{id:"view-actions",children:[r.jsx(I,{...t["zoom-in"]}),r.jsx(I,{...t["zoom-out"]}),r.jsx(Sl,{}),r.jsx(yl,{}),r.jsx(bl,{})]})})}function tm(){const t=F();return r.jsxs(U,{id:"extras",children:[r.jsx(I,{...t["insert-embed"]}),r.jsx(I,{...t["insert-media"]})]})}function nm(){return r.jsx(U,{id:"preferences",children:r.jsxs(Ee,{id:"preferences",label:"menu.preferences",children:[r.jsxs(U,{id:"preferences-actions",children:[r.jsx(xf,{}),r.jsx(Sf,{}),r.jsx(yf,{}),r.jsx(bf,{}),r.jsx(wf,{}),r.jsx(vf,{}),r.jsx(kf,{}),r.jsx(Pf,{}),r.jsx(Cf,{})]}),r.jsx(U,{id:"language",children:r.jsx(Il,{})})]})})}const om=k.memo(function({children:o}){const e=ot(),[n,s]=it("main menu"),i=V(),a=o??r.jsx(Yf,{});return r.jsxs(Bs,{dir:"ltr",open:n,onOpenChange:s,modal:!1,children:[r.jsx(Us,{asChild:!0,dir:"ltr",children:r.jsx(B,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:r.jsx(G,{icon:"menu",small:!0})})}),r.jsx(wo,{container:e,children:r.jsx(Hs,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:r.jsx(Ie,{type:"menu",sourceId:"main-menu",children:a})})})]})}),sm=k.memo(function(){const o=xe(),{MainMenu:e,QuickActions:n,ActionsMenu:s,PageMenu:i}=at();return!e&&!i&&o<6?null:r.jsx("div",{className:"tlui-menu-zone",children:r.jsxs("div",{className:"tlui-buttons__horizontal",children:[e&&r.jsx(e,{}),i&&r.jsx(i,{}),o<6?null:r.jsxs(r.Fragment,{children:[n&&r.jsx(n,{}),s&&r.jsx(s,{})]})]})})}),Ho={};function Xt(t){if(Ho[t])return Ho[t];const e=document.createElement("canvas").getContext("2d");e.fillStyle=t,e.fillRect(0,0,1,1);const[n,s,i,a]=e.getImageData(0,0,1,1).data,l=new Float32Array([n/255,s/255,i/255,a/255]);return Ho[t]=l,l}const so=10,Tl=4*6*so+12+4*12;function Ct(t,{center:o,radius:e,numArcSegments:n=20,startAngle:s=0,endAngle:i=zt,offset:a=0}){const l=(i-s)/n;let d=a;for(let c=s;c<i;c+=l)t[d++]=o.x,t[d++]=o.y,t[d++]=o.x+Math.cos(c)*e,t[d++]=o.y+Math.sin(c)*e,t[d++]=o.x+Math.cos(c+l)*e,t[d++]=o.y+Math.sin(c+l)*e;return t}function jt(t,o,e,n,s,i){t[o++]=e,t[o++]=n,t[o++]=e,t[o++]=n+i,t[o++]=e+s,t[o++]=n,t[o++]=e+s,t[o++]=n,t[o++]=e,t[o++]=n+i,t[o++]=e+s,t[o++]=n+i}function im(t,o,e){const n=so;e=Math.min(e,Math.min(o.w,o.h)/2);const s=Z.ExpandBy(o,-e);if(s.w<=0||s.h<=0)return Ct(t,{center:o.center,radius:e,numArcSegments:so*4}),so*4*6;let i=0;return jt(t,i,s.minX,s.minY,s.w,s.h),i+=12,jt(t,i,s.minX,o.minY,s.w,e),i+=12,jt(t,i,s.maxX,s.minY,e,s.h),i+=12,jt(t,i,s.minX,s.maxY,s.w,e),i+=12,jt(t,i,o.minX,s.minY,e,s.h),i+=12,Ct(t,{numArcSegments:n,offset:i,center:s.point,radius:e,startAngle:ce,endAngle:ce*1.5}),i+=n*6,Ct(t,{numArcSegments:n,offset:i,center:m.Add(s.point,new m(s.w,0)),radius:e,startAngle:ce*1.5,endAngle:zt}),i+=n*6,Ct(t,{numArcSegments:n,offset:i,center:m.Add(s.point,s.size),radius:e,startAngle:0,endAngle:ee}),i+=n*6,Ct(t,{numArcSegments:n,offset:i,center:m.Add(s.point,new m(0,s.h)),radius:e,startAngle:ee,endAngle:ce}),Tl}function rm(t){if(!t)throw new Error("Canvas element not found");const o=t.getContext("webgl2",{premultipliedAlpha:!1});if(!o)throw new Error("Failed to get webgl2 context");const e=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,n=o.createShader(o.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader");if(o.shaderSource(n,e),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const s=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,i=o.createShader(o.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(o.shaderSource(i,s),o.compileShader(i),!o.getShaderParameter(i,o.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const a=o.createProgram();if(!a)throw new Error("Failed to create program");if(o.attachShader(a,n),o.attachShader(a,i),o.linkProgram(a),!o.getProgramParameter(a,o.LINK_STATUS))throw new Error("Failed to link program");o.useProgram(a);const l=o.getAttribLocation(a,"shapeVertexPosition");if(l<0)throw new Error("Failed to get shapeVertexPosition attribute location");o.enableVertexAttribArray(l);const d=o.getUniformLocation(a,"canvasPageBounds"),c=o.getUniformLocation(a,"fillColor");if(!o.createBuffer())throw new Error("Failed to create buffer");if(!o.createBuffer())throw new Error("Failed to create buffer");return{context:o,selectedShapes:Tn(o,1024),unselectedShapes:Tn(o,4096),viewport:Tn(o,Tl),collaborators:Tn(o,1024),prepareTriangles(u,f){o.bindBuffer(o.ARRAY_BUFFER,u.buffer),o.bufferData(o.ARRAY_BUFFER,u.vertices,o.STATIC_DRAW,0,f),o.enableVertexAttribArray(l),o.vertexAttribPointer(l,2,o.FLOAT,!1,0,0)},drawTrianglesTransparently(u){o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.drawArrays(o.TRIANGLES,0,u/2),o.disable(o.BLEND)},drawTriangles(u){o.drawArrays(o.TRIANGLES,0,u/2)},setFillColor(u){o.uniform4fv(c,u)},setCanvasPageBounds(u){o.uniform4fv(d,u)}}}function Tn(t,o){const e=t.createBuffer();if(!e)throw new Error("Failed to create buffer");return{buffer:e,vertices:new Float32Array(o)}}function or(t,o,e){let n=t.vertices.length;for(;n<o+e.length;)n*=2;if(n!=t.vertices.length){const s=new Float32Array(n);s.set(t.vertices),t.vertices=s}t.vertices.set(e,o)}var am=Object.defineProperty,lm=Object.getOwnPropertyDescriptor,rt=(t,o,e,n)=>{for(var s=lm(o,e),i=t.length-1,a;i>=0;i--)(a=t[i])&&(s=a(o,e,s)||s);return s&&am(o,e,s),s};class Ye{constructor(o,e){h(this,"disposables",[]);h(this,"close",()=>this.disposables.forEach(o=>o()));h(this,"gl");h(this,"shapeGeometryCache");h(this,"colors");h(this,"id",Ae());h(this,"canvasBoundingClientRect",Bc("canvasBoundingClientRect",new Z));h(this,"originPagePoint",new m);h(this,"originPageCenter",new m);h(this,"isInViewport",!1);h(this,"getMinimapPagePoint",(o,e)=>{const n=this.getCanvasPageBounds(),s=this.getCanvasScreenBounds();let i=o-s.x,a=e-s.y;return i*=n.width/s.width,a*=n.height/s.height,i+=n.minX,a+=n.minY,new m(i,a,1)});h(this,"minimapScreenPointToPagePoint",(o,e,n=!1,s=!1)=>{const{editor:i}=this,a=i.getViewportPageBounds();let{x:l,y:d}=this.getMinimapPagePoint(o,e);if(s){const c=this.editor.getCurrentPageBounds()??new Z,p=a,g=c.minX-p.width/2,u=c.maxX+p.width/2,f=c.minY-p.height/2,x=c.maxY+p.height/2,S=Math.max(0,g+p.width-l),v=Math.max(0,-(u-p.width-l)),b=Math.max(0,f+p.height-d),w=Math.max(0,-(x-p.height-d)),E=Math.max(0,S-v),C=Math.max(0,v-S),y=Math.max(0,b-w),P=Math.max(0,w-b);E&&E>C?l+=E/2:C&&(l-=C/2),y&&y>P?d+=y/2:P&&(d-=P/2),l=co(l,g,u),d=co(d,f,x)}if(n){const{originPagePoint:c}=this,p=Math.abs(l-c.x),g=Math.abs(d-c.y);p>g?d=c.y:l=c.x}return new m(l,d)});h(this,"render",()=>{const o=this.gl.context,e=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=e.x,this.elem.height=e.y,o.viewport(0,0,e.x,e.y),o.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),o.clear(o.COLOR_BUFFER_BIT);const n=new Set(this.editor.getSelectedShapeIds()),s=this.colors;let i=0,a=0;const l=this.editor.getCurrentPageShapeIdsSorted();for(let d=0,c=l.length;d<c;d++){const p=l[d],g=this.shapeGeometryCache.get(p);if(!g)continue;const u=g.length;n.has(p)?(or(this.gl.selectedShapes,i,g),i+=u):(or(this.gl.unselectedShapes,a,g),a+=u)}this.drawShapes(this.gl.unselectedShapes,a,s.shapeFill),this.drawShapes(this.gl.selectedShapes,i,s.selectFill),this.drawViewport(),this.drawCollaborators()});this.editor=o,this.elem=e,this.gl=rm(e),this.shapeGeometryCache=o.store.createComputedCache("webgl-geometry",n=>{const s=o.getShapeMaskedPageBounds(n.id);if(!s)return null;const i=new Float32Array(12);return jt(i,0,s.x,s.y,s.w,s.h),i}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Sr("minimap render",this.render))}_getColors(){const o=getComputedStyle(this.editor.getContainer());return{shapeFill:Xt(o.getPropertyValue("--color-text-3").trim()),selectFill:Xt(o.getPropertyValue("--color-selected").trim()),viewportFill:Xt(o.getPropertyValue("--color-muted-1").trim()),background:Xt(o.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const o=this.editor.getViewportPageBounds(),e=this.editor.getCurrentPageBounds();return e?Z.Expand(e,o):o}getContentScreenBounds(){const o=this.getContentPageBounds(),e=this.editor.pageToScreen(o.point),n=this.editor.pageToScreen(new m(o.maxX,o.maxY));return new Z(e.x,e.y,n.x-e.x,n.y-e.y)}_getCanvasBoundingRect(){const{x:o,y:e,width:n,height:s}=this.elem.getBoundingClientRect();return new Z(o,e,n,s)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const o=new ResizeObserver(()=>{const e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)});return o.observe(this.elem),()=>o.disconnect()}getCanvasSize(){const o=this.canvasBoundingClientRect.get(),e=this.getDpr();return new m(o.width*e,o.height*e)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const o=this.getCanvasScreenBounds(),e=this.getContentPageBounds(),n=o.width/o.height;let s=e.width,i=s/n;i<e.height&&(i=e.height,s=i*n);const a=new Z(0,0,s,i);return a.center=e.center,a}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:o,y:e,w:n,h:s}=this.getCanvasPageBounds();return new Float32Array([o,e,n,s])}drawShapes(o,e,n){this.gl.prepareTriangles(o,e),this.gl.setFillColor(n),this.gl.drawTriangles(e)}drawViewport(){const o=this.editor.getViewportPageBounds(),e=im(this.gl.viewport.vertices,o,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,e),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(e)}drawCollaborators(){const o=this.editor.getCollaboratorsOnCurrentPage();if(!o.length)return;const e=20,n=e*6,s=n*o.length;this.gl.collaborators.vertices.length<s&&(this.gl.collaborators.vertices=new Float32Array(s));const i=this.gl.collaborators.vertices;let a=0;const l=this.getZoom();for(const{cursor:d}of o)Ct(i,{center:m.From(d),radius:3*l,offset:a,numArcSegments:e}),a+=n;this.gl.prepareTriangles(this.gl.collaborators,s),a=0;for(const{color:d}of o)this.gl.setFillColor(Xt(d)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,a/2,n/2),a+=n}}rt([st],Ye.prototype,"getDpr");rt([st],Ye.prototype,"getContentPageBounds");rt([st],Ye.prototype,"getContentScreenBounds");rt([st],Ye.prototype,"getCanvasSize");rt([st],Ye.prototype,"getCanvasClientPosition");rt([st],Ye.prototype,"getCanvasPageBounds");rt([st],Ye.prototype,"getZoom");rt([st],Ye.prototype,"getCanvasPageBoundsArray");function cm(){const t=A(),o=k.useRef(null),e=k.useRef(!1),n=k.useRef();k.useEffect(()=>{const c=new Ye(t,o.current);return n.current=c,n.current.close},[t]);const s=k.useCallback(c=>{if(!t.getCurrentPageShapeIds().size||!n.current)return;const p=n.current.minimapScreenPointToPagePoint(c.clientX,c.clientY,!1,!1),g=n.current.minimapScreenPointToPagePoint(c.clientX,c.clientY,!1,!0);n.current.originPagePoint.setTo(g),n.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(p,{duration:Be})},[t]),i=k.useCallback(c=>{if(!n.current)return;const p=c.currentTarget;if(br(p,c),!t.getCurrentPageShapeIds().size)return;e.current=!0,n.current.isInViewport=!1;const g=n.current.minimapScreenPointToPagePoint(c.clientX,c.clientY,!1,!1),u=n.current.minimapScreenPointToPagePoint(c.clientX,c.clientY,!1,!0),f=t.getViewportPageBounds();if(n.current.isInViewport=f.containsPoint(u),n.current.isInViewport)n.current.originPagePoint.setTo(u),n.current.originPageCenter.setTo(f.center);else{const S=m.Sub(f.center,f.point),v=m.Add(g,S);n.current.originPagePoint.setTo(v),n.current.originPageCenter.setTo(g),t.centerOnPoint(g,{duration:Be})}function x(S){p&&wr(p,S),e.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[t]),a=k.useCallback(c=>{if(!n.current)return;const p=n.current.minimapScreenPointToPagePoint(c.clientX,c.clientY,c.shiftKey,!0);if(e.current){if(n.current.isInViewport){const x=n.current.originPagePoint.clone().sub(n.current.originPageCenter);t.centerOnPoint(m.Sub(p,x));return}t.centerOnPoint(p)}const g=n.current.getMinimapPagePoint(c.clientX,c.clientY),u=t.pageToScreen(g),f={type:"pointer",target:"canvas",name:"pointer_move",...zs(c),point:u,isPen:t.getInstanceState().isPenMode};t.dispatch(f)},[t]),l=k.useCallback(c=>{const p=Uc(c);t.dispatch({type:"wheel",name:"wheel",delta:p,point:new m(c.clientX,c.clientY),shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey})},[t]),d=Ds();return k.useEffect(()=>{setTimeout(()=>{var c,p;(c=n.current)==null||c.updateColors(),(p=n.current)==null||p.render()})},[d]),r.jsx("div",{className:"tlui-minimap",children:r.jsx("canvas",{role:"img","aria-label":"minimap",ref:o,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:a,onPointerDown:i,onWheel:l})})}function dm(t,o){const[e,n]=fe.useState(o);fe.useLayoutEffect(()=>{const i=Hc(t);if(i)try{n(JSON.parse(i))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const s=fe.useCallback(i=>{n(a=>{const l=typeof i=="function"?i(a):i;return Wc(t,JSON.stringify(l)),l})},[t]);return[e,s]}const hm=k.memo(function(){const o=F(),e=V(),n=xe(),[s,i]=dm("minimap",!0),a=k.useCallback(()=>{i(c=>!c)},[i]),{ZoomMenu:l,Minimap:d}=at();return n<oe.MOBILE?null:r.jsxs("div",{className:"tlui-navigation-panel",children:[r.jsx("div",{className:"tlui-buttons__horizontal",children:l&&n<oe.TABLET?r.jsx(l,{}):s?r.jsxs(r.Fragment,{children:[l&&r.jsx(l,{}),d&&r.jsx(B,{type:"icon","data-testid":"minimap.toggle-button",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:r.jsx(G,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):r.jsxs(r.Fragment,{children:[r.jsx(B,{type:"icon","data-testid":"minimap.zoom-out",title:`${e(pn(o["zoom-out"].label))} ${Ms(o["zoom-out"].kbd)}`,onClick:()=>o["zoom-out"].onSelect("navigation-zone"),children:r.jsx(G,{icon:"minus"})}),l&&r.jsx(l,{}),r.jsx(B,{type:"icon","data-testid":"minimap.zoom-in",title:`${e(pn(o["zoom-in"].label))} ${Ms(o["zoom-in"].kbd)}`,onClick:()=>o["zoom-in"].onSelect("navigation-zone"),children:r.jsx(G,{icon:"plus"})}),d&&r.jsx(B,{type:"icon","data-testid":"minimap.toggle-button",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:r.jsx(G,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),d&&n>=oe.TABLET&&!s&&r.jsx(d,{})]})}),pm=function({name:o,id:e,isCurrentPage:n}){const s=A(),i=k.useRef(null),a=k.useCallback(d=>{s.renamePage(e,d||"New Page",{ephemeral:!0})},[s,e]),l=k.useCallback(d=>{s.mark("rename page"),s.renamePage(e,d||"New Page",{ephemeral:!1})},[s,e]);return r.jsx(ti,{className:"tlui-page-menu__item__input",ref:d=>i.current=d,defaultValue:o,onValueChange:a,onComplete:l,onCancel:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:n,autoselect:!0})},As=(t,o,e,n)=>{let s;const i=t.getPages(),a=e>n?i[n-1]:i[n],l=e>n?i[n]:i[n+1];a&&!l?s=$s(a.index):!a&&l?s=Gc(i[0].index):s=mr(a.index,l.index),s!==i[e].index&&(t.mark("moving page"),t.updatePage({id:o,index:s}))},sr=Ke(function({index:o,listSize:e,item:n,onRename:s}){const i=A(),a=V(),l=i.getPages(),d=k.useCallback(()=>{i.mark("creating page");const u=bo.createId();i.duplicatePage(n.id,u)},[i,n]),c=k.useCallback(()=>{As(i,n.id,o,o-1)},[i,n,o]),p=k.useCallback(()=>{As(i,n.id,o,o+1)},[i,n,o]),g=k.useCallback(()=>{i.mark("deleting page"),i.deletePage(n.id)},[i,n]);return r.jsxs(xt,{id:`page item submenu ${o}`,children:[r.jsx(St,{children:r.jsx(B,{type:"icon",title:a("page-menu.submenu.title"),children:r.jsx(G,{icon:"dots-vertical"})})}),r.jsx(yt,{alignOffset:0,side:"right",sideOffset:-4,children:r.jsxs(Ie,{type:"menu",sourceId:"page-menu",children:[r.jsxs(U,{id:"modify",children:[s&&r.jsx(I,{id:"rename",label:"page-menu.submenu.rename",onSelect:s}),r.jsx(I,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:l.length>=vr}),o>0&&r.jsx(I,{id:"move-up",onSelect:c,label:"page-menu.submenu.move-up"}),o<e-1&&r.jsx(I,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:p})]}),e>1&&r.jsx(U,{id:"delete",children:r.jsx(I,{id:"delete",onSelect:g,label:"page-menu.submenu.delete"})})]})})]})}),um=k.memo(function(){const o=A(),e=V(),n=xe(),s=k.useCallback(()=>v(!1),[]),[i,a]=it("page-menu",s),l=36,d=k.useRef(null),c=L("pages",()=>o.getPages(),[o]),p=L("currentPage",()=>o.getCurrentPage(),[o]),g=L("currentPageId",()=>o.getCurrentPageId(),[o]),u=Ve(),f=L("maxPageCountReached",()=>o.getPages().length>=vr,[o]),x=L("isCoarsePointer",()=>o.getInstanceState().isCoarsePointer,[o]),[S,v]=k.useState(!1),b=k.useCallback(()=>{u||v(M=>!M)},[u]),w=k.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[E,C]=k.useState(Object.fromEntries(c.map((M,$)=>[M.id,{y:$*l,offsetY:0,isSelected:!1}])));k.useLayoutEffect(()=>{C(Object.fromEntries(c.map((M,$)=>[M.id,{y:$*l,offsetY:0,isSelected:!1}])))},[l,c]),k.useEffect(()=>{i&&requestAnimationFrame(()=>{const M=document.querySelector(`[data-testid="page-menu-item-${g}"]`);if(M){const $=d.current;if(!$)return;const z=M.offsetTop,O=$.scrollTop;z<O&&$.scrollTo({top:z});const W=z+l,R=$.scrollTop+$.offsetHeight;W>R&&$.scrollTo({top:W-$.offsetHeight})}})},[l,g,i]);const y=k.useCallback(M=>{const{clientY:$,currentTarget:z}=M,{dataset:{id:O,index:W}}=z;if(!O||!W)return;const R=w.current;br(M.currentTarget,M),R.status="pointing",R.pointing={id:O,index:+W};const Q=E[O].y;R.startY=$,R.startIndex=Math.max(0,Math.min(Math.round(Q/l),c.length-1))},[l,c.length,E]),P=k.useCallback(M=>{const $=w.current;if($.status==="pointing"){const{clientY:z}=M,O=z-$.startY;Math.abs(O)>5&&($.status="dragging")}if($.status==="dragging"){const{clientY:z}=M,O=z-$.startY,W=E[$.pointing.id],{startIndex:R,pointing:X}=$,Q=W.y+O,Se=Math.max(0,Math.min(Math.round(Q/l),c.length-1)),we={...E};if(we[X.id]={y:W.y,offsetY:O,isSelected:!0},Se!==$.dragIndex){$.dragIndex=Se;for(let te=0;te<c.length;te++){const pe=c[te];if(pe.id===$.pointing.id)continue;let{y:Le}=we[pe.id];Se===R?Le=te*l:Se<R?Se<=te&&te<R?Le=(te+1)*l:Le=te*l:Se>R&&(Se>=te&&te>R?Le=(te-1)*l:Le=te*l),Le!==we[pe.id].y&&(we[pe.id]={y:Le,offsetY:0,isSelected:!0})}}C(we)}},[l,c,E]),T=k.useCallback(M=>{const $=w.current;if($.status==="dragging"){const{id:z,index:O}=$.pointing;As(o,z,O,$.dragIndex)}wr(M.currentTarget,M),$.status="idle"},[o]),_=k.useCallback(M=>{const $=w.current;M.key==="Escape"&&($.status==="dragging"&&C(Object.fromEntries(c.map((z,O)=>[z.id,{y:O*l,offsetY:0,isSelected:!1}]))),$.status="idle")},[l,c]),D=k.useCallback(()=>{u||o.batch(()=>{o.mark("creating page");const M=bo.createId();o.createPage({name:e("page-menu.new-page-initial-name"),id:M}),o.setCurrentPage(M),v(!0)})},[o,e,u]);return r.jsxs(ni,{id:"pages",onOpenChange:a,open:i,children:[r.jsx(oi,{"data-testid":"main.page-menu",children:r.jsxs(B,{type:"menu",title:p.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[r.jsx("div",{className:"tlui-page-menu__name",children:p.name}),r.jsx(G,{icon:"chevron-down",small:!0})]})}),r.jsx(si,{side:"bottom",align:"start",sideOffset:6,children:r.jsxs("div",{className:"tlui-page-menu__wrapper",children:[r.jsxs("div",{className:"tlui-page-menu__header",children:[r.jsx("div",{className:"tlui-page-menu__header__title",children:e("page-menu.title")}),!u&&r.jsxs("div",{className:"tlui-buttons__horizontal",children:[r.jsx(B,{type:"icon","data-testid":"page-menu.edit",title:e(S?"page-menu.edit-done":"page-menu.edit-start"),onClick:b,children:r.jsx(G,{icon:S?"check":"edit"})}),r.jsx(B,{type:"icon","data-testid":"page-menu.create",title:e(f?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:f,onClick:D,children:r.jsx(G,{icon:"plus"})})]})]}),r.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*c.length+4},ref:d,children:c.map((M,$)=>{const z=E[M.id]??{offsetY:0};return S?r.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:M.id===p.id?888:$,transform:`translate(0px, ${z.y+z.offsetY}px)`},children:[r.jsx(B,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:y,onPointerUp:T,onPointerMove:P,onKeyDown:_,"data-id":M.id,"data-index":$,children:r.jsx(G,{icon:"drag-handle-dots"})}),n<oe.TABLET_SM&&x?r.jsxs(B,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const O=window.prompt("Rename page",M.name);O&&O!==M.name&&o.renamePage(M.id,O)},onDoubleClick:b,children:[r.jsx(_s,{checked:M.id===p.id}),r.jsx(se,{children:M.name})]}):r.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:r.jsx(pm,{id:M.id,name:M.name,isCurrentPage:M.id===p.id})}),!u&&r.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":S,children:r.jsx(sr,{index:$,item:M,listSize:c.length})})]},M.id+"_editing"):r.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[r.jsxs(B,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>o.setCurrentPage(M.id),onDoubleClick:b,title:e("page-menu.go-to-page"),children:[r.jsx(_s,{checked:M.id===p.id}),r.jsx(se,{children:M.name})]}),!u&&r.jsx("div",{className:"tlui-page_menu__item__submenu",children:r.jsx(sr,{index:$,item:M,listSize:c.length,onRename:()=>{if(o.environment.isIos){const O=window.prompt("Rename page",M.name);O&&O!==M.name&&o.renamePage(M.id,O)}else o.batch(()=>{v(!0),o.setCurrentPage(M.id)})}})})]},M.id)})})]})})]})});function gm(){const t=F(),o=A(),e=Dr(),n=$r(),s=me(1),i=Ve(),a=L("should display quick actions",()=>o.isInAny("select","hand","zoom"),[o]);if(!(i&&!a))return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t.undo,disabled:!e}),r.jsx(I,{...t.redo,disabled:!n}),r.jsx(I,{...t.delete,disabled:!s}),r.jsx(I,{...t.duplicate,disabled:!s})]})}const fm=k.memo(function({children:o}){const e=o??r.jsx(gm,{});return r.jsx(Ie,{type:"small-icons",sourceId:"quick-actions",children:e})}),mm=Object.freeze([Ot,ds,hs,ps]);function El(t=mm){const o=A();return L("getRelevantStyles",()=>{var i;const e=new Kc(o.getSharedStyles()),n=!!((i=o.root.getCurrent())!=null&&i.shapeType),s=o.isIn("select")&&o.getSelectedShapeIds().length>0;if(e.size===0&&o.isIn("select")&&o.getSelectedShapeIds().length===0)for(const a of t)e.applyValue(a,o.getStyleForNextShape(a));return n||s||e.size>0?e:null},[o])}const $e={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]};function xm(t){const{uiType:o,items:e,title:n,style:s,value:i,onValueChange:a,theme:l}=t,d=A(),c=V(),p=k.useRef(!1),{handleButtonClick:g,handleButtonPointerDown:u,handleButtonPointerEnter:f,handleButtonPointerUp:x}=k.useMemo(()=>{const S=()=>{p.current=!1,window.removeEventListener("pointerup",S)};return{handleButtonClick:C=>{const{id:y}=C.currentTarget.dataset;i.type==="shared"&&i.value===y||(d.mark("point picker item"),a(s,y,!1))},handleButtonPointerDown:C=>{const{id:y}=C.currentTarget.dataset;d.mark("point picker item"),a(s,y,!0),p.current=!0,window.addEventListener("pointerup",S)},handleButtonPointerEnter:C=>{if(!p.current)return;const{id:y}=C.currentTarget.dataset;a(s,y,!0)},handleButtonPointerUp:C=>{const{id:y}=C.currentTarget.dataset;i.type==="shared"&&i.value===y||a(s,y,!1)}}},[i,d,a,s]);return r.jsx("div",{"data-testid":`style.${o}`,className:H("tlui-buttons__grid"),children:e.map(S=>r.jsx(B,{type:"icon","data-id":S.value,"data-testid":`style.${o}.${S.value}`,"aria-label":S.value,"data-state":i.type==="shared"&&i.value===S.value?"hinted":void 0,title:n+" — "+c(`${o}-style.${S.value}`),className:H("tlui-button-grid__button"),style:s===Ot?{color:l[S.value].solid}:void 0,onPointerEnter:f,onPointerDown:u,onPointerUp:x,onClick:g,children:r.jsx(G,{icon:S.icon})},S.value))})}const Mt=k.memo(xm),Sm=k.memo(function(o){const{title:e,steps:n,value:s,label:i,onValueChange:a}=o,l=A(),d=V(),c=k.useCallback(u=>{a(u[0],!0)},[a]),p=k.useCallback(()=>{l.mark("click slider")},[l]),g=k.useCallback(()=>{s&&a(s,!1)},[s,a]);return r.jsx("div",{className:"tlui-slider__container",children:r.jsxs($d,{"data-testid":o["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:s?[s]:void 0,onPointerDown:p,onValueChange:c,onPointerUp:g,title:e+" — "+d(i),children:[r.jsx(Dd,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&r.jsx(Ld,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&r.jsx(zd,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function ym({label:t,uiTypeA:o,uiTypeB:e,labelA:n,labelB:s,itemsA:i,itemsB:a,styleA:l,styleB:d,valueA:c,valueB:p,onValueChange:g}){const u=V(),f=k.useMemo(()=>{var S;return((S=i.find(v=>c.type==="shared"&&c.value===v.value))==null?void 0:S.icon)??"mixed"},[i,c]),x=k.useMemo(()=>{var S;return((S=a.find(v=>p.type==="shared"&&p.value===v.value))==null?void 0:S.icon)??"mixed"},[a,p]);return c===void 0&&p===void 0?null:r.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[r.jsx("div",{title:u(t),className:"tlui-style-panel__double-select-picker-label",children:u(t)}),r.jsxs("div",{className:"tlui-buttons__horizontal",children:[r.jsxs(xt,{id:`style panel ${o} A`,children:[r.jsx(St,{children:r.jsx(B,{type:"icon","data-testid":`style.${o}`,title:u(n)+" — "+(c===null||c.type==="mixed"?u("style-panel.mixed"):u(`${o}-style.${c.value}`)),children:r.jsx(G,{icon:f,small:!0,invertIcon:!0})})}),r.jsx(yt,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:r.jsx("div",{className:"tlui-buttons__grid",children:i.map((S,v)=>r.jsx(un,{"data-testid":`style.${o}.${S.value}`,children:r.jsx(B,{type:"icon",onClick:()=>g(l,S.value,!1),title:`${u(n)} — ${u(`${o}-style.${S.value}`)}`,children:r.jsx(G,{icon:S.icon,invertIcon:!0})},S.value)},v))})})]}),r.jsxs(xt,{id:`style panel ${e}`,children:[r.jsx(St,{children:r.jsx(B,{type:"icon","data-testid":`style.${e}`,title:u(s)+" — "+(p===null||p.type==="mixed"?u("style-panel.mixed"):u(`${e}-style.${p.value}`)),children:r.jsx(G,{icon:x,small:!0})})}),r.jsx(yt,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:r.jsx("div",{className:"tlui-buttons__grid",children:a.map(S=>r.jsx(un,{children:r.jsx(B,{type:"icon",title:`${u(s)} — ${u(`${e}-style.${S.value}`)}`,"data-testid":`style.${e}.${S.value}`,onClick:()=>g(d,S.value,!1),children:r.jsx(G,{icon:S.icon})})},S.value))})})]})]})]})}const bm=k.memo(ym);function wm({id:t,label:o,uiType:e,style:n,items:s,type:i,value:a,onValueChange:l}){const d=V(),c=A(),p=k.useMemo(()=>{var f;return(f=s.find(x=>a.type==="shared"&&x.value===a.value))==null?void 0:f.icon},[s,a]),g=a.type==="mixed"?d("style-panel.mixed"):d(`${e}-style.${a.value}`),u=o?d(o):"";return r.jsxs(xt,{id:`style panel ${t}`,children:[r.jsx(St,{children:r.jsxs(B,{type:i,"data-testid":`style.${e}`,title:g,children:[r.jsx(se,{children:u}),r.jsx(G,{icon:p??"mixed"})]})}),r.jsx(yt,{side:"left",align:"center",alignOffset:0,children:r.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>r.jsx(un,{children:r.jsx(B,{type:"icon","data-testid":`style.${e}.${f.value}`,title:d(`${e}-style.${f.value}`),onClick:()=>{c.mark("select style dropdown item"),l(n,f.value,!1)},children:r.jsx(G,{icon:f.icon})})},f.value))})})]})}const ri=k.memo(wm);function vm({styles:t}){const o=Ds();if(!t)return null;const e=t.get(Ue),n=t.get(us),s=t.get(gs),i=t.get(fs),a=t.get(Lt),l=e===void 0,d=n===void 0&&s===void 0,c=i===void 0,p=a===void 0,g=tt({isDarkMode:o});return r.jsxs(r.Fragment,{children:[r.jsx(km,{theme:g,styles:t}),!p&&r.jsx(Pm,{theme:g,styles:t}),!(l&&d&&c)&&r.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[r.jsx(Cm,{styles:t}),r.jsx(Im,{styles:t}),r.jsx(jm,{styles:t})]})]})}function fn(){const t=A(),o=Ne();return fe.useMemo(()=>function(n,s,i){t.batch(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(n,s,{squashing:i}),t.setStyleForNextShapes(n,s,{squashing:i}),t.updateInstanceState({isChangingStyle:!0},{ephemeral:!0})}),o("set-style",{source:"style-panel",id:n.id,value:s})},[t,o])}function km({styles:t,theme:o}){const e=V(),n=A(),s=fn(),i=t.get(Ot),a=t.get(hs),l=t.get(ds),d=t.get(ps),c=a!==void 0||l!==void 0||d!==void 0;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[i===void 0?null:r.jsx(Mt,{title:e("style-panel.color"),uiType:"color",style:Ot,items:$e.color,value:i,onValueChange:s,theme:o}),r.jsx(Tm,{})]}),c&&r.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:r.jsx(Mt,{title:e("style-panel.fill"),uiType:"fill",style:hs,items:$e.fill,value:a,onValueChange:s,theme:o}),l===void 0?null:r.jsx(Mt,{title:e("style-panel.dash"),uiType:"dash",style:ds,items:$e.dash,value:l,onValueChange:s,theme:o}),d===void 0?null:r.jsx(Mt,{title:e("style-panel.size"),uiType:"size",style:ps,items:$e.size,value:d,onValueChange:(p,g,u)=>{s(p,g,u);const f=n.getSelectedShapeIds();f.length>0&&J(n,f)},theme:o})]})]})}function Pm({theme:t,styles:o}){const e=V(),n=fn(),s=o.get(Lt),i=o.get(gi),a=o.get(fi);return s===void 0&&i===void 0?null:r.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[s===void 0?null:r.jsx(Mt,{title:e("style-panel.font"),uiType:"font",style:Lt,items:$e.font,value:s,onValueChange:n,theme:t}),i===void 0?null:r.jsxs("div",{className:"tlui-style-panel__row",children:[r.jsx(Mt,{title:e("style-panel.align"),uiType:"align",style:gi,items:$e.horizontalAlign,value:i,onValueChange:n,theme:t}),r.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a===void 0?r.jsx(B,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:r.jsx(G,{icon:"vertical-align-center"})}):r.jsx(ri,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:fi,items:$e.verticalAlign,value:a,onValueChange:n})})]})]})}function Cm({styles:t}){const o=fn(),e=t.get(Ue);return e===void 0?null:r.jsx(ri,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Ue,items:$e.geo,value:e,onValueChange:o})}function jm({styles:t}){const o=fn(),e=t.get(fs);return e===void 0?null:r.jsx(ri,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:fs,items:$e.spline,value:e,onValueChange:o})}function Im({styles:t}){const o=fn(),e=t.get(us),n=t.get(gs);return!e||!n?null:r.jsx(bm,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:gs,itemsA:$e.arrowheadStart,valueA:n,uiTypeB:"arrowheadEnd",styleB:us,itemsB:$e.arrowheadEnd,valueB:e,onValueChange:o,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Jt=[.1,.25,.5,.75,1];function Tm(){const t=A(),o=L("opacity",()=>t.getSharedOpacity(),[t]),e=Ne(),n=V(),s=fe.useCallback((a,l)=>{const d=Jt[a];t.batch(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(d,{squashing:l}),t.setOpacityForNextShapes(d,{squashing:l}),t.updateInstanceState({isChangingStyle:!0},{ephemeral:!0})}),e("set-style",{source:"style-panel",id:"opacity",value:a})},[t,e]);if(o===void 0)return null;const i=o.type==="mixed"?-1:Jt.indexOf(Vc(Jt,a=>Math.abs(a-o.value)));return r.jsx(Sm,{"data-testid":"style.opacity",value:i>=0?i:Jt.length-1,label:o.type==="mixed"?"style-panel.mixed":`opacity-style.${o.value}`,onValueChange:s,steps:Jt.length-1,title:n("style-panel.opacity")})}const Em=k.memo(function({isMobile:o,children:e}){const n=A(),s=El(),i=k.useCallback(()=>{o||n.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},[n,o]),a=e??r.jsx(vm,{styles:s});return r.jsx("div",{className:H("tlui-style-panel",{"tlui-style-panel__wrapper":!o}),"data-ismobile":o,onPointerLeave:i,children:a})});function Mm(){const t=A(),o=V(),e=El(),n=e==null?void 0:e.get(Ot),s=tt({isDarkMode:t.user.getIsDarkMode()}),i=((n==null?void 0:n.type)==="shared"?s[n.value]:s.black).solid,a=L("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),l=k.useCallback(c=>{c||t.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},[t]),{StylePanel:d}=at();return d?r.jsxs(ni,{id:"mobile style menu",onOpenChange:l,children:[r.jsx(oi,{children:r.jsx(B,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":i},title:o("style-panel.title"),disabled:a,children:r.jsx(G,{icon:a?"blob":(n==null?void 0:n.type)==="mixed"?"mixed":"blob"})})}),r.jsx(si,{side:"top",align:"end",children:d&&r.jsx(d,{isMobile:!0})})]}):null}function _m(){return r.jsxs(r.Fragment,{children:[r.jsx(Am,{}),r.jsx($m,{}),r.jsx(Dm,{}),r.jsx(Lm,{}),r.jsx(zm,{}),r.jsx(Om,{}),r.jsx(Fm,{}),r.jsx(Rm,{}),r.jsx(Nm,{}),r.jsx(Bm,{}),r.jsx(Um,{}),r.jsx(Hm,{}),r.jsx(Wm,{}),r.jsx(Gm,{}),r.jsx(Km,{}),r.jsx(Vm,{}),r.jsx(Ym,{}),r.jsx(Zm,{}),r.jsx(qm,{}),r.jsx(Xm,{}),r.jsx(Jm,{}),r.jsx(Qm,{}),r.jsx(ex,{}),r.jsx(tx,{}),r.jsx(nx,{}),r.jsx(ox,{}),r.jsx(sx,{}),r.jsx(ix,{})]})}function q(t){var n;const o=A(),e=(n=t.meta)==null?void 0:n.geo;return L("is tool selected",()=>{const s=o.getCurrentToolId(),i=o.getSharedStyles().getAsKnownValue(Ue);return e?s==="geo"&&i===e:s===t.id},[o,t.id,e])}function Am(){const t=Y(),o=q(t.select);return r.jsx(I,{...t.select,isSelected:o})}function $m(){const t=Y(),o=q(t.hand);return r.jsx(I,{...t.hand,isSelected:o})}function Dm(){const t=Y(),o=q(t.draw);return r.jsx(I,{...t.draw,isSelected:o})}function Lm(){const t=Y(),o=q(t.eraser);return r.jsx(I,{...t.eraser,isSelected:o})}function zm(){const t=Y(),o=q(t.arrow);return r.jsx(I,{...t.arrow,isSelected:o})}function Om(){const t=Y(),o=q(t.text);return r.jsx(I,{...t.text,isSelected:o})}function Fm(){const t=Y(),o=q(t.note);return r.jsx(I,{...t.note,isSelected:o})}function Rm(){const t=Y(),o=q(t.asset);return r.jsx(I,{...t.asset,isSelected:o})}function Nm(){const t=Y(),o=q(t.rectangle);return r.jsx(I,{...t.rectangle,isSelected:o})}function Bm(){const t=Y(),o=q(t.ellipse);return r.jsx(I,{...t.ellipse,isSelected:o})}function Um(){const t=Y(),o=q(t.diamond);return r.jsx(I,{...t.diamond,isSelected:o})}function Hm(){const t=Y(),o=q(t.triangle);return r.jsx(I,{...t.triangle,isSelected:o})}function Wm(){const t=Y(),o=q(t.trapezoid);return r.jsx(I,{...t.trapezoid,isSelected:o})}function Gm(){const t=Y(),o=q(t.rhombus);return r.jsx(I,{...t.rhombus,isSelected:o})}function Km(){const t=Y(),o=q(t.hexagon);return r.jsx(I,{...t.hexagon,isSelected:o})}function Vm(){const t=Y(),o=q(t.cloud);return r.jsx(I,{...t.cloud,isSelected:o})}function Ym(){const t=Y(),o=q(t.star);return r.jsx(I,{...t.star,isSelected:o})}function Zm(){const t=Y(),o=q(t.oval);return r.jsx(I,{...t.oval,isSelected:o})}function qm(){const t=Y(),o=q(t["x-box"]);return r.jsx(I,{...t["x-box"],isSelected:o})}function Xm(){const t=Y(),o=q(t["check-box"]);return r.jsx(I,{...t["check-box"],isSelected:o})}function Jm(){const t=Y(),o=q(t["arrow-left"]);return r.jsx(I,{...t["arrow-left"],isSelected:o})}function Qm(){const t=Y(),o=q(t["arrow-up"]);return r.jsx(I,{...t["arrow-up"],isSelected:o})}function ex(){const t=Y(),o=q(t["arrow-down"]);return r.jsx(I,{...t["arrow-down"],isSelected:o})}function tx(){const t=Y(),o=q(t["arrow-right"]);return r.jsx(I,{...t["arrow-right"],isSelected:o})}function nx(){const t=Y(),o=q(t.line);return r.jsx(I,{...t.line,isSelected:o})}function ox(){const t=Y(),o=q(t.highlight);return r.jsx(I,{...t.highlight,isSelected:o})}function sx(){const t=Y(),o=q(t.frame);return r.jsx(I,{...t.frame,isSelected:o})}function ix(){const t=Y(),o=q(t.laser);return r.jsx(I,{...t.laser,isSelected:o})}const ir=["copy","cut","paste","asset"];function rx(){const t=A(),o=Ve(),e=F(),n=Y(),s=L("is focused",()=>t.getInstanceState().isFocused,[t]);k.useEffect(()=>{if(!s)return;const i=t.getContainer();Tt.setScope(t.store.id);const a=(d,c)=>{Tt(d,{element:document.body,scope:t.store.id},c)},l=(d,c)=>{Tt(d,{element:document.body,keyup:!0,keydown:!1,scope:t.store.id},c)};for(const d of Object.values(e))d.kbd&&(o&&!d.readonlyOk||ir.includes(d.id)||a(rr(d.kbd),c=>{tn(t)||(de(c),d.onSelect("kbd"))}));for(const d of Object.values(n))!d.kbd||!d.readonlyOk&&t.getInstanceState().isReadonly||ir.includes(d.id)||a(rr(d.kbd),c=>{tn(t)||(de(c),d.onSelect("kbd"))});return a(",",d=>{if(tn(t)||t.inputs.keys.has("Comma"))return;de(d),i.focus(),t.inputs.keys.add("Comma");const{x:c,y:p,z:g}=t.inputs.currentScreenPoint,u={type:"pointer",name:"pointer_down",point:{x:c,y:p,z:g},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(u)}),l(",",d=>{if(tn(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:c,y:p,z:g}=t.inputs.currentScreenPoint,u={type:"pointer",name:"pointer_up",point:{x:c,y:p,z:g},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(u)}),()=>{Tt.deleteScope(t.store.id)}},[e,n,o,t,s])}function rr(t){return ax(t).map(o=>{let e="";const n=o.split("");return n.length===1?e=n[0]:n[0]==="!"?e=`shift+${n[1]}`:n[0]==="?"?n.length===3&&n[1]==="!"?e=`alt+shift+${n[2]}`:e=`alt+${n[1]}`:n[0]==="$"?n[1]==="!"?e=`cmd+shift+${n[2]},ctrl+shift+${n[2]}`:n[1]==="?"?e=`cmd+⌥+${n[2]},ctrl+alt+${n[2]}`:e=`cmd+${n[1]},ctrl+${n[1]}`:e=o,e}).join(",")}function ax(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const o=t.split(",");let e=o.lastIndexOf("");for(;e>=0;)o[e-1]+=",",o.splice(e,1),e=o.lastIndexOf("");return o}function tn(t){return t.getIsMenuOpen()||t.getEditingShapeId()!==null||t.getCrashingError()}const lx=k.createContext(!1);function cx({children:t}){const o=A(),e=Yc(),n=xe(),s=V(),i=Math.min(8,5+n),[a,l]=k.useState(0),d=k.useRef(null),[c,p]=k.useState(null),g=k.useMemo(()=>{const f=[],x=[];c?f.push(`[data-value="${c}"]`):f.push(`:nth-child(${i+1})`);for(let S=0;S<i;S++)f.push(`:nth-child(${S+1})`),x.push(`:nth-child(${S+1})`);return`
			#${e}_main > *:not(${f.join(", ")}) {
				display: none;
			}
			${x.map(S=>`#${e}_more > *${S}`).join(", ")} {
				display: none;
			}
        `},[c,e,i]),u=kr(()=>{if(!d.current)return;const f=Array.from(d.current.children);l(f.length),f.findIndex(v=>v.getAttribute("data-value")===c)<=i&&p(null);const S=Array.from(d.current.children).findIndex(v=>v.getAttribute("aria-checked")==="true");S!==-1&&S>=i&&p(f[S].getAttribute("data-value"))});return k.useLayoutEffect(()=>{u()}),k.useLayoutEffect(()=>{if(!d.current)return;const f=new MutationObserver(u);return f.observe(d.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[u]),k.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[x,S]of f)Tt(x,v=>{var E;if(tn(o))return;de(v);const w=Array.from(((E=d.current)==null?void 0:E.children)??[]).filter(C=>!(C instanceof HTMLElement)||C.tagName.toLowerCase()!=="button"?!1:!!(C.offsetWidth||C.offsetHeight))[S];w&&w.click()});return()=>{Tt.unbind("1,2,3,4,5,6,7,8,9,0")}},[o]),r.jsxs(r.Fragment,{children:[r.jsx("style",{children:g}),r.jsxs("div",{className:H("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<oe.TABLET_SM}),role:"radiogroup",children:[r.jsx("div",{id:`${e}_main`,ref:d,className:"tlui-toolbar__tools__list",children:r.jsx(Ie,{type:"toolbar",sourceId:"toolbar",children:t})}),a>i&&r.jsx(lx.Provider,{value:!0,children:r.jsxs(xt,{id:"toolbar overflow",modal:!1,children:[r.jsx(St,{children:r.jsx(B,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:r.jsx(G,{icon:"chevron-up"})})}),r.jsx(yt,{side:"top",align:"center",children:r.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${e}_more`,children:r.jsx(Ie,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})]})}const dx=["select","hand","draw","eraser","text","zoom","laser","highlight"];function hx({activeToolId:t}){const o=A(),e=xe(),n=V(),s=L("is tool locked",()=>o.getInstanceState().isToolLocked,[o]);return!t||dx.includes(t)?null:r.jsx(B,{type:"normal",title:n("action.toggle-tool-lock"),"data-testid":"tool-lock",className:H("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":e<oe.TABLET_SM}),onClick:()=>o.updateInstanceState({isToolLocked:!s}),children:r.jsx(G,{icon:s?"lock":"unlock",small:!0})})}const px=k.memo(function({children:o}){const e=A(),n=xe(),s=Ve(),i=L("current tool id",()=>e.getCurrentToolId(),[e]),{ActionsMenu:a,QuickActions:l}=at();return r.jsx("div",{className:"tlui-toolbar",children:r.jsxs("div",{className:"tlui-toolbar__inner",children:[r.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&r.jsxs("div",{className:"tlui-toolbar__extras",children:[n<oe.TABLET&&r.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[l&&r.jsx(l,{}),a&&r.jsx(a,{})]}),r.jsx(hx,{activeToolId:i})]}),r.jsx(cx,{children:o??r.jsx(_m,{})})]}),n<oe.TABLET_SM&&!s&&r.jsx("div",{className:"tlui-toolbar__tools",children:r.jsx(Mm,{})})]})})});function ux(){const t=F();return r.jsxs(r.Fragment,{children:[r.jsx(I,{...t["zoom-in"],noClose:!0}),r.jsx(I,{...t["zoom-out"],noClose:!0}),r.jsx(Sl,{}),r.jsx(yl,{}),r.jsx(bl,{})]})}const gx=k.memo(function({children:o}){const e=ot(),[n,s]=it("zoom menu"),i=o??r.jsx(ux,{});return r.jsxs(Bs,{dir:"ltr",open:n,onOpenChange:s,modal:!1,children:[r.jsx(Us,{asChild:!0,dir:"ltr",children:r.jsx(fx,{})}),r.jsx(wo,{container:e,children:r.jsx(Hs,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:r.jsx(Ie,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),fx=k.forwardRef(function(o,e){const n=A(),s=xe(),i=L("zoom",()=>n.getZoomLevel(),[n]),a=V(),l=k.useCallback(()=>{n.resetZoom(n.getViewportScreenCenter(),{duration:Be})},[n]);return r.jsx(B,{ref:e,...o,type:"icon",title:`${a("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:s<oe.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,icon:s<oe.MOBILE?"zoom-in":void 0,children:s<oe.MOBILE?null:r.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(i*100),"%"]})})}),Ml=k.createContext({});function mx({overrides:t={},children:o}){const e=Pr(t);return r.jsx(Ml.Provider,{value:k.useMemo(()=>({ContextMenu:If,ActionsMenu:nf,HelpMenu:Nf,ZoomMenu:gx,MainMenu:om,Minimap:cm,StylePanel:Em,PageMenu:um,NavigationPanel:hm,Toolbar:px,KeyboardShortcutsDialog:Vf,QuickActions:fm,HelperButtons:Gf,DebugPanel:Df,DebugMenu:$f,MenuPanel:sm,...e}),[e]),children:o})}function at(){return k.useContext(Ml)}function xx({overrides:t,components:o,assetUrls:e,onUiEvent:n,forceMobile:s,children:i}){return r.jsx(ru,{assetUrls:Zu(e),children:r.jsx(cu,{overrides:eg(t),children:r.jsx(Lu,{onEvent:n,children:r.jsx(Uu,{children:r.jsx(zu,{children:r.jsx(Xu,{forceMobile:s,children:r.jsx(mx,{overrides:o,children:r.jsx(Sx,{overrides:t,children:i})})})})})})})})}function Sx({overrides:t,children:o}){const e=tg(t);return r.jsx(zg,{overrides:e.actions,children:r.jsx(qu,{overrides:e.tools,children:o})})}function yx(){const t=A(),{addToast:o}=De();k.useEffect(()=>{function e({name:n,count:s}){o({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${n} (${s}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",e),()=>{t.removeListener("max-shapes",e)}},[t,o])}const bx=fe.memo(function({renderDebugMenuItems:o,children:e,hideUi:n,components:s,...i}){return r.jsx(xx,{...i,components:s,children:r.jsx(wx,{hideUi:n,renderDebugMenuItems:o,children:e})})}),wx=fe.memo(function({children:o,hideUi:e,...n}){return r.jsxs(r.Fragment,{children:[o,e?null:r.jsx(vx,{...n})]})}),vx=fe.memo(function(){const o=A(),e=V(),n=xe(),s=Ve(),i=L("focus",()=>o.getInstanceState().isFocusMode,[o]),a=L("debug",()=>o.getInstanceState().isDebugMode,[o]),{SharePanel:l,TopPanel:d,MenuPanel:c,StylePanel:p,Toolbar:g,HelpMenu:u,NavigationPanel:f,HelperButtons:x,DebugPanel:S}=at();rx(),Cg(),yx();const{"toggle-focus-mode":v}=F();return r.jsx(Od,{children:r.jsxs("div",{className:H("tlui-layout",{"tlui-layout__mobile":n<oe.TABLET_SM}),"data-breakpoint":n,children:[i?r.jsx("div",{className:"tlui-layout__top",children:r.jsx(B,{type:"icon",className:"tlui-focus-button",title:e("focus-mode.toggle-focus-mode"),onClick:()=>v.onSelect("menu"),children:r.jsx(G,{icon:"dot"})})}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"tlui-layout__top",children:[r.jsxs("div",{className:"tlui-layout__top__left",children:[c&&r.jsx(c,{}),x&&r.jsx(x,{})]}),r.jsx("div",{className:"tlui-layout__top__center",children:d&&r.jsx(d,{})}),r.jsxs("div",{className:"tlui-layout__top__right",children:[l&&r.jsx(l,{}),p&&n>=oe.TABLET_SM&&!s&&r.jsx(p,{})]})]}),r.jsxs("div",{className:"tlui-layout__bottom",children:[r.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&r.jsx(f,{}),g&&r.jsx(g,{}),u&&r.jsx(u,{})]}),a&&S&&r.jsx(S,{})]})]}),r.jsx(Ku,{}),r.jsx(Ru,{}),r.jsx(Vu,{}),r.jsx(Nu,{})]})})}),En=(t,o)=>{const[e,n]=k.useState(2);return k.useEffect(()=>{let s=!1;return n(2),Fd(t,o).then(()=>{s||n(0)}).catch(i=>{s||(console.error(i),n(1))}),()=>{s=!0}},[t,o]),e};function kx(t){return{draw:{url:t.fonts.draw,format:t.fonts.draw.split(".").pop()},serif:{url:t.fonts.serif,format:t.fonts.serif.split(".").pop()},sansSerif:{url:t.fonts.sansSerif,format:t.fonts.sansSerif.split(".").pop()},monospace:{url:t.fonts.monospace,format:t.fonts.monospace.split(".").pop()}}}function _l(t){const o=k.useMemo(()=>kx(t),[t]),e=[En("tldraw_draw",o.draw),En("tldraw_serif",o.serif),En("tldraw_sans",o.sansSerif),En("tldraw_mono",o.monospace)];return{error:e.some(n=>n===1),done:!e.some(n=>n===2)}}function rS(t){const{children:o,maxImageDimension:e,maxAssetSize:n,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i,onMount:a,components:l={},shapeUtils:d=[],tools:c=[],...p}=t,g=Pr(l),u=k.useMemo(()=>({Scribble:xi,CollaboratorScribble:xi,SelectionForeground:Xd,SelectionBackground:Zd,Handles:Wd,...g}),[g]),f=ms(d),x=k.useMemo(()=>[...Sa,...f],[f]),S=ms(c),v=k.useMemo(()=>[...Du,...zh,...S],[S]),b=Za(p.assetUrls),{done:w,error:E}=_l(b);return E?r.jsx(Cr,{children:"Could not load assets. Please refresh the page."}):w?r.jsx(Zc,{initialState:"select",...p,components:u,shapeUtils:x,tools:v,children:r.jsxs(bx,{...p,components:u,children:[r.jsx(jx,{maxImageDimension:e,maxAssetSize:n,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i,onMount:a}),o]})}):r.jsx(jr,{children:"Loading assets..."})}const Px=Object.freeze(["image/jpeg","image/png","image/gif","image/svg+xml"]),Cx=Object.freeze(["video/mp4","video/quicktime"]);function jx({maxImageDimension:t=1e3,maxAssetSize:o=10*1024*1024,acceptedImageMimeTypes:e=Px,acceptedVideoMimeTypes:n=Cx,onMount:s}){const i=A(),a=De(),l=V(),d=kr(g=>{const u=[];return u.push(...Su(g)),yh(g,{maxImageDimension:t,maxAssetSize:o,acceptedImageMimeTypes:e,acceptedVideoMimeTypes:n},{toasts:a,msg:l}),u.push(s==null?void 0:s(g)),()=>{u.forEach(f=>f==null?void 0:f())}});k.useLayoutEffect(()=>{if(i)return d==null?void 0:d(i)},[i,d]);const{Canvas:c}=yr(),{ContextMenu:p}=at();return p?r.jsx(p,{}):c?r.jsx(c,{}):null}k.memo(function(o){const[e,n]=k.useState(null),[s,i]=k.useState(null),a=ms(o.shapeUtils??[]),l=k.useMemo(()=>[...Sa,...a],[a]),d=qc({snapshot:o.snapshot,shapeUtils:l}),c=Za(),{done:p,error:g}=_l(c),{pageId:u,bounds:f,scale:x,background:S,padding:v,darkMode:b,preserveAspectRatio:w,format:E="svg"}=o;return k.useLayoutEffect(()=>{if(!s||!d||!p)return;let C=!1;const y=document.createElement("div");s.appendChild(y),s.classList.add("tl-container","tl-theme__light");const P=new Xc({store:d,shapeUtils:l??[],tools:[],getContainer:()=>y});u&&P.setCurrentPage(u);const T=P.getCurrentPageShapeIds();async function _(){const D=await P.getSvgString([...T],{bounds:f,scale:x,background:S,padding:v,darkMode:b,preserveAspectRatio:w});if(D&&!C){if(E==="svg"){if(!C){const M=new Blob([D.svg],{type:"image/svg+xml"}),$=URL.createObjectURL(M);n($)}}else if(E==="png"){const M=await sl(D.svg,P.environment.isSafari,{type:E,quality:1,scale:2,width:D.width,height:D.height});if(M&&!C){const $=URL.createObjectURL(M);n($)}}}P.dispose()}return _(),()=>{C=!0}},[E,s,d,l,u,f,x,S,v,b,w,p,g]),g?r.jsx(Cr,{children:"Could not load assets."}):p?r.jsx("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:e&&r.jsx("img",{src:e,style:{width:"100%",height:"100%"}})}):r.jsx(jr,{children:"Loading assets..."})});const Ix=ln({schemaVersion:Ir(1),storeVersion:Mn,recordVersions:xs(At,ln({version:Mn,subTypeVersions:xs(At,Mn).optional(),subTypeKey:At.optional()}))}),Tx=ln({schemaVersion:Ir(2),sequences:xs(At,Mn)});ln({tldrawFileFormatVersion:ed,schema:Qc("schemaVersion",{1:Ix,2:Tx}),records:Jc(ln({id:At,typeName:At}).allowUnknownProperties())});export{rS as T};
